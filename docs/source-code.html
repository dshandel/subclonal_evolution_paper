<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Source code | Pre-existing Radioresistant Subclones Determine Radioresistance in Rectal Cancer Organoids</title>
  <meta name="description" content="6 Source code | Pre-existing Radioresistant Subclones Determine Radioresistance in Rectal Cancer Organoids" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Source code | Pre-existing Radioresistant Subclones Determine Radioresistance in Rectal Cancer Organoids" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Source code | Pre-existing Radioresistant Subclones Determine Radioresistance in Rectal Cancer Organoids" />
  
  
  

<meta name="author" content="Daan Andel" />


<meta name="date" content="2023-12-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="copy-number-pattern-analyses.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.28/datatables.js"></script>
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Subclonal Evolution Paper</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="in-vitro-radiation-response-and-clinical-data.html"><a href="in-vitro-radiation-response-and-clinical-data.html"><i class="fa fa-check"></i><b>2</b> In vitro radiation response and clinical data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="in-vitro-radiation-response-and-clinical-data.html"><a href="in-vitro-radiation-response-and-clinical-data.html#progression-free-survival"><i class="fa fa-check"></i><b>2.1</b> Progression-free survival</a></li>
<li class="chapter" data-level="2.2" data-path="in-vitro-radiation-response-and-clinical-data.html"><a href="in-vitro-radiation-response-and-clinical-data.html#in-vitro-dose-response"><i class="fa fa-check"></i><b>2.2</b> In vitro dose-response</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="in-vitro-radiation-response-and-clinical-data.html"><a href="in-vitro-radiation-response-and-clinical-data.html#dose-response-plot"><i class="fa fa-check"></i><b>2.2.1</b> Dose-response plot</a></li>
<li class="chapter" data-level="2.2.2" data-path="in-vitro-radiation-response-and-clinical-data.html"><a href="in-vitro-radiation-response-and-clinical-data.html#rauc-across-multiple-experiments"><i class="fa fa-check"></i><b>2.2.2</b> rAUC across multiple experiments</a></li>
<li class="chapter" data-level="2.2.3" data-path="in-vitro-radiation-response-and-clinical-data.html"><a href="in-vitro-radiation-response-and-clinical-data.html#recovery-statistics-after-10-gy-radiation"><i class="fa fa-check"></i><b>2.2.3</b> Recovery statistics after 10 Gy radiation</a></li>
<li class="chapter" data-level="2.2.4" data-path="in-vitro-radiation-response-and-clinical-data.html"><a href="in-vitro-radiation-response-and-clinical-data.html#persisters-versus-shifters-dose-response-plots"><i class="fa fa-check"></i><b>2.2.4</b> Persisters versus shifters dose-response plots</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="subclonal-dynamics.html"><a href="subclonal-dynamics.html"><i class="fa fa-check"></i><b>3</b> Subclonal dynamics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="subclonal-dynamics.html"><a href="subclonal-dynamics.html#aneufinder-run"><i class="fa fa-check"></i><b>3.1</b> AneuFinder run</a></li>
<li class="chapter" data-level="3.2" data-path="subclonal-dynamics.html"><a href="subclonal-dynamics.html#quality-selection"><i class="fa fa-check"></i><b>3.2</b> Quality selection</a></li>
<li class="chapter" data-level="3.3" data-path="subclonal-dynamics.html"><a href="subclonal-dynamics.html#summary-statistics-of-copy-number-alterations"><i class="fa fa-check"></i><b>3.3</b> Summary statistics of copy number alterations</a></li>
<li class="chapter" data-level="3.4" data-path="subclonal-dynamics.html"><a href="subclonal-dynamics.html#pca-and-k-means-plots"><i class="fa fa-check"></i><b>3.4</b> PCA and K-means plots</a></li>
<li class="chapter" data-level="3.5" data-path="subclonal-dynamics.html"><a href="subclonal-dynamics.html#subclone-selection"><i class="fa fa-check"></i><b>3.5</b> Subclone selection</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="subclonal-dynamics.html"><a href="subclonal-dynamics.html#selecting-subclones"><i class="fa fa-check"></i><b>3.5.1</b> Selecting subclones</a></li>
<li class="chapter" data-level="3.5.2" data-path="subclonal-dynamics.html"><a href="subclonal-dynamics.html#subclone-statistics"><i class="fa fa-check"></i><b>3.5.2</b> Subclone statistics</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="subclonal-dynamics.html"><a href="subclonal-dynamics.html#single-cell-copy-number-heatmap-plots"><i class="fa fa-check"></i><b>3.6</b> Single cell copy number heatmap plots</a></li>
<li class="chapter" data-level="3.7" data-path="subclonal-dynamics.html"><a href="subclonal-dynamics.html#fishers-exact-test"><i class="fa fa-check"></i><b>3.7</b> Fisher’s exact test</a></li>
<li class="chapter" data-level="3.8" data-path="subclonal-dynamics.html"><a href="subclonal-dynamics.html#medicc2"><i class="fa fa-check"></i><b>3.8</b> MEDICC2</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="subclonal-dynamics.html"><a href="subclonal-dynamics.html#wrangle"><i class="fa fa-check"></i><b>3.8.1</b> Wrangle</a></li>
<li class="chapter" data-level="3.8.2" data-path="subclonal-dynamics.html"><a href="subclonal-dynamics.html#medicc2-run"><i class="fa fa-check"></i><b>3.8.2</b> MEDICC2 run</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="copy-number-analyses.html"><a href="copy-number-analyses.html"><i class="fa fa-check"></i><b>4</b> Copy number analyses</a>
<ul>
<li class="chapter" data-level="4.1" data-path="copy-number-analyses.html"><a href="copy-number-analyses.html#colorectal-cancer-specific-arm-level-copy-number-alterations-per-organoid"><i class="fa fa-check"></i><b>4.1</b> Colorectal cancer-specific arm-level copy number alterations per organoid</a></li>
<li class="chapter" data-level="4.2" data-path="copy-number-analyses.html"><a href="copy-number-analyses.html#copy-number-alterations-per-subclone"><i class="fa fa-check"></i><b>4.2</b> Copy number alterations per subclone</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="copy-number-analyses.html"><a href="copy-number-analyses.html#copy-number-alterations-specific-to-hub062a"><i class="fa fa-check"></i><b>4.2.1</b> Copy number alterations specific to HUB062A</a></li>
<li class="chapter" data-level="4.2.2" data-path="copy-number-analyses.html"><a href="copy-number-analyses.html#copy-number-alterations-specific-to-resistant-subclones"><i class="fa fa-check"></i><b>4.2.2</b> Copy number alterations specific to resistant subclones</a></li>
<li class="chapter" data-level="4.2.3" data-path="copy-number-analyses.html"><a href="copy-number-analyses.html#newly-acquired-copy-number-alterations"><i class="fa fa-check"></i><b>4.2.3</b> Newly acquired copy number alterations</a></li>
<li class="chapter" data-level="4.2.4" data-path="copy-number-analyses.html"><a href="copy-number-analyses.html#ccle-ptpn13-and-aff1-analysis"><i class="fa fa-check"></i><b>4.2.4</b> CCLE PTPN13 and AFF1 analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="copy-number-pattern-analyses.html"><a href="copy-number-pattern-analyses.html"><i class="fa fa-check"></i><b>5</b> Copy number pattern analyses</a>
<ul>
<li class="chapter" data-level="5.1" data-path="copy-number-pattern-analyses.html"><a href="copy-number-pattern-analyses.html#single-cell-analyses"><i class="fa fa-check"></i><b>5.1</b> Single cell analyses</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="copy-number-pattern-analyses.html"><a href="copy-number-pattern-analyses.html#heterogeneity-score"><i class="fa fa-check"></i><b>5.1.1</b> Heterogeneity score</a></li>
<li class="chapter" data-level="5.1.2" data-path="copy-number-pattern-analyses.html"><a href="copy-number-pattern-analyses.html#copy-number-length-analysis"><i class="fa fa-check"></i><b>5.1.2</b> Copy number length analysis</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="copy-number-pattern-analyses.html"><a href="copy-number-pattern-analyses.html#ccle-analysis"><i class="fa fa-check"></i><b>5.2</b> CCLE analysis</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="copy-number-pattern-analyses.html"><a href="copy-number-pattern-analyses.html#ploidy-and-whole-genome-duplication-analysis"><i class="fa fa-check"></i><b>5.2.1</b> Ploidy and whole genome duplication analysis</a></li>
<li class="chapter" data-level="5.2.2" data-path="copy-number-pattern-analyses.html"><a href="copy-number-pattern-analyses.html#run-cin-signature"><i class="fa fa-check"></i><b>5.2.2</b> Run CIN signature</a></li>
<li class="chapter" data-level="5.2.3" data-path="copy-number-pattern-analyses.html"><a href="copy-number-pattern-analyses.html#statistics-cin-signature"><i class="fa fa-check"></i><b>5.2.3</b> Statistics CIN signature</a></li>
<li class="chapter" data-level="5.2.4" data-path="copy-number-pattern-analyses.html"><a href="copy-number-pattern-analyses.html#plot-cx1-cin-signature"><i class="fa fa-check"></i><b>5.2.4</b> Plot CX1 CIN signature</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="source-code.html"><a href="source-code.html"><i class="fa fa-check"></i><b>6</b> Source code</a>
<ul>
<li class="chapter" data-level="6.1" data-path="source-code.html"><a href="source-code.html#auc_rad-script-auc_fun-function"><i class="fa fa-check"></i><b>6.1</b> AUC_rad script: ‘AUC_fun’ function</a></li>
<li class="chapter" data-level="6.2" data-path="source-code.html"><a href="source-code.html#fitter_rad-script-fitter-function"><i class="fa fa-check"></i><b>6.2</b> fitter_rad script: ‘fitter’ function</a></li>
<li class="chapter" data-level="6.3" data-path="source-code.html"><a href="source-code.html#ic50_rad-script-ic50_fun-function"><i class="fa fa-check"></i><b>6.3</b> ic50_rad script: ‘IC50_fun’ function</a></li>
<li class="chapter" data-level="6.4" data-path="source-code.html"><a href="source-code.html#relativize_dr-script-relative-function"><i class="fa fa-check"></i><b>6.4</b> relativize_dr script: ‘relative’ function</a></li>
<li class="chapter" data-level="6.5" data-path="source-code.html"><a href="source-code.html#quality_functions-script-quality_check-quality_select-and-check_quality-functions"><i class="fa fa-check"></i><b>6.5</b> quality_functions script: ‘quality_check’, ‘quality_select’ and ‘check_quality’ functions</a></li>
<li class="chapter" data-level="6.6" data-path="source-code.html"><a href="source-code.html#plot_pca_kmeans-script-draw_pca-k_cluster-draw_pca_double-and-k_cluster_double-functions"><i class="fa fa-check"></i><b>6.6</b> plot_pca_kmeans script: ‘draw_pca’, ‘k_cluster’, ‘draw_pca_double’ and ‘k_cluster_double’ functions</a></li>
<li class="chapter" data-level="6.7" data-path="source-code.html"><a href="source-code.html#divide_subclone_functions-script-extract_other_cells-extract_square-l_g-and-subclone_classes_for_genomeheatmap-functions"><i class="fa fa-check"></i><b>6.7</b> divide_subclone_functions script: ‘extract_other_cells’, ‘extract_square’, ‘l_g’ and ‘subclone_classes_for_genomeheatmap’ functions</a></li>
<li class="chapter" data-level="6.8" data-path="source-code.html"><a href="source-code.html#plot_genomeheatmap-script-genomeheatmap-function"><i class="fa fa-check"></i><b>6.8</b> plot_genomeheatmap script: ‘genomeheatmap’ function</a></li>
<li class="chapter" data-level="6.9" data-path="source-code.html"><a href="source-code.html#fisher_test-script-perform_fisher-function"><i class="fa fa-check"></i><b>6.9</b> fisher_test script: ‘perform_fisher’ function</a></li>
<li class="chapter" data-level="6.10" data-path="source-code.html"><a href="source-code.html#find_specific_cna_sc-script-find_specific_cna_sc-function"><i class="fa fa-check"></i><b>6.10</b> find_specific_cna_sc script: ‘find_specific_cna_sc’ function</a></li>
<li class="chapter" data-level="6.11" data-path="source-code.html"><a href="source-code.html#get_cytoband_coverage-script-get_cytoband_coverage-function"><i class="fa fa-check"></i><b>6.11</b> get_cytoband_coverage script: ‘get_cytoband_coverage’ function</a></li>
<li class="chapter" data-level="6.12" data-path="source-code.html"><a href="source-code.html#get_genes-script-get_genes-functoin"><i class="fa fa-check"></i><b>6.12</b> get_genes script: ‘get_genes’ functoin</a></li>
<li class="chapter" data-level="6.13" data-path="source-code.html"><a href="source-code.html#get_oncogenes-scripts-get_oncogenes-function"><i class="fa fa-check"></i><b>6.13</b> get_oncogenes scripts: ‘get_oncogenes’ function</a></li>
<li class="chapter" data-level="6.14" data-path="source-code.html"><a href="source-code.html#plot_genes_karyotype-script-plot_genes_karyotype-function"><i class="fa fa-check"></i><b>6.14</b> plot_genes_karyotype script: ‘plot_genes_karyotype’ function</a></li>
<li class="chapter" data-level="6.15" data-path="source-code.html"><a href="source-code.html#shifters-script-create_cn_matrix-and-cluster_and_shift_transitions-functions"><i class="fa fa-check"></i><b>6.15</b> shifters script: ‘create_cn_matrix’ and ‘cluster_and_shift_transitions’ functions</a></li>
<li class="chapter" data-level="6.16" data-path="source-code.html"><a href="source-code.html#calculate_heterogeneity_score-script-calculate_heterogeneity_score-function"><i class="fa fa-check"></i><b>6.16</b> calculate_heterogeneity_score script: ‘calculate_heterogeneity_score’ function</a></li>
<li class="chapter" data-level="6.17" data-path="source-code.html"><a href="source-code.html#cna_profiler-script-cna_profiler-function"><i class="fa fa-check"></i><b>6.17</b> cna_profiler script: ‘cna_profiler’ function</a></li>
<li class="chapter" data-level="6.18" data-path="source-code.html"><a href="source-code.html#cin_signature_ccle-script-run_cin_ccle-function"><i class="fa fa-check"></i><b>6.18</b> cin_signature_ccle script: ‘run_cin_ccle’ function</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Pre-existing Radioresistant Subclones Determine Radioresistance in Rectal Cancer Organoids</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="source-code" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Source code<a href="source-code.html#source-code" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The source code in this here is arranged in a loose chronological order, reflecting the sequence in which it is called in the scripts presented throughout this book.</p>
<div id="auc_rad-script-auc_fun-function" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> AUC_rad script: ‘AUC_fun’ function<a href="source-code.html#auc_rad-script-auc_fun-function" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="source-code.html#cb172-1" tabindex="-1"></a><span class="co"># returns the AUC of the actual data.</span></span>
<span id="cb172-2"><a href="source-code.html#cb172-2" tabindex="-1"></a>AUC_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb172-3"><a href="source-code.html#cb172-3" tabindex="-1"></a>  </span>
<span id="cb172-4"><a href="source-code.html#cb172-4" tabindex="-1"></a>  <span class="co"># defining variables to work with</span></span>
<span id="cb172-5"><a href="source-code.html#cb172-5" tabindex="-1"></a>  d <span class="ot">&lt;-</span> df</span>
<span id="cb172-6"><a href="source-code.html#cb172-6" tabindex="-1"></a>  </span>
<span id="cb172-7"><a href="source-code.html#cb172-7" tabindex="-1"></a>  lines <span class="ot">&lt;-</span> <span class="fu">character</span>()</span>
<span id="cb172-8"><a href="source-code.html#cb172-8" tabindex="-1"></a>  <span class="co"># for loop, checks if CF$cline is in vector lines, if so, do nothing, else append to vector. </span></span>
<span id="cb172-9"><a href="source-code.html#cb172-9" tabindex="-1"></a>  <span class="cf">for</span> (line <span class="cf">in</span> d<span class="sc">$</span>cline) (</span>
<span id="cb172-10"><a href="source-code.html#cb172-10" tabindex="-1"></a>    <span class="fu">ifelse</span>(line <span class="sc">%in%</span> lines, <span class="cn">NA</span>, lines <span class="ot">&lt;-</span> <span class="fu">c</span>(lines, line)))</span>
<span id="cb172-11"><a href="source-code.html#cb172-11" tabindex="-1"></a>  </span>
<span id="cb172-12"><a href="source-code.html#cb172-12" tabindex="-1"></a>  <span class="co"># separate into dataframes according to cline</span></span>
<span id="cb172-13"><a href="source-code.html#cb172-13" tabindex="-1"></a>  per_line <span class="ot">&lt;-</span> <span class="fu">split</span>(d, <span class="at">f =</span> d<span class="sc">$</span>cline, <span class="at">drop =</span> <span class="cn">TRUE</span>)</span>
<span id="cb172-14"><a href="source-code.html#cb172-14" tabindex="-1"></a>  </span>
<span id="cb172-15"><a href="source-code.html#cb172-15" tabindex="-1"></a>  <span class="co"># define dose_vetor</span></span>
<span id="cb172-16"><a href="source-code.html#cb172-16" tabindex="-1"></a>  dose_vector <span class="ot">&lt;-</span> <span class="fu">unique</span>(d<span class="sc">$</span>dose)</span>
<span id="cb172-17"><a href="source-code.html#cb172-17" tabindex="-1"></a>  </span>
<span id="cb172-18"><a href="source-code.html#cb172-18" tabindex="-1"></a>  </span>
<span id="cb172-19"><a href="source-code.html#cb172-19" tabindex="-1"></a>  <span class="co"># computes AUC for given predicted survival and dose given by dose_vector</span></span>
<span id="cb172-20"><a href="source-code.html#cb172-20" tabindex="-1"></a>  AUC_calc <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb172-21"><a href="source-code.html#cb172-21" tabindex="-1"></a>    <span class="co"># extract actual data</span></span>
<span id="cb172-22"><a href="source-code.html#cb172-22" tabindex="-1"></a>    rel_mean <span class="ot">&lt;-</span> df<span class="sc">$</span>relative_mean</span>
<span id="cb172-23"><a href="source-code.html#cb172-23" tabindex="-1"></a>    </span>
<span id="cb172-24"><a href="source-code.html#cb172-24" tabindex="-1"></a>    <span class="co"># extracts number of experiemnts </span></span>
<span id="cb172-25"><a href="source-code.html#cb172-25" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(d<span class="sc">$</span>Exp))</span>
<span id="cb172-26"><a href="source-code.html#cb172-26" tabindex="-1"></a>    <span class="co">#remove 2th and 3th number (are duplicates)</span></span>
<span id="cb172-27"><a href="source-code.html#cb172-27" tabindex="-1"></a>    rel_mean <span class="ot">&lt;-</span> rel_mean[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">length</span>(rel_mean), n)]</span>
<span id="cb172-28"><a href="source-code.html#cb172-28" tabindex="-1"></a>    </span>
<span id="cb172-29"><a href="source-code.html#cb172-29" tabindex="-1"></a>    <span class="co"># compute maximal </span></span>
<span id="cb172-30"><a href="source-code.html#cb172-30" tabindex="-1"></a>    max_AUC <span class="ot">&lt;-</span> <span class="fu">max</span>(dose_vector)<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb172-31"><a href="source-code.html#cb172-31" tabindex="-1"></a>    </span>
<span id="cb172-32"><a href="source-code.html#cb172-32" tabindex="-1"></a>    <span class="co">#compute AUC</span></span>
<span id="cb172-33"><a href="source-code.html#cb172-33" tabindex="-1"></a>    act_AUC <span class="ot">&lt;-</span> <span class="fu">AUC</span>(<span class="at">x=</span>dose_vector, <span class="at">y =</span> rel_mean)</span>
<span id="cb172-34"><a href="source-code.html#cb172-34" tabindex="-1"></a>    </span>
<span id="cb172-35"><a href="source-code.html#cb172-35" tabindex="-1"></a>    <span class="co"># make dataframe</span></span>
<span id="cb172-36"><a href="source-code.html#cb172-36" tabindex="-1"></a>    datafr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">max_AUC =</span> max_AUC,</span>
<span id="cb172-37"><a href="source-code.html#cb172-37" tabindex="-1"></a>                         <span class="at">act_AUC =</span> act_AUC, </span>
<span id="cb172-38"><a href="source-code.html#cb172-38" tabindex="-1"></a>                         <span class="at">rel_AUC =</span> act_AUC<span class="sc">/</span>max_AUC,</span>
<span id="cb172-39"><a href="source-code.html#cb172-39" tabindex="-1"></a>                         <span class="at">expcode =</span> <span class="fu">unique</span>(df<span class="sc">$</span>expcode),</span>
<span id="cb172-40"><a href="source-code.html#cb172-40" tabindex="-1"></a>                         <span class="at">cline=</span> <span class="fu">unique</span>(df<span class="sc">$</span>cline),</span>
<span id="cb172-41"><a href="source-code.html#cb172-41" tabindex="-1"></a>                         <span class="at">treatment =</span> <span class="fu">unique</span>(df<span class="sc">$</span>treatment ) )</span>
<span id="cb172-42"><a href="source-code.html#cb172-42" tabindex="-1"></a>    </span>
<span id="cb172-43"><a href="source-code.html#cb172-43" tabindex="-1"></a>    </span>
<span id="cb172-44"><a href="source-code.html#cb172-44" tabindex="-1"></a>    <span class="fu">return</span>(datafr)</span>
<span id="cb172-45"><a href="source-code.html#cb172-45" tabindex="-1"></a>  }</span>
<span id="cb172-46"><a href="source-code.html#cb172-46" tabindex="-1"></a>  </span>
<span id="cb172-47"><a href="source-code.html#cb172-47" tabindex="-1"></a>  <span class="co"># Store in vector</span></span>
<span id="cb172-48"><a href="source-code.html#cb172-48" tabindex="-1"></a>  AUC_vector <span class="ot">&lt;-</span> <span class="fu">lapply</span>(per_line, AUC_calc) </span>
<span id="cb172-49"><a href="source-code.html#cb172-49" tabindex="-1"></a>  </span>
<span id="cb172-50"><a href="source-code.html#cb172-50" tabindex="-1"></a>  <span class="co">#merge dataframes</span></span>
<span id="cb172-51"><a href="source-code.html#cb172-51" tabindex="-1"></a>  df <span class="ot">=</span> <span class="fu">do.call</span>(rbind, AUC_vector)</span>
<span id="cb172-52"><a href="source-code.html#cb172-52" tabindex="-1"></a>  </span>
<span id="cb172-53"><a href="source-code.html#cb172-53" tabindex="-1"></a>  <span class="fu">return</span>(df) </span>
<span id="cb172-54"><a href="source-code.html#cb172-54" tabindex="-1"></a>  </span>
<span id="cb172-55"><a href="source-code.html#cb172-55" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="fitter_rad-script-fitter-function" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> fitter_rad script: ‘fitter’ function<a href="source-code.html#fitter_rad-script-fitter-function" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="source-code.html#cb173-1" tabindex="-1"></a>fitter <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb173-2"><a href="source-code.html#cb173-2" tabindex="-1"></a>  </span>
<span id="cb173-3"><a href="source-code.html#cb173-3" tabindex="-1"></a>  <span class="co"># defining variables to work with</span></span>
<span id="cb173-4"><a href="source-code.html#cb173-4" tabindex="-1"></a>  d <span class="ot">&lt;-</span> df</span>
<span id="cb173-5"><a href="source-code.html#cb173-5" tabindex="-1"></a>  </span>
<span id="cb173-6"><a href="source-code.html#cb173-6" tabindex="-1"></a>  </span>
<span id="cb173-7"><a href="source-code.html#cb173-7" tabindex="-1"></a>  lines <span class="ot">&lt;-</span> <span class="fu">character</span>()</span>
<span id="cb173-8"><a href="source-code.html#cb173-8" tabindex="-1"></a>  <span class="co"># for loop, checks if CF$cline is in vector lines, if so, do nothing, else append to vector. </span></span>
<span id="cb173-9"><a href="source-code.html#cb173-9" tabindex="-1"></a>  <span class="cf">for</span> (line <span class="cf">in</span> d<span class="sc">$</span>cline) (</span>
<span id="cb173-10"><a href="source-code.html#cb173-10" tabindex="-1"></a>    <span class="fu">ifelse</span>(line <span class="sc">%in%</span> lines, <span class="cn">NA</span>, lines <span class="ot">&lt;-</span> <span class="fu">c</span>(lines, line)))</span>
<span id="cb173-11"><a href="source-code.html#cb173-11" tabindex="-1"></a>  </span>
<span id="cb173-12"><a href="source-code.html#cb173-12" tabindex="-1"></a>  <span class="co"># separate into dataframes according to cline</span></span>
<span id="cb173-13"><a href="source-code.html#cb173-13" tabindex="-1"></a>  per_line <span class="ot">&lt;-</span> <span class="fu">split</span>(d, <span class="at">f =</span> d<span class="sc">$</span>cline, <span class="at">drop =</span> <span class="cn">TRUE</span>)</span>
<span id="cb173-14"><a href="source-code.html#cb173-14" tabindex="-1"></a>  </span>
<span id="cb173-15"><a href="source-code.html#cb173-15" tabindex="-1"></a>  </span>
<span id="cb173-16"><a href="source-code.html#cb173-16" tabindex="-1"></a>  <span class="co"># Function to make model for every line and dataframe with predicted data for each line. </span></span>
<span id="cb173-17"><a href="source-code.html#cb173-17" tabindex="-1"></a>  fit_model<span class="ot">=</span> <span class="cf">function</span>(line) {</span>
<span id="cb173-18"><a href="source-code.html#cb173-18" tabindex="-1"></a>    <span class="co"># line is a dataframe. Outputs the fits of norm and dose</span></span>
<span id="cb173-19"><a href="source-code.html#cb173-19" tabindex="-1"></a>    fit <span class="ot">&lt;-</span> <span class="fu">drm</span>(relative <span class="sc">~</span> dose, <span class="co"># define y -axis (ncolonies) and x-axis (dose)</span></span>
<span id="cb173-20"><a href="source-code.html#cb173-20" tabindex="-1"></a>               <span class="at">data =</span> line, <span class="co"># defines dataframe</span></span>
<span id="cb173-21"><a href="source-code.html#cb173-21" tabindex="-1"></a>               <span class="at">fct =</span> <span class="fu">LL.4</span> (<span class="at">names =</span> <span class="fu">c</span>(<span class="st">&#39;Slope&#39;</span>, <span class="st">&quot;Lower Limit&quot;</span>, <span class="st">&quot;Upper Limit&quot;</span>, <span class="st">&quot;IC50&quot;</span>))) <span class="co"># defines to fit a log-losistic model)</span></span>
<span id="cb173-22"><a href="source-code.html#cb173-22" tabindex="-1"></a>    </span>
<span id="cb173-23"><a href="source-code.html#cb173-23" tabindex="-1"></a>    newdata <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">dose=</span><span class="fu">exp</span>(<span class="fu">seq</span>(<span class="fu">log</span>(<span class="fl">0.00000001</span>), <span class="fu">log</span>(<span class="fu">max</span>(df<span class="sc">$</span>dose) <span class="sc">+</span> <span class="dv">1000</span>), <span class="at">length=</span><span class="dv">1000</span>))) <span class="co"># new data with doses. Note: lowest dose is not</span></span>
<span id="cb173-24"><a href="source-code.html#cb173-24" tabindex="-1"></a>    <span class="co"># log 0 but log(&#39;very small number&#39;) because otherwise this will hamper the scaling in ggplot later on. </span></span>
<span id="cb173-25"><a href="source-code.html#cb173-25" tabindex="-1"></a>    pm <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata=</span>newdata, <span class="at">interval=</span><span class="st">&quot;confidence&quot;</span>) <span class="co"># new data with predictions and confidence intervals</span></span>
<span id="cb173-26"><a href="source-code.html#cb173-26" tabindex="-1"></a>    newdata<span class="sc">$</span>pred <span class="ot">&lt;-</span> pm[,<span class="dv">1</span>] <span class="co"># add prediction values to new data.</span></span>
<span id="cb173-27"><a href="source-code.html#cb173-27" tabindex="-1"></a>    newdata<span class="sc">$</span>predmin <span class="ot">&lt;-</span> pm[,<span class="dv">2</span>] <span class="co"># add lower bounderies to new data </span></span>
<span id="cb173-28"><a href="source-code.html#cb173-28" tabindex="-1"></a>    newdata<span class="sc">$</span>predmax <span class="ot">&lt;-</span> pm[,<span class="dv">3</span>] <span class="co"># add upper bounderies to new data </span></span>
<span id="cb173-29"><a href="source-code.html#cb173-29" tabindex="-1"></a>    newdata<span class="sc">$</span>cline <span class="ot">&lt;-</span> line<span class="sc">$</span>cline[<span class="dv">1</span>] <span class="co"># add column with cline.</span></span>
<span id="cb173-30"><a href="source-code.html#cb173-30" tabindex="-1"></a>    newdata<span class="sc">$</span>expcode <span class="ot">=</span> <span class="fu">unique</span>(df<span class="sc">$</span>expcode)</span>
<span id="cb173-31"><a href="source-code.html#cb173-31" tabindex="-1"></a>    <span class="fu">return</span>(newdata)</span>
<span id="cb173-32"><a href="source-code.html#cb173-32" tabindex="-1"></a>  }</span>
<span id="cb173-33"><a href="source-code.html#cb173-33" tabindex="-1"></a>  </span>
<span id="cb173-34"><a href="source-code.html#cb173-34" tabindex="-1"></a>  <span class="co"># Store in vector</span></span>
<span id="cb173-35"><a href="source-code.html#cb173-35" tabindex="-1"></a>  data_frames <span class="ot">&lt;-</span> <span class="fu">lapply</span>(per_line, fit_model) </span>
<span id="cb173-36"><a href="source-code.html#cb173-36" tabindex="-1"></a>  </span>
<span id="cb173-37"><a href="source-code.html#cb173-37" tabindex="-1"></a>  </span>
<span id="cb173-38"><a href="source-code.html#cb173-38" tabindex="-1"></a>  <span class="co">#merge dataframes</span></span>
<span id="cb173-39"><a href="source-code.html#cb173-39" tabindex="-1"></a>  df <span class="ot">=</span> <span class="fu">do.call</span>(rbind, data_frames)</span>
<span id="cb173-40"><a href="source-code.html#cb173-40" tabindex="-1"></a>  </span>
<span id="cb173-41"><a href="source-code.html#cb173-41" tabindex="-1"></a>  <span class="fu">return</span>(df) </span>
<span id="cb173-42"><a href="source-code.html#cb173-42" tabindex="-1"></a>  </span>
<span id="cb173-43"><a href="source-code.html#cb173-43" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="ic50_rad-script-ic50_fun-function" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> ic50_rad script: ‘IC50_fun’ function<a href="source-code.html#ic50_rad-script-ic50_fun-function" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="source-code.html#cb174-1" tabindex="-1"></a>IC50_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rad) {</span>
<span id="cb174-2"><a href="source-code.html#cb174-2" tabindex="-1"></a>  </span>
<span id="cb174-3"><a href="source-code.html#cb174-3" tabindex="-1"></a>  <span class="co"># defining variables to work with</span></span>
<span id="cb174-4"><a href="source-code.html#cb174-4" tabindex="-1"></a>  <span class="fu">ifelse</span>(<span class="fu">is.null</span>(rad), d<span class="ot">&lt;-</span>df, d <span class="ot">&lt;-</span> <span class="fu">subset</span>(df, rec_rad <span class="sc">==</span> rad))</span>
<span id="cb174-5"><a href="source-code.html#cb174-5" tabindex="-1"></a>  </span>
<span id="cb174-6"><a href="source-code.html#cb174-6" tabindex="-1"></a>  lines <span class="ot">&lt;-</span> <span class="fu">character</span>()</span>
<span id="cb174-7"><a href="source-code.html#cb174-7" tabindex="-1"></a>  <span class="co"># for loop, checks if CF$cline is in vector lines, if so, do nothing, else append to vector. </span></span>
<span id="cb174-8"><a href="source-code.html#cb174-8" tabindex="-1"></a>  <span class="cf">for</span> (line <span class="cf">in</span> d<span class="sc">$</span>cline) (</span>
<span id="cb174-9"><a href="source-code.html#cb174-9" tabindex="-1"></a>    <span class="fu">ifelse</span>(line <span class="sc">%in%</span> lines, <span class="cn">NA</span>, lines <span class="ot">&lt;-</span> <span class="fu">c</span>(lines, line)))</span>
<span id="cb174-10"><a href="source-code.html#cb174-10" tabindex="-1"></a>  </span>
<span id="cb174-11"><a href="source-code.html#cb174-11" tabindex="-1"></a>  <span class="co"># separate into dataframes according to cline</span></span>
<span id="cb174-12"><a href="source-code.html#cb174-12" tabindex="-1"></a>  per_line <span class="ot">&lt;-</span> <span class="fu">split</span>(d, <span class="at">f =</span> d<span class="sc">$</span>cline, <span class="at">drop =</span><span class="cn">TRUE</span>)</span>
<span id="cb174-13"><a href="source-code.html#cb174-13" tabindex="-1"></a>  </span>
<span id="cb174-14"><a href="source-code.html#cb174-14" tabindex="-1"></a>  </span>
<span id="cb174-15"><a href="source-code.html#cb174-15" tabindex="-1"></a>  <span class="co"># Function to make model for every line and dataframe with predicted data for each line. </span></span>
<span id="cb174-16"><a href="source-code.html#cb174-16" tabindex="-1"></a>  ic50<span class="ot">=</span> <span class="cf">function</span>(line) {</span>
<span id="cb174-17"><a href="source-code.html#cb174-17" tabindex="-1"></a>    <span class="co"># line is a dataframe. Outputs the fits of norm and dose</span></span>
<span id="cb174-18"><a href="source-code.html#cb174-18" tabindex="-1"></a>    fit <span class="ot">&lt;-</span> <span class="fu">drm</span>(relative <span class="sc">~</span> dose, <span class="co"># define y -axis (ncolonies) and x-axis (dose)</span></span>
<span id="cb174-19"><a href="source-code.html#cb174-19" tabindex="-1"></a>               <span class="at">data =</span> line, <span class="co"># defines dataframe</span></span>
<span id="cb174-20"><a href="source-code.html#cb174-20" tabindex="-1"></a>               <span class="at">fct =</span> <span class="fu">LL.4</span> (<span class="at">names =</span> <span class="fu">c</span>(<span class="st">&#39;Slope&#39;</span>, <span class="st">&quot;Lower Limit&quot;</span>, <span class="st">&quot;Upper Limit&quot;</span>, <span class="st">&quot;IC50&quot;</span>))) <span class="co"># defines to fit a log-losistic model)</span></span>
<span id="cb174-21"><a href="source-code.html#cb174-21" tabindex="-1"></a>    </span>
<span id="cb174-22"><a href="source-code.html#cb174-22" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">coef</span>(fit)[<span class="dv">4</span>])</span>
<span id="cb174-23"><a href="source-code.html#cb174-23" tabindex="-1"></a>  }</span>
<span id="cb174-24"><a href="source-code.html#cb174-24" tabindex="-1"></a>  </span>
<span id="cb174-25"><a href="source-code.html#cb174-25" tabindex="-1"></a>  <span class="co"># Store in vector</span></span>
<span id="cb174-26"><a href="source-code.html#cb174-26" tabindex="-1"></a>  IC50_vector <span class="ot">&lt;-</span> <span class="fu">lapply</span>(per_line, ic50) </span>
<span id="cb174-27"><a href="source-code.html#cb174-27" tabindex="-1"></a>  </span>
<span id="cb174-28"><a href="source-code.html#cb174-28" tabindex="-1"></a>  <span class="co">#merge dataframes</span></span>
<span id="cb174-29"><a href="source-code.html#cb174-29" tabindex="-1"></a>  df <span class="ot">=</span> <span class="fu">do.call</span>(rbind, IC50_vector)</span>
<span id="cb174-30"><a href="source-code.html#cb174-30" tabindex="-1"></a>  </span>
<span id="cb174-31"><a href="source-code.html#cb174-31" tabindex="-1"></a>  <span class="fu">return</span>(df) </span>
<span id="cb174-32"><a href="source-code.html#cb174-32" tabindex="-1"></a>  </span>
<span id="cb174-33"><a href="source-code.html#cb174-33" tabindex="-1"></a>} </span></code></pre></div>
</div>
<div id="relativize_dr-script-relative-function" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> relativize_dr script: ‘relative’ function<a href="source-code.html#relativize_dr-script-relative-function" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="source-code.html#cb175-1" tabindex="-1"></a>relative <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rad) {</span>
<span id="cb175-2"><a href="source-code.html#cb175-2" tabindex="-1"></a>  <span class="co">#&#39; @param df with dose response data and columns cline, dose, Exp, </span></span>
<span id="cb175-3"><a href="source-code.html#cb175-3" tabindex="-1"></a>  <span class="co">#&#39; rec_rad, expcode, ncolonies</span></span>
<span id="cb175-4"><a href="source-code.html#cb175-4" tabindex="-1"></a>  <span class="co">#&#39; @param rad if line received radiation (T or F), stored in column rec_rad</span></span>
<span id="cb175-5"><a href="source-code.html#cb175-5" tabindex="-1"></a>  <span class="co">#&#39; @return relativized data where dose = 0 is used as 100%</span></span>
<span id="cb175-6"><a href="source-code.html#cb175-6" tabindex="-1"></a>  </span>
<span id="cb175-7"><a href="source-code.html#cb175-7" tabindex="-1"></a>  <span class="co"># defining variables to work with</span></span>
<span id="cb175-8"><a href="source-code.html#cb175-8" tabindex="-1"></a>  <span class="fu">ifelse</span>(rad <span class="sc">==</span> T, d<span class="ot">&lt;-</span><span class="fu">subset</span>(df, rec_rad <span class="sc">==</span> <span class="dv">1</span>), d<span class="ot">&lt;-</span><span class="fu">subset</span>(df, rec_rad <span class="sc">==</span> <span class="dv">0</span>) )</span>
<span id="cb175-9"><a href="source-code.html#cb175-9" tabindex="-1"></a>  </span>
<span id="cb175-10"><a href="source-code.html#cb175-10" tabindex="-1"></a>  <span class="co"># define ncolonies</span></span>
<span id="cb175-11"><a href="source-code.html#cb175-11" tabindex="-1"></a>  column <span class="ot">&lt;-</span> <span class="st">&quot;ncolonies&quot;</span></span>
<span id="cb175-12"><a href="source-code.html#cb175-12" tabindex="-1"></a>  </span>
<span id="cb175-13"><a href="source-code.html#cb175-13" tabindex="-1"></a>  <span class="co"># Extracts the column name.</span></span>
<span id="cb175-14"><a href="source-code.html#cb175-14" tabindex="-1"></a>  col <span class="ot">&lt;-</span> d[<span class="fu">c</span>(column)]</span>
<span id="cb175-15"><a href="source-code.html#cb175-15" tabindex="-1"></a>  </span>
<span id="cb175-16"><a href="source-code.html#cb175-16" tabindex="-1"></a>  <span class="co"># extracts number of experiemnts </span></span>
<span id="cb175-17"><a href="source-code.html#cb175-17" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(d<span class="sc">$</span>Exp))</span>
<span id="cb175-18"><a href="source-code.html#cb175-18" tabindex="-1"></a>  </span>
<span id="cb175-19"><a href="source-code.html#cb175-19" tabindex="-1"></a>  <span class="co"># Takes mean every nth row</span></span>
<span id="cb175-20"><a href="source-code.html#cb175-20" tabindex="-1"></a>  </span>
<span id="cb175-21"><a href="source-code.html#cb175-21" tabindex="-1"></a>  mean_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb175-22"><a href="source-code.html#cb175-22" tabindex="-1"></a>    m <span class="ot">&lt;-</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb175-23"><a href="source-code.html#cb175-23" tabindex="-1"></a>    <span class="fu">return</span>(m)</span>
<span id="cb175-24"><a href="source-code.html#cb175-24" tabindex="-1"></a>  }</span>
<span id="cb175-25"><a href="source-code.html#cb175-25" tabindex="-1"></a>  </span>
<span id="cb175-26"><a href="source-code.html#cb175-26" tabindex="-1"></a>  mean <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(col,<span class="fu">list</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(col)<span class="sc">%/%</span>n<span class="sc">+</span><span class="dv">1</span>),<span class="at">each=</span>n,<span class="at">len=</span><span class="fu">nrow</span>(col))), mean_fun)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb175-27"><a href="source-code.html#cb175-27" tabindex="-1"></a>  <span class="co"># Duplicates (n=2) or triplicates (n=3) the rows.</span></span>
<span id="cb175-28"><a href="source-code.html#cb175-28" tabindex="-1"></a>  mean <span class="ot">&lt;-</span> mean[<span class="fu">rep</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(mean)), <span class="at">each =</span> n), ]</span>
<span id="cb175-29"><a href="source-code.html#cb175-29" tabindex="-1"></a>  <span class="co"># Adds everything to the dataframe. </span></span>
<span id="cb175-30"><a href="source-code.html#cb175-30" tabindex="-1"></a>  d[<span class="st">&quot;mean&quot;</span>] <span class="ot">&lt;-</span> mean</span>
<span id="cb175-31"><a href="source-code.html#cb175-31" tabindex="-1"></a>  </span>
<span id="cb175-32"><a href="source-code.html#cb175-32" tabindex="-1"></a>  <span class="co"># Select mean values of 0 concentration</span></span>
<span id="cb175-33"><a href="source-code.html#cb175-33" tabindex="-1"></a>  d <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb175-34"><a href="source-code.html#cb175-34" tabindex="-1"></a>    <span class="fu">group_by</span>(cline) <span class="sc">%&gt;%</span></span>
<span id="cb175-35"><a href="source-code.html#cb175-35" tabindex="-1"></a>    <span class="fu">arrange</span>(cline,dose)</span>
<span id="cb175-36"><a href="source-code.html#cb175-36" tabindex="-1"></a>  </span>
<span id="cb175-37"><a href="source-code.html#cb175-37" tabindex="-1"></a>  first <span class="ot">&lt;-</span> d[d<span class="sc">$</span>dose<span class="sc">==</span><span class="dv">0</span>, ] <span class="sc">%&gt;%</span></span>
<span id="cb175-38"><a href="source-code.html#cb175-38" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(cline, <span class="at">value100=</span>mean)</span>
<span id="cb175-39"><a href="source-code.html#cb175-39" tabindex="-1"></a>  </span>
<span id="cb175-40"><a href="source-code.html#cb175-40" tabindex="-1"></a>  <span class="co"># Make cline a factor</span></span>
<span id="cb175-41"><a href="source-code.html#cb175-41" tabindex="-1"></a>  d<span class="sc">$</span>cline<span class="ot">&lt;-</span><span class="fu">factor</span>(d<span class="sc">$</span>cline)</span>
<span id="cb175-42"><a href="source-code.html#cb175-42" tabindex="-1"></a>  </span>
<span id="cb175-43"><a href="source-code.html#cb175-43" tabindex="-1"></a>  <span class="co"># Merge first original (d)</span></span>
<span id="cb175-44"><a href="source-code.html#cb175-44" tabindex="-1"></a>  d <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb175-45"><a href="source-code.html#cb175-45" tabindex="-1"></a>    <span class="fu">merge</span>(first,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;cline&quot;</span>))</span>
<span id="cb175-46"><a href="source-code.html#cb175-46" tabindex="-1"></a>  </span>
<span id="cb175-47"><a href="source-code.html#cb175-47" tabindex="-1"></a>  <span class="co"># Extract only every nth row.</span></span>
<span id="cb175-48"><a href="source-code.html#cb175-48" tabindex="-1"></a>  d <span class="ot">=</span> d[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(d), n), ]</span>
<span id="cb175-49"><a href="source-code.html#cb175-49" tabindex="-1"></a>  </span>
<span id="cb175-50"><a href="source-code.html#cb175-50" tabindex="-1"></a>  <span class="co"># make new column with relative, called relative</span></span>
<span id="cb175-51"><a href="source-code.html#cb175-51" tabindex="-1"></a>  d<span class="sc">$</span>relative <span class="ot">=</span> d<span class="sc">$</span>ncolonies<span class="sc">/</span>d<span class="sc">$</span>value100</span>
<span id="cb175-52"><a href="source-code.html#cb175-52" tabindex="-1"></a>  d<span class="sc">$</span>relative_mean <span class="ot">=</span> d<span class="sc">$</span>mean<span class="sc">/</span>d<span class="sc">$</span>value100</span>
<span id="cb175-53"><a href="source-code.html#cb175-53" tabindex="-1"></a>  </span>
<span id="cb175-54"><a href="source-code.html#cb175-54" tabindex="-1"></a>  d<span class="ot">&lt;-</span><span class="fu">subset</span>(d, <span class="at">select=</span><span class="sc">-</span><span class="fu">c</span>(mean,value100))</span>
<span id="cb175-55"><a href="source-code.html#cb175-55" tabindex="-1"></a>  </span>
<span id="cb175-56"><a href="source-code.html#cb175-56" tabindex="-1"></a>  <span class="co"># compute relative standard error of the mean</span></span>
<span id="cb175-57"><a href="source-code.html#cb175-57" tabindex="-1"></a>  <span class="co"># define the column with sem in it</span></span>
<span id="cb175-58"><a href="source-code.html#cb175-58" tabindex="-1"></a>  column <span class="ot">&lt;-</span> <span class="st">&quot;relative&quot;</span></span>
<span id="cb175-59"><a href="source-code.html#cb175-59" tabindex="-1"></a>  </span>
<span id="cb175-60"><a href="source-code.html#cb175-60" tabindex="-1"></a>  <span class="co"># Extracts the column name.</span></span>
<span id="cb175-61"><a href="source-code.html#cb175-61" tabindex="-1"></a>  col <span class="ot">&lt;-</span> d[<span class="fu">c</span>(column)]</span>
<span id="cb175-62"><a href="source-code.html#cb175-62" tabindex="-1"></a>  </span>
<span id="cb175-63"><a href="source-code.html#cb175-63" tabindex="-1"></a>  </span>
<span id="cb175-64"><a href="source-code.html#cb175-64" tabindex="-1"></a>  sem_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb175-65"><a href="source-code.html#cb175-65" tabindex="-1"></a>    std <span class="ot">&lt;-</span> <span class="fu">sd</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb175-66"><a href="source-code.html#cb175-66" tabindex="-1"></a>    vector <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(x)</span>
<span id="cb175-67"><a href="source-code.html#cb175-67" tabindex="-1"></a>    </span>
<span id="cb175-68"><a href="source-code.html#cb175-68" tabindex="-1"></a>    sem <span class="ot">&lt;-</span> std<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(vector))</span>
<span id="cb175-69"><a href="source-code.html#cb175-69" tabindex="-1"></a>    <span class="fu">return</span>(sem)</span>
<span id="cb175-70"><a href="source-code.html#cb175-70" tabindex="-1"></a>  }</span>
<span id="cb175-71"><a href="source-code.html#cb175-71" tabindex="-1"></a>  </span>
<span id="cb175-72"><a href="source-code.html#cb175-72" tabindex="-1"></a>  sem <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(col,<span class="fu">list</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(col)<span class="sc">%/%</span>n<span class="sc">+</span><span class="dv">1</span>),<span class="at">each=</span>n,<span class="at">len=</span><span class="fu">nrow</span>(col))),sem_fun)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb175-73"><a href="source-code.html#cb175-73" tabindex="-1"></a>  sem <span class="ot">&lt;-</span> sem[<span class="fu">rep</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(sem)), <span class="at">each =</span> n), ]</span>
<span id="cb175-74"><a href="source-code.html#cb175-74" tabindex="-1"></a>  d[<span class="st">&quot;relative_sem&quot;</span>] <span class="ot">&lt;-</span> sem</span>
<span id="cb175-75"><a href="source-code.html#cb175-75" tabindex="-1"></a>  </span>
<span id="cb175-76"><a href="source-code.html#cb175-76" tabindex="-1"></a>  <span class="fu">return</span>(d)</span>
<span id="cb175-77"><a href="source-code.html#cb175-77" tabindex="-1"></a>  </span>
<span id="cb175-78"><a href="source-code.html#cb175-78" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="quality_functions-script-quality_check-quality_select-and-check_quality-functions" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> quality_functions script: ‘quality_check’, ‘quality_select’ and ‘check_quality’ functions<a href="source-code.html#quality_functions-script-quality_check-quality_select-and-check_quality-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="source-code.html#cb176-1" tabindex="-1"></a>quality_check <span class="ot">&lt;-</span> <span class="cf">function</span>(inputdir, model) {</span>
<span id="cb176-2"><a href="source-code.html#cb176-2" tabindex="-1"></a>  <span class="co">#&#39; @param inputdir is directory containing the standard aneufinder output for each plate</span></span>
<span id="cb176-3"><a href="source-code.html#cb176-3" tabindex="-1"></a>  <span class="co">#&#39; model is which model to use for the quality check: either dnacopy, edivisive or HMM</span></span>
<span id="cb176-4"><a href="source-code.html#cb176-4" tabindex="-1"></a>  <span class="co">#&#39; quality_check will make quality metrics for each plate</span></span>
<span id="cb176-5"><a href="source-code.html#cb176-5" tabindex="-1"></a>  <span class="co">#&#39; quality_check assumes that rdaBaseDirectory contains folder with models for each plate</span></span>
<span id="cb176-6"><a href="source-code.html#cb176-6" tabindex="-1"></a>  <span class="co">#&#39; each plate folder has to contain a MODEL folder and a method-&#39;dnacopy, edivisive, or HMM&#39; folder</span></span>
<span id="cb176-7"><a href="source-code.html#cb176-7" tabindex="-1"></a>  <span class="co">#&#39; @example quality_check(inputdir = rdaBaseDirectory, model = &#39;edivisive&#39;)</span></span>
<span id="cb176-8"><a href="source-code.html#cb176-8" tabindex="-1"></a>  </span>
<span id="cb176-9"><a href="source-code.html#cb176-9" tabindex="-1"></a>  <span class="co"># go to folder with appropiate files</span></span>
<span id="cb176-10"><a href="source-code.html#cb176-10" tabindex="-1"></a>  rda_folder <span class="ot">&lt;-</span> <span class="fu">paste0</span>(inputdir, <span class="st">&#39;/MODELS&#39;</span>, <span class="st">&#39;/method-&#39;</span>, model)</span>
<span id="cb176-11"><a href="source-code.html#cb176-11" tabindex="-1"></a>  </span>
<span id="cb176-12"><a href="source-code.html#cb176-12" tabindex="-1"></a>  <span class="co"># extract files</span></span>
<span id="cb176-13"><a href="source-code.html#cb176-13" tabindex="-1"></a>  rda_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(rda_folder, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb176-14"><a href="source-code.html#cb176-14" tabindex="-1"></a>  </span>
<span id="cb176-15"><a href="source-code.html#cb176-15" tabindex="-1"></a>  <span class="co"># run quality check on each file</span></span>
<span id="cb176-16"><a href="source-code.html#cb176-16" tabindex="-1"></a>  cl <span class="ot">&lt;-</span></span>
<span id="cb176-17"><a href="source-code.html#cb176-17" tabindex="-1"></a>    <span class="fu">clusterByQuality</span>(</span>
<span id="cb176-18"><a href="source-code.html#cb176-18" tabindex="-1"></a>      rda_files,</span>
<span id="cb176-19"><a href="source-code.html#cb176-19" tabindex="-1"></a>      <span class="at">measures =</span> <span class="fu">c</span>(</span>
<span id="cb176-20"><a href="source-code.html#cb176-20" tabindex="-1"></a>        <span class="st">&#39;spikiness&#39;</span>,</span>
<span id="cb176-21"><a href="source-code.html#cb176-21" tabindex="-1"></a>        <span class="st">&#39;num.segments&#39;</span>,</span>
<span id="cb176-22"><a href="source-code.html#cb176-22" tabindex="-1"></a>        <span class="st">&#39;entropy&#39;</span>,</span>
<span id="cb176-23"><a href="source-code.html#cb176-23" tabindex="-1"></a>        <span class="st">&#39;bhattacharyya&#39;</span>,</span>
<span id="cb176-24"><a href="source-code.html#cb176-24" tabindex="-1"></a>        <span class="st">&#39;sos&#39;</span></span>
<span id="cb176-25"><a href="source-code.html#cb176-25" tabindex="-1"></a>      )</span>
<span id="cb176-26"><a href="source-code.html#cb176-26" tabindex="-1"></a>    )</span>
<span id="cb176-27"><a href="source-code.html#cb176-27" tabindex="-1"></a>  </span>
<span id="cb176-28"><a href="source-code.html#cb176-28" tabindex="-1"></a>  <span class="fu">return</span>(cl)</span>
<span id="cb176-29"><a href="source-code.html#cb176-29" tabindex="-1"></a>  </span>
<span id="cb176-30"><a href="source-code.html#cb176-30" tabindex="-1"></a>}</span>
<span id="cb176-31"><a href="source-code.html#cb176-31" tabindex="-1"></a></span>
<span id="cb176-32"><a href="source-code.html#cb176-32" tabindex="-1"></a>quality_select <span class="ot">&lt;-</span> <span class="cf">function</span>(cl, spik, bhat) {</span>
<span id="cb176-33"><a href="source-code.html#cb176-33" tabindex="-1"></a>  <span class="co">#&#39; selects all files that meets the defined quality requirements</span></span>
<span id="cb176-34"><a href="source-code.html#cb176-34" tabindex="-1"></a>  <span class="co">#&#39; @param cl output of the clusterByQuality function in AneuFinder</span></span>
<span id="cb176-35"><a href="source-code.html#cb176-35" tabindex="-1"></a>  <span class="co">#&#39; @param spik the spikiness treshhold. All clusters with spikiness above</span></span>
<span id="cb176-36"><a href="source-code.html#cb176-36" tabindex="-1"></a>  <span class="co">#&#39; the treshold will be removed</span></span>
<span id="cb176-37"><a href="source-code.html#cb176-37" tabindex="-1"></a>  <span class="co">#&#39; @param bhat the bhattacharrya score. All clusters with bhattacharrya below</span></span>
<span id="cb176-38"><a href="source-code.html#cb176-38" tabindex="-1"></a>  <span class="co">#&#39; the treshold will be removed</span></span>
<span id="cb176-39"><a href="source-code.html#cb176-39" tabindex="-1"></a>  <span class="co">#&#39; @return returns a vector of selected files paths</span></span>
<span id="cb176-40"><a href="source-code.html#cb176-40" tabindex="-1"></a>  </span>
<span id="cb176-41"><a href="source-code.html#cb176-41" tabindex="-1"></a>  <span class="co"># convert to df to allow easy wrangling</span></span>
<span id="cb176-42"><a href="source-code.html#cb176-42" tabindex="-1"></a>  cl_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cl<span class="sc">$</span>parameters)</span>
<span id="cb176-43"><a href="source-code.html#cb176-43" tabindex="-1"></a>  </span>
<span id="cb176-44"><a href="source-code.html#cb176-44" tabindex="-1"></a>  <span class="co"># remove higher than spik</span></span>
<span id="cb176-45"><a href="source-code.html#cb176-45" tabindex="-1"></a>  spik <span class="ot">&lt;-</span> <span class="fu">subset</span>(cl_df, spikiness <span class="sc">&lt;</span> spik)</span>
<span id="cb176-46"><a href="source-code.html#cb176-46" tabindex="-1"></a>  </span>
<span id="cb176-47"><a href="source-code.html#cb176-47" tabindex="-1"></a>  <span class="co"># remove lower than bhat</span></span>
<span id="cb176-48"><a href="source-code.html#cb176-48" tabindex="-1"></a>  spik_bhat <span class="ot">&lt;-</span> <span class="fu">subset</span>(spik,  bhattacharyya <span class="sc">&gt;</span> bhat)</span>
<span id="cb176-49"><a href="source-code.html#cb176-49" tabindex="-1"></a>  </span>
<span id="cb176-50"><a href="source-code.html#cb176-50" tabindex="-1"></a>  cluster_n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(spik_bhat)</span>
<span id="cb176-51"><a href="source-code.html#cb176-51" tabindex="-1"></a>  </span>
<span id="cb176-52"><a href="source-code.html#cb176-52" tabindex="-1"></a>  <span class="co"># create vector of selected files</span></span>
<span id="cb176-53"><a href="source-code.html#cb176-53" tabindex="-1"></a>  selected.files <span class="ot">&lt;-</span> <span class="fu">unlist</span>(cl<span class="sc">$</span>classification[<span class="dv">0</span><span class="sc">:</span>cluster_n])</span>
<span id="cb176-54"><a href="source-code.html#cb176-54" tabindex="-1"></a>  </span>
<span id="cb176-55"><a href="source-code.html#cb176-55" tabindex="-1"></a>  <span class="fu">return</span>(selected.files)</span>
<span id="cb176-56"><a href="source-code.html#cb176-56" tabindex="-1"></a>  </span>
<span id="cb176-57"><a href="source-code.html#cb176-57" tabindex="-1"></a>}</span>
<span id="cb176-58"><a href="source-code.html#cb176-58" tabindex="-1"></a></span>
<span id="cb176-59"><a href="source-code.html#cb176-59" tabindex="-1"></a>check_quality <span class="ot">&lt;-</span> <span class="cf">function</span>(cl) {</span>
<span id="cb176-60"><a href="source-code.html#cb176-60" tabindex="-1"></a>  <span class="fu">return</span>(cl<span class="sc">$</span>parameters)</span>
<span id="cb176-61"><a href="source-code.html#cb176-61" tabindex="-1"></a>}</span>
<span id="cb176-62"><a href="source-code.html#cb176-62" tabindex="-1"></a>  </span>
<span id="cb176-63"><a href="source-code.html#cb176-63" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
</div>
<div id="plot_pca_kmeans-script-draw_pca-k_cluster-draw_pca_double-and-k_cluster_double-functions" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> plot_pca_kmeans script: ‘draw_pca’, ‘k_cluster’, ‘draw_pca_double’ and ‘k_cluster_double’ functions<a href="source-code.html#plot_pca_kmeans-script-draw_pca-k_cluster-draw_pca_double-and-k_cluster_double-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="source-code.html#cb177-1" tabindex="-1"></a>draw_pca <span class="ot">&lt;-</span></span>
<span id="cb177-2"><a href="source-code.html#cb177-2" tabindex="-1"></a>  <span class="cf">function</span>(list_files1,</span>
<span id="cb177-3"><a href="source-code.html#cb177-3" tabindex="-1"></a>           list_files2,</span>
<span id="cb177-4"><a href="source-code.html#cb177-4" tabindex="-1"></a>           size,</span>
<span id="cb177-5"><a href="source-code.html#cb177-5" tabindex="-1"></a>           legend_position,</span>
<span id="cb177-6"><a href="source-code.html#cb177-6" tabindex="-1"></a>           baseline_kra,</span>
<span id="cb177-7"><a href="source-code.html#cb177-7" tabindex="-1"></a>           recurrence_kra,</span>
<span id="cb177-8"><a href="source-code.html#cb177-8" tabindex="-1"></a>           <span class="at">ssdna004 =</span> F) {</span>
<span id="cb177-9"><a href="source-code.html#cb177-9" tabindex="-1"></a>    cells <span class="ot">&lt;-</span> <span class="fu">c</span>(list_files1, list_files2)</span>
<span id="cb177-10"><a href="source-code.html#cb177-10" tabindex="-1"></a>    </span>
<span id="cb177-11"><a href="source-code.html#cb177-11" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">plot_pca</span>(</span>
<span id="cb177-12"><a href="source-code.html#cb177-12" tabindex="-1"></a>      cells,</span>
<span id="cb177-13"><a href="source-code.html#cb177-13" tabindex="-1"></a>      <span class="at">colorBy =</span> classes,</span>
<span id="cb177-14"><a href="source-code.html#cb177-14" tabindex="-1"></a>      <span class="at">PC1 =</span> <span class="dv">1</span>,</span>
<span id="cb177-15"><a href="source-code.html#cb177-15" tabindex="-1"></a>      <span class="at">PC2 =</span> <span class="dv">2</span>,</span>
<span id="cb177-16"><a href="source-code.html#cb177-16" tabindex="-1"></a>      <span class="at">plot =</span> F</span>
<span id="cb177-17"><a href="source-code.html#cb177-17" tabindex="-1"></a>    )</span>
<span id="cb177-18"><a href="source-code.html#cb177-18" tabindex="-1"></a>    </span>
<span id="cb177-19"><a href="source-code.html#cb177-19" tabindex="-1"></a>    df<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(<span class="fu">rownames</span>(df),  <span class="st">&#39;KRA-0</span><span class="sc">\\</span><span class="st">d+&#39;</span>)</span>
<span id="cb177-20"><a href="source-code.html#cb177-20" tabindex="-1"></a>    num <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(<span class="fu">rownames</span>(df),  <span class="st">&#39;_</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.&#39;</span>)</span>
<span id="cb177-21"><a href="source-code.html#cb177-21" tabindex="-1"></a>    num <span class="ot">&lt;-</span> <span class="fu">str_remove_all</span>(num, <span class="at">pattern =</span> <span class="st">&#39;</span><span class="sc">\\</span><span class="st">.&#39;</span>)</span>
<span id="cb177-22"><a href="source-code.html#cb177-22" tabindex="-1"></a>    df<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">paste0</span>(df<span class="sc">$</span>class, num)</span>
<span id="cb177-23"><a href="source-code.html#cb177-23" tabindex="-1"></a>    pc1 <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df)[<span class="dv">1</span>]</span>
<span id="cb177-24"><a href="source-code.html#cb177-24" tabindex="-1"></a>    pc2 <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df)[<span class="dv">2</span>]</span>
<span id="cb177-25"><a href="source-code.html#cb177-25" tabindex="-1"></a>    </span>
<span id="cb177-26"><a href="source-code.html#cb177-26" tabindex="-1"></a>    <span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;PC1&#39;</span>, <span class="st">&#39;PC2&#39;</span>, <span class="st">&#39;class&#39;</span>, <span class="st">&#39;label&#39;</span>)</span>
<span id="cb177-27"><a href="source-code.html#cb177-27" tabindex="-1"></a>    </span>
<span id="cb177-28"><a href="source-code.html#cb177-28" tabindex="-1"></a>    col_vals <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(ssdna004 <span class="sc">==</span> T, <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;#D69C4E&quot;</span>, <span class="st">&quot;#999999&quot;</span>)), <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;#999999&quot;</span>, <span class="st">&quot;#D69C4E&quot;</span>)))</span>
<span id="cb177-29"><a href="source-code.html#cb177-29" tabindex="-1"></a>    label_vals <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(ssdna004 <span class="sc">==</span> T, <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&#39;Recurrence&#39;</span>, <span class="st">&#39;Baseline&#39;</span>)), <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&#39;Baseline&#39;</span>, <span class="st">&#39;Recurrence&#39;</span>)))</span>
<span id="cb177-30"><a href="source-code.html#cb177-30" tabindex="-1"></a>    </span>
<span id="cb177-31"><a href="source-code.html#cb177-31" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb177-32"><a href="source-code.html#cb177-32" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">size =</span> size, <span class="fu">aes</span>(<span class="at">x =</span> PC1,</span>
<span id="cb177-33"><a href="source-code.html#cb177-33" tabindex="-1"></a>                                  <span class="at">y =</span> PC2,</span>
<span id="cb177-34"><a href="source-code.html#cb177-34" tabindex="-1"></a>                                  <span class="at">col =</span> class)) <span class="sc">+</span></span>
<span id="cb177-35"><a href="source-code.html#cb177-35" tabindex="-1"></a>      <span class="co"># scale_color_manual(values = c(&quot;#FFDB6D&quot;, &quot;#00AFBB&quot;)) +</span></span>
<span id="cb177-36"><a href="source-code.html#cb177-36" tabindex="-1"></a>      <span class="fu">scale_color_manual</span>(</span>
<span id="cb177-37"><a href="source-code.html#cb177-37" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb177-38"><a href="source-code.html#cb177-38" tabindex="-1"></a>        <span class="at">values =</span> col_vals[[<span class="dv">1</span>]],</span>
<span id="cb177-39"><a href="source-code.html#cb177-39" tabindex="-1"></a>        <span class="at">labels =</span> label_vals[[<span class="dv">1</span>]]</span>
<span id="cb177-40"><a href="source-code.html#cb177-40" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb177-41"><a href="source-code.html#cb177-41" tabindex="-1"></a>      </span>
<span id="cb177-42"><a href="source-code.html#cb177-42" tabindex="-1"></a>      <span class="co"># or consider &#39;#9e1303&#39; for second cycle of recurrence</span></span>
<span id="cb177-43"><a href="source-code.html#cb177-43" tabindex="-1"></a>      </span>
<span id="cb177-44"><a href="source-code.html#cb177-44" tabindex="-1"></a>      <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb177-45"><a href="source-code.html#cb177-45" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> legend_position,</span>
<span id="cb177-46"><a href="source-code.html#cb177-46" tabindex="-1"></a>            <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>),</span>
<span id="cb177-47"><a href="source-code.html#cb177-47" tabindex="-1"></a>            <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>)) <span class="sc">+</span></span>
<span id="cb177-48"><a href="source-code.html#cb177-48" tabindex="-1"></a>      </span>
<span id="cb177-49"><a href="source-code.html#cb177-49" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> pc1, <span class="at">y =</span> pc2)</span>
<span id="cb177-50"><a href="source-code.html#cb177-50" tabindex="-1"></a>    p</span>
<span id="cb177-51"><a href="source-code.html#cb177-51" tabindex="-1"></a>    </span>
<span id="cb177-52"><a href="source-code.html#cb177-52" tabindex="-1"></a>  </span>
<span id="cb177-53"><a href="source-code.html#cb177-53" tabindex="-1"></a>    </span>
<span id="cb177-54"><a href="source-code.html#cb177-54" tabindex="-1"></a>    <span class="co"># ggplotly(p)</span></span>
<span id="cb177-55"><a href="source-code.html#cb177-55" tabindex="-1"></a>    </span>
<span id="cb177-56"><a href="source-code.html#cb177-56" tabindex="-1"></a>  }</span>
<span id="cb177-57"><a href="source-code.html#cb177-57" tabindex="-1"></a></span>
<span id="cb177-58"><a href="source-code.html#cb177-58" tabindex="-1"></a></span>
<span id="cb177-59"><a href="source-code.html#cb177-59" tabindex="-1"></a>k_cluster <span class="ot">&lt;-</span> <span class="cf">function</span>(list_files1,</span>
<span id="cb177-60"><a href="source-code.html#cb177-60" tabindex="-1"></a>                      list_files2,</span>
<span id="cb177-61"><a href="source-code.html#cb177-61" tabindex="-1"></a>                      cluster_n,</span>
<span id="cb177-62"><a href="source-code.html#cb177-62" tabindex="-1"></a>                      cols,</span>
<span id="cb177-63"><a href="source-code.html#cb177-63" tabindex="-1"></a>                      labels,</span>
<span id="cb177-64"><a href="source-code.html#cb177-64" tabindex="-1"></a>                      legend_position,</span>
<span id="cb177-65"><a href="source-code.html#cb177-65" tabindex="-1"></a>                      normalize,</span>
<span id="cb177-66"><a href="source-code.html#cb177-66" tabindex="-1"></a>                      <span class="at">return_elbow =</span> F) {</span>
<span id="cb177-67"><a href="source-code.html#cb177-67" tabindex="-1"></a>  </span>
<span id="cb177-68"><a href="source-code.html#cb177-68" tabindex="-1"></a>  <span class="fu">require</span>(factoextra)</span>
<span id="cb177-69"><a href="source-code.html#cb177-69" tabindex="-1"></a>  </span>
<span id="cb177-70"><a href="source-code.html#cb177-70" tabindex="-1"></a>  cells <span class="ot">&lt;-</span> <span class="fu">c</span>(list_files1, list_files2)</span>
<span id="cb177-71"><a href="source-code.html#cb177-71" tabindex="-1"></a>  </span>
<span id="cb177-72"><a href="source-code.html#cb177-72" tabindex="-1"></a>  df12 <span class="ot">&lt;-</span> <span class="fu">plot_pca</span>(</span>
<span id="cb177-73"><a href="source-code.html#cb177-73" tabindex="-1"></a>    cells,</span>
<span id="cb177-74"><a href="source-code.html#cb177-74" tabindex="-1"></a>    <span class="at">colorBy =</span> classes,</span>
<span id="cb177-75"><a href="source-code.html#cb177-75" tabindex="-1"></a>    <span class="at">PC1 =</span> <span class="dv">1</span>,</span>
<span id="cb177-76"><a href="source-code.html#cb177-76" tabindex="-1"></a>    <span class="at">PC2 =</span> <span class="dv">2</span>,</span>
<span id="cb177-77"><a href="source-code.html#cb177-77" tabindex="-1"></a>    <span class="at">plot =</span> F</span>
<span id="cb177-78"><a href="source-code.html#cb177-78" tabindex="-1"></a>  )</span>
<span id="cb177-79"><a href="source-code.html#cb177-79" tabindex="-1"></a></span>
<span id="cb177-80"><a href="source-code.html#cb177-80" tabindex="-1"></a>  </span>
<span id="cb177-81"><a href="source-code.html#cb177-81" tabindex="-1"></a>  df34 <span class="ot">&lt;-</span> <span class="fu">plot_pca</span>(</span>
<span id="cb177-82"><a href="source-code.html#cb177-82" tabindex="-1"></a>    cells,</span>
<span id="cb177-83"><a href="source-code.html#cb177-83" tabindex="-1"></a>    <span class="at">colorBy =</span> classes,</span>
<span id="cb177-84"><a href="source-code.html#cb177-84" tabindex="-1"></a>    <span class="at">PC1 =</span> <span class="dv">3</span>,</span>
<span id="cb177-85"><a href="source-code.html#cb177-85" tabindex="-1"></a>    <span class="at">PC2 =</span> <span class="dv">4</span>,</span>
<span id="cb177-86"><a href="source-code.html#cb177-86" tabindex="-1"></a>    <span class="at">plot =</span> F</span>
<span id="cb177-87"><a href="source-code.html#cb177-87" tabindex="-1"></a>  )</span>
<span id="cb177-88"><a href="source-code.html#cb177-88" tabindex="-1"></a>  </span>
<span id="cb177-89"><a href="source-code.html#cb177-89" tabindex="-1"></a>  df56 <span class="ot">&lt;-</span> <span class="fu">plot_pca</span>(</span>
<span id="cb177-90"><a href="source-code.html#cb177-90" tabindex="-1"></a>    cells,</span>
<span id="cb177-91"><a href="source-code.html#cb177-91" tabindex="-1"></a>    <span class="at">colorBy =</span> classes,</span>
<span id="cb177-92"><a href="source-code.html#cb177-92" tabindex="-1"></a>    <span class="at">PC1 =</span> <span class="dv">5</span>,</span>
<span id="cb177-93"><a href="source-code.html#cb177-93" tabindex="-1"></a>    <span class="at">PC2 =</span> <span class="dv">6</span>,</span>
<span id="cb177-94"><a href="source-code.html#cb177-94" tabindex="-1"></a>    <span class="at">plot =</span> F</span>
<span id="cb177-95"><a href="source-code.html#cb177-95" tabindex="-1"></a>  )</span>
<span id="cb177-96"><a href="source-code.html#cb177-96" tabindex="-1"></a>  </span>
<span id="cb177-97"><a href="source-code.html#cb177-97" tabindex="-1"></a>  df78 <span class="ot">&lt;-</span> <span class="fu">plot_pca</span>(</span>
<span id="cb177-98"><a href="source-code.html#cb177-98" tabindex="-1"></a>    cells,</span>
<span id="cb177-99"><a href="source-code.html#cb177-99" tabindex="-1"></a>    <span class="at">colorBy =</span> classes,</span>
<span id="cb177-100"><a href="source-code.html#cb177-100" tabindex="-1"></a>    <span class="at">PC1 =</span> <span class="dv">7</span>,</span>
<span id="cb177-101"><a href="source-code.html#cb177-101" tabindex="-1"></a>    <span class="at">PC2 =</span> <span class="dv">8</span>,</span>
<span id="cb177-102"><a href="source-code.html#cb177-102" tabindex="-1"></a>    <span class="at">plot =</span> F</span>
<span id="cb177-103"><a href="source-code.html#cb177-103" tabindex="-1"></a>  )</span>
<span id="cb177-104"><a href="source-code.html#cb177-104" tabindex="-1"></a>  </span>
<span id="cb177-105"><a href="source-code.html#cb177-105" tabindex="-1"></a>  df910 <span class="ot">&lt;-</span> <span class="fu">plot_pca</span>(</span>
<span id="cb177-106"><a href="source-code.html#cb177-106" tabindex="-1"></a>    cells,</span>
<span id="cb177-107"><a href="source-code.html#cb177-107" tabindex="-1"></a>    <span class="at">colorBy =</span> classes,</span>
<span id="cb177-108"><a href="source-code.html#cb177-108" tabindex="-1"></a>    <span class="at">PC1 =</span> <span class="dv">9</span>,</span>
<span id="cb177-109"><a href="source-code.html#cb177-109" tabindex="-1"></a>    <span class="at">PC2 =</span> <span class="dv">10</span>,</span>
<span id="cb177-110"><a href="source-code.html#cb177-110" tabindex="-1"></a>    <span class="at">plot =</span> F</span>
<span id="cb177-111"><a href="source-code.html#cb177-111" tabindex="-1"></a>  )</span>
<span id="cb177-112"><a href="source-code.html#cb177-112" tabindex="-1"></a>  </span>
<span id="cb177-113"><a href="source-code.html#cb177-113" tabindex="-1"></a>  </span>
<span id="cb177-114"><a href="source-code.html#cb177-114" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(df12, df34, df56, df78, df910)</span>
<span id="cb177-115"><a href="source-code.html#cb177-115" tabindex="-1"></a>  </span>
<span id="cb177-116"><a href="source-code.html#cb177-116" tabindex="-1"></a>  </span>
<span id="cb177-117"><a href="source-code.html#cb177-117" tabindex="-1"></a>  <span class="cf">if</span> (normalize) {</span>
<span id="cb177-118"><a href="source-code.html#cb177-118" tabindex="-1"></a>    <span class="co"># extract variance explained for each pca</span></span>
<span id="cb177-119"><a href="source-code.html#cb177-119" tabindex="-1"></a>    pca_var <span class="ot">&lt;-</span></span>
<span id="cb177-120"><a href="source-code.html#cb177-120" tabindex="-1"></a>      <span class="fu">as.numeric</span>(<span class="fu">str_match</span>(<span class="fu">colnames</span>(df), <span class="st">&quot;</span><span class="sc">\\</span><span class="st">(</span><span class="sc">\\</span><span class="st">s*(.*?)</span><span class="sc">\\</span><span class="st">s*%&quot;</span>)[, <span class="dv">2</span>])</span>
<span id="cb177-121"><a href="source-code.html#cb177-121" tabindex="-1"></a>    </span>
<span id="cb177-122"><a href="source-code.html#cb177-122" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pca_var)) {</span>
<span id="cb177-123"><a href="source-code.html#cb177-123" tabindex="-1"></a>      <span class="co"># calculate normalized pca values</span></span>
<span id="cb177-124"><a href="source-code.html#cb177-124" tabindex="-1"></a>      norm_pca <span class="ot">&lt;-</span> df[, i] <span class="sc">/</span> <span class="dv">100</span> <span class="sc">*</span> pca_var[i]</span>
<span id="cb177-125"><a href="source-code.html#cb177-125" tabindex="-1"></a>      <span class="co">#repopulate the dataframe</span></span>
<span id="cb177-126"><a href="source-code.html#cb177-126" tabindex="-1"></a>      df[, i] <span class="ot">&lt;-</span> norm_pca</span>
<span id="cb177-127"><a href="source-code.html#cb177-127" tabindex="-1"></a>    }</span>
<span id="cb177-128"><a href="source-code.html#cb177-128" tabindex="-1"></a>    </span>
<span id="cb177-129"><a href="source-code.html#cb177-129" tabindex="-1"></a>    </span>
<span id="cb177-130"><a href="source-code.html#cb177-130" tabindex="-1"></a>    </span>
<span id="cb177-131"><a href="source-code.html#cb177-131" tabindex="-1"></a>    </span>
<span id="cb177-132"><a href="source-code.html#cb177-132" tabindex="-1"></a>    </span>
<span id="cb177-133"><a href="source-code.html#cb177-133" tabindex="-1"></a>  }</span>
<span id="cb177-134"><a href="source-code.html#cb177-134" tabindex="-1"></a>  </span>
<span id="cb177-135"><a href="source-code.html#cb177-135" tabindex="-1"></a>  <span class="co">#check best k for k-means clustering method</span></span>
<span id="cb177-136"><a href="source-code.html#cb177-136" tabindex="-1"></a>  <span class="cf">if</span> (return_elbow) {</span>
<span id="cb177-137"><a href="source-code.html#cb177-137" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">fviz_nbclust</span>(df, kmeans, <span class="at">method =</span> <span class="st">&quot;silhouette&quot;</span>) <span class="sc">+</span></span>
<span id="cb177-138"><a href="source-code.html#cb177-138" tabindex="-1"></a>             <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Elbow method&quot;</span>))</span>
<span id="cb177-139"><a href="source-code.html#cb177-139" tabindex="-1"></a>    </span>
<span id="cb177-140"><a href="source-code.html#cb177-140" tabindex="-1"></a>  }</span>
<span id="cb177-141"><a href="source-code.html#cb177-141" tabindex="-1"></a>  </span>
<span id="cb177-142"><a href="source-code.html#cb177-142" tabindex="-1"></a>  <span class="co"># #</span></span>
<span id="cb177-143"><a href="source-code.html#cb177-143" tabindex="-1"></a>  <span class="co"># fviz_nbclust(df, kmeans, method = &quot;silhouette&quot;)+</span></span>
<span id="cb177-144"><a href="source-code.html#cb177-144" tabindex="-1"></a>  <span class="co">#   labs(subtitle = &quot;Silhouette method&quot;)</span></span>
<span id="cb177-145"><a href="source-code.html#cb177-145" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb177-146"><a href="source-code.html#cb177-146" tabindex="-1"></a>  <span class="co"># fviz_nbclust(df, kmeans, nstart = 25,  method = &quot;gap_stat&quot;, nboot = 50)+</span></span>
<span id="cb177-147"><a href="source-code.html#cb177-147" tabindex="-1"></a>  <span class="co">#   labs(subtitle = &quot;Gap statistic method&quot;)</span></span>
<span id="cb177-148"><a href="source-code.html#cb177-148" tabindex="-1"></a>  </span>
<span id="cb177-149"><a href="source-code.html#cb177-149" tabindex="-1"></a>  <span class="co"># compute k-means clustering</span></span>
<span id="cb177-150"><a href="source-code.html#cb177-150" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb177-151"><a href="source-code.html#cb177-151" tabindex="-1"></a>  res.km <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(df, cluster_n, <span class="at">nstart =</span> <span class="dv">1000</span>)</span>
<span id="cb177-152"><a href="source-code.html#cb177-152" tabindex="-1"></a>  </span>
<span id="cb177-153"><a href="source-code.html#cb177-153" tabindex="-1"></a>  <span class="co"># change colnames so it works for our plot</span></span>
<span id="cb177-154"><a href="source-code.html#cb177-154" tabindex="-1"></a>  df12<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(<span class="fu">rownames</span>(df12),  <span class="st">&#39;KRA-0</span><span class="sc">\\</span><span class="st">d+&#39;</span>)</span>
<span id="cb177-155"><a href="source-code.html#cb177-155" tabindex="-1"></a>  num <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(<span class="fu">rownames</span>(df),  <span class="st">&#39;_</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.&#39;</span>)</span>
<span id="cb177-156"><a href="source-code.html#cb177-156" tabindex="-1"></a>  num <span class="ot">&lt;-</span> <span class="fu">str_remove_all</span>(num, <span class="at">pattern =</span> <span class="st">&#39;</span><span class="sc">\\</span><span class="st">.&#39;</span>)</span>
<span id="cb177-157"><a href="source-code.html#cb177-157" tabindex="-1"></a>  df12<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">paste0</span>(df12<span class="sc">$</span>class, num)</span>
<span id="cb177-158"><a href="source-code.html#cb177-158" tabindex="-1"></a>  pc1 <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df12)[<span class="dv">1</span>]</span>
<span id="cb177-159"><a href="source-code.html#cb177-159" tabindex="-1"></a>  pc2 <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df12)[<span class="dv">2</span>]</span>
<span id="cb177-160"><a href="source-code.html#cb177-160" tabindex="-1"></a>  </span>
<span id="cb177-161"><a href="source-code.html#cb177-161" tabindex="-1"></a>  <span class="fu">colnames</span>(df12) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;PC1&#39;</span>, <span class="st">&#39;PC2&#39;</span>, <span class="st">&#39;class&#39;</span>, <span class="st">&#39;label&#39;</span>)</span>
<span id="cb177-162"><a href="source-code.html#cb177-162" tabindex="-1"></a>  </span>
<span id="cb177-163"><a href="source-code.html#cb177-163" tabindex="-1"></a>  <span class="co"># plot nicely</span></span>
<span id="cb177-164"><a href="source-code.html#cb177-164" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df12, <span class="fu">aes</span>(<span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb177-165"><a href="source-code.html#cb177-165" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">1.0</span>,</span>
<span id="cb177-166"><a href="source-code.html#cb177-166" tabindex="-1"></a>               <span class="fu">aes</span>(</span>
<span id="cb177-167"><a href="source-code.html#cb177-167" tabindex="-1"></a>                 <span class="at">x =</span> PC1,</span>
<span id="cb177-168"><a href="source-code.html#cb177-168" tabindex="-1"></a>                 <span class="at">y =</span> PC2,</span>
<span id="cb177-169"><a href="source-code.html#cb177-169" tabindex="-1"></a>                 <span class="at">col =</span> <span class="fu">as.factor</span>(res.km<span class="sc">$</span>cluster)</span>
<span id="cb177-170"><a href="source-code.html#cb177-170" tabindex="-1"></a>               )) <span class="sc">+</span></span>
<span id="cb177-171"><a href="source-code.html#cb177-171" tabindex="-1"></a>    </span>
<span id="cb177-172"><a href="source-code.html#cb177-172" tabindex="-1"></a>    </span>
<span id="cb177-173"><a href="source-code.html#cb177-173" tabindex="-1"></a>    <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb177-174"><a href="source-code.html#cb177-174" tabindex="-1"></a>    </span>
<span id="cb177-175"><a href="source-code.html#cb177-175" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> pc1, <span class="at">y =</span> pc2) <span class="sc">+</span></span>
<span id="cb177-176"><a href="source-code.html#cb177-176" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">labels =</span> labels,</span>
<span id="cb177-177"><a href="source-code.html#cb177-177" tabindex="-1"></a>                       <span class="at">values =</span> cols,</span>
<span id="cb177-178"><a href="source-code.html#cb177-178" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">&quot;Clone&quot;</span>) <span class="sc">+</span></span>
<span id="cb177-179"><a href="source-code.html#cb177-179" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> legend_position,</span>
<span id="cb177-180"><a href="source-code.html#cb177-180" tabindex="-1"></a>          <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>),</span>
<span id="cb177-181"><a href="source-code.html#cb177-181" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>)) </span>
<span id="cb177-182"><a href="source-code.html#cb177-182" tabindex="-1"></a>  </span>
<span id="cb177-183"><a href="source-code.html#cb177-183" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb177-184"><a href="source-code.html#cb177-184" tabindex="-1"></a>  </span>
<span id="cb177-185"><a href="source-code.html#cb177-185" tabindex="-1"></a>  <span class="co">#ggplotly(p)</span></span>
<span id="cb177-186"><a href="source-code.html#cb177-186" tabindex="-1"></a>  </span>
<span id="cb177-187"><a href="source-code.html#cb177-187" tabindex="-1"></a>}</span>
<span id="cb177-188"><a href="source-code.html#cb177-188" tabindex="-1"></a></span>
<span id="cb177-189"><a href="source-code.html#cb177-189" tabindex="-1"></a>draw_pca_double <span class="ot">&lt;-</span></span>
<span id="cb177-190"><a href="source-code.html#cb177-190" tabindex="-1"></a>  <span class="cf">function</span>(list_files1,</span>
<span id="cb177-191"><a href="source-code.html#cb177-191" tabindex="-1"></a>           list_files2,</span>
<span id="cb177-192"><a href="source-code.html#cb177-192" tabindex="-1"></a>           list_files3,</span>
<span id="cb177-193"><a href="source-code.html#cb177-193" tabindex="-1"></a>           size,</span>
<span id="cb177-194"><a href="source-code.html#cb177-194" tabindex="-1"></a>           legend_position) {</span>
<span id="cb177-195"><a href="source-code.html#cb177-195" tabindex="-1"></a>    cells <span class="ot">&lt;-</span> <span class="fu">c</span>(list_files1, list_files2, list_files3)</span>
<span id="cb177-196"><a href="source-code.html#cb177-196" tabindex="-1"></a>    </span>
<span id="cb177-197"><a href="source-code.html#cb177-197" tabindex="-1"></a>    </span>
<span id="cb177-198"><a href="source-code.html#cb177-198" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">plot_pca</span>(</span>
<span id="cb177-199"><a href="source-code.html#cb177-199" tabindex="-1"></a>      cells,</span>
<span id="cb177-200"><a href="source-code.html#cb177-200" tabindex="-1"></a>      <span class="at">colorBy =</span> classes,</span>
<span id="cb177-201"><a href="source-code.html#cb177-201" tabindex="-1"></a>      <span class="at">PC1 =</span> <span class="dv">1</span>,</span>
<span id="cb177-202"><a href="source-code.html#cb177-202" tabindex="-1"></a>      <span class="at">PC2 =</span> <span class="dv">2</span>,</span>
<span id="cb177-203"><a href="source-code.html#cb177-203" tabindex="-1"></a>      <span class="at">plot =</span> F</span>
<span id="cb177-204"><a href="source-code.html#cb177-204" tabindex="-1"></a>    )</span>
<span id="cb177-205"><a href="source-code.html#cb177-205" tabindex="-1"></a>    </span>
<span id="cb177-206"><a href="source-code.html#cb177-206" tabindex="-1"></a>    df<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(<span class="fu">rownames</span>(df),  <span class="st">&#39;KRA-0</span><span class="sc">\\</span><span class="st">d+&#39;</span>)</span>
<span id="cb177-207"><a href="source-code.html#cb177-207" tabindex="-1"></a>    num <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(<span class="fu">rownames</span>(df),  <span class="st">&#39;_</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.&#39;</span>)</span>
<span id="cb177-208"><a href="source-code.html#cb177-208" tabindex="-1"></a>    num <span class="ot">&lt;-</span> <span class="fu">str_remove_all</span>(num, <span class="at">pattern =</span> <span class="st">&#39;</span><span class="sc">\\</span><span class="st">.&#39;</span>)</span>
<span id="cb177-209"><a href="source-code.html#cb177-209" tabindex="-1"></a>    df<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">paste0</span>(df<span class="sc">$</span>class, num)</span>
<span id="cb177-210"><a href="source-code.html#cb177-210" tabindex="-1"></a>    pc1 <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df)[<span class="dv">1</span>]</span>
<span id="cb177-211"><a href="source-code.html#cb177-211" tabindex="-1"></a>    pc2 <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df)[<span class="dv">2</span>]</span>
<span id="cb177-212"><a href="source-code.html#cb177-212" tabindex="-1"></a>    </span>
<span id="cb177-213"><a href="source-code.html#cb177-213" tabindex="-1"></a>    <span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;PC1&#39;</span>, <span class="st">&#39;PC2&#39;</span>, <span class="st">&#39;class&#39;</span>, <span class="st">&#39;label&#39;</span>)</span>
<span id="cb177-214"><a href="source-code.html#cb177-214" tabindex="-1"></a>    </span>
<span id="cb177-215"><a href="source-code.html#cb177-215" tabindex="-1"></a>    </span>
<span id="cb177-216"><a href="source-code.html#cb177-216" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb177-217"><a href="source-code.html#cb177-217" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">size =</span> size, <span class="fu">aes</span>(<span class="at">x =</span> PC1,</span>
<span id="cb177-218"><a href="source-code.html#cb177-218" tabindex="-1"></a>                                  <span class="at">y =</span> PC2,</span>
<span id="cb177-219"><a href="source-code.html#cb177-219" tabindex="-1"></a>                                  <span class="at">col =</span> class)) <span class="sc">+</span></span>
<span id="cb177-220"><a href="source-code.html#cb177-220" tabindex="-1"></a>      <span class="co"># scale_color_manual(values = c(&quot;#FFDB6D&quot;, &quot;#00AFBB&quot;)) +</span></span>
<span id="cb177-221"><a href="source-code.html#cb177-221" tabindex="-1"></a>      <span class="fu">scale_color_manual</span>(</span>
<span id="cb177-222"><a href="source-code.html#cb177-222" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb177-223"><a href="source-code.html#cb177-223" tabindex="-1"></a>        <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#999999&quot;</span>, <span class="st">&quot;#D69C4E&quot;</span>, <span class="st">&#39;#d65c4e&#39;</span>),</span>
<span id="cb177-224"><a href="source-code.html#cb177-224" tabindex="-1"></a>        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&#39;Baseline&#39;</span>, <span class="st">&#39;Recurrence Cycle 1&#39;</span>, <span class="st">&#39;Recurrence Cycle 2&#39;</span>)</span>
<span id="cb177-225"><a href="source-code.html#cb177-225" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb177-226"><a href="source-code.html#cb177-226" tabindex="-1"></a>      </span>
<span id="cb177-227"><a href="source-code.html#cb177-227" tabindex="-1"></a>      <span class="co"># or consider &#39;#9e1303&#39; for second cycle of recurrence</span></span>
<span id="cb177-228"><a href="source-code.html#cb177-228" tabindex="-1"></a>      </span>
<span id="cb177-229"><a href="source-code.html#cb177-229" tabindex="-1"></a>      <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb177-230"><a href="source-code.html#cb177-230" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> legend_position,</span>
<span id="cb177-231"><a href="source-code.html#cb177-231" tabindex="-1"></a>            <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>),</span>
<span id="cb177-232"><a href="source-code.html#cb177-232" tabindex="-1"></a>            <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>)) <span class="sc">+</span></span>
<span id="cb177-233"><a href="source-code.html#cb177-233" tabindex="-1"></a>      </span>
<span id="cb177-234"><a href="source-code.html#cb177-234" tabindex="-1"></a>      </span>
<span id="cb177-235"><a href="source-code.html#cb177-235" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> pc1, <span class="at">y =</span> pc2)</span>
<span id="cb177-236"><a href="source-code.html#cb177-236" tabindex="-1"></a>    <span class="fu">return</span>(p)</span>
<span id="cb177-237"><a href="source-code.html#cb177-237" tabindex="-1"></a>    </span>
<span id="cb177-238"><a href="source-code.html#cb177-238" tabindex="-1"></a>    <span class="co"># ggplotly(p)</span></span>
<span id="cb177-239"><a href="source-code.html#cb177-239" tabindex="-1"></a>    </span>
<span id="cb177-240"><a href="source-code.html#cb177-240" tabindex="-1"></a>  }</span>
<span id="cb177-241"><a href="source-code.html#cb177-241" tabindex="-1"></a></span>
<span id="cb177-242"><a href="source-code.html#cb177-242" tabindex="-1"></a></span>
<span id="cb177-243"><a href="source-code.html#cb177-243" tabindex="-1"></a>k_cluster_double <span class="ot">&lt;-</span> <span class="cf">function</span>(list_files1,</span>
<span id="cb177-244"><a href="source-code.html#cb177-244" tabindex="-1"></a>                             list_files2,</span>
<span id="cb177-245"><a href="source-code.html#cb177-245" tabindex="-1"></a>                             list_files3,</span>
<span id="cb177-246"><a href="source-code.html#cb177-246" tabindex="-1"></a>                             </span>
<span id="cb177-247"><a href="source-code.html#cb177-247" tabindex="-1"></a>                             cluster_n,</span>
<span id="cb177-248"><a href="source-code.html#cb177-248" tabindex="-1"></a>                             cols,</span>
<span id="cb177-249"><a href="source-code.html#cb177-249" tabindex="-1"></a>                             labels,</span>
<span id="cb177-250"><a href="source-code.html#cb177-250" tabindex="-1"></a>                             legend_position,</span>
<span id="cb177-251"><a href="source-code.html#cb177-251" tabindex="-1"></a>                             normalize,</span>
<span id="cb177-252"><a href="source-code.html#cb177-252" tabindex="-1"></a>                             <span class="at">return_elbow =</span> F) {</span>
<span id="cb177-253"><a href="source-code.html#cb177-253" tabindex="-1"></a>  </span>
<span id="cb177-254"><a href="source-code.html#cb177-254" tabindex="-1"></a>  <span class="fu">require</span>(factoextra)</span>
<span id="cb177-255"><a href="source-code.html#cb177-255" tabindex="-1"></a>  </span>
<span id="cb177-256"><a href="source-code.html#cb177-256" tabindex="-1"></a>  cells <span class="ot">&lt;-</span> <span class="fu">c</span>(list_files1, list_files2, list_files3)</span>
<span id="cb177-257"><a href="source-code.html#cb177-257" tabindex="-1"></a>  </span>
<span id="cb177-258"><a href="source-code.html#cb177-258" tabindex="-1"></a>  </span>
<span id="cb177-259"><a href="source-code.html#cb177-259" tabindex="-1"></a>  df12 <span class="ot">&lt;-</span> <span class="fu">plot_pca</span>(</span>
<span id="cb177-260"><a href="source-code.html#cb177-260" tabindex="-1"></a>    cells,</span>
<span id="cb177-261"><a href="source-code.html#cb177-261" tabindex="-1"></a>    <span class="at">colorBy =</span> classes,</span>
<span id="cb177-262"><a href="source-code.html#cb177-262" tabindex="-1"></a>    <span class="at">PC1 =</span> <span class="dv">1</span>,</span>
<span id="cb177-263"><a href="source-code.html#cb177-263" tabindex="-1"></a>    <span class="at">PC2 =</span> <span class="dv">2</span>,</span>
<span id="cb177-264"><a href="source-code.html#cb177-264" tabindex="-1"></a>    <span class="at">plot =</span> F</span>
<span id="cb177-265"><a href="source-code.html#cb177-265" tabindex="-1"></a>  )</span>
<span id="cb177-266"><a href="source-code.html#cb177-266" tabindex="-1"></a>  </span>
<span id="cb177-267"><a href="source-code.html#cb177-267" tabindex="-1"></a>  </span>
<span id="cb177-268"><a href="source-code.html#cb177-268" tabindex="-1"></a>  df34 <span class="ot">&lt;-</span> <span class="fu">plot_pca</span>(</span>
<span id="cb177-269"><a href="source-code.html#cb177-269" tabindex="-1"></a>    cells,</span>
<span id="cb177-270"><a href="source-code.html#cb177-270" tabindex="-1"></a>    <span class="at">colorBy =</span> classes,</span>
<span id="cb177-271"><a href="source-code.html#cb177-271" tabindex="-1"></a>    <span class="at">PC1 =</span> <span class="dv">3</span>,</span>
<span id="cb177-272"><a href="source-code.html#cb177-272" tabindex="-1"></a>    <span class="at">PC2 =</span> <span class="dv">4</span>,</span>
<span id="cb177-273"><a href="source-code.html#cb177-273" tabindex="-1"></a>    <span class="at">plot =</span> F</span>
<span id="cb177-274"><a href="source-code.html#cb177-274" tabindex="-1"></a>  )</span>
<span id="cb177-275"><a href="source-code.html#cb177-275" tabindex="-1"></a>  </span>
<span id="cb177-276"><a href="source-code.html#cb177-276" tabindex="-1"></a>  df56 <span class="ot">&lt;-</span> <span class="fu">plot_pca</span>(</span>
<span id="cb177-277"><a href="source-code.html#cb177-277" tabindex="-1"></a>    cells,</span>
<span id="cb177-278"><a href="source-code.html#cb177-278" tabindex="-1"></a>    <span class="at">colorBy =</span> classes,</span>
<span id="cb177-279"><a href="source-code.html#cb177-279" tabindex="-1"></a>    <span class="at">PC1 =</span> <span class="dv">5</span>,</span>
<span id="cb177-280"><a href="source-code.html#cb177-280" tabindex="-1"></a>    <span class="at">PC2 =</span> <span class="dv">6</span>,</span>
<span id="cb177-281"><a href="source-code.html#cb177-281" tabindex="-1"></a>    <span class="at">plot =</span> F</span>
<span id="cb177-282"><a href="source-code.html#cb177-282" tabindex="-1"></a>  )</span>
<span id="cb177-283"><a href="source-code.html#cb177-283" tabindex="-1"></a>  </span>
<span id="cb177-284"><a href="source-code.html#cb177-284" tabindex="-1"></a>  df78 <span class="ot">&lt;-</span> <span class="fu">plot_pca</span>(</span>
<span id="cb177-285"><a href="source-code.html#cb177-285" tabindex="-1"></a>    cells,</span>
<span id="cb177-286"><a href="source-code.html#cb177-286" tabindex="-1"></a>    <span class="at">colorBy =</span> classes,</span>
<span id="cb177-287"><a href="source-code.html#cb177-287" tabindex="-1"></a>    <span class="at">PC1 =</span> <span class="dv">7</span>,</span>
<span id="cb177-288"><a href="source-code.html#cb177-288" tabindex="-1"></a>    <span class="at">PC2 =</span> <span class="dv">8</span>,</span>
<span id="cb177-289"><a href="source-code.html#cb177-289" tabindex="-1"></a>    <span class="at">plot =</span> F</span>
<span id="cb177-290"><a href="source-code.html#cb177-290" tabindex="-1"></a>  )</span>
<span id="cb177-291"><a href="source-code.html#cb177-291" tabindex="-1"></a>  </span>
<span id="cb177-292"><a href="source-code.html#cb177-292" tabindex="-1"></a>  df910 <span class="ot">&lt;-</span> <span class="fu">plot_pca</span>(</span>
<span id="cb177-293"><a href="source-code.html#cb177-293" tabindex="-1"></a>    cells,</span>
<span id="cb177-294"><a href="source-code.html#cb177-294" tabindex="-1"></a>    <span class="at">colorBy =</span> classes,</span>
<span id="cb177-295"><a href="source-code.html#cb177-295" tabindex="-1"></a>    <span class="at">PC1 =</span> <span class="dv">9</span>,</span>
<span id="cb177-296"><a href="source-code.html#cb177-296" tabindex="-1"></a>    <span class="at">PC2 =</span> <span class="dv">10</span>,</span>
<span id="cb177-297"><a href="source-code.html#cb177-297" tabindex="-1"></a>    <span class="at">plot =</span> F</span>
<span id="cb177-298"><a href="source-code.html#cb177-298" tabindex="-1"></a>  )</span>
<span id="cb177-299"><a href="source-code.html#cb177-299" tabindex="-1"></a>  </span>
<span id="cb177-300"><a href="source-code.html#cb177-300" tabindex="-1"></a>  </span>
<span id="cb177-301"><a href="source-code.html#cb177-301" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(df12, df34, df56, df78, df910)</span>
<span id="cb177-302"><a href="source-code.html#cb177-302" tabindex="-1"></a>  </span>
<span id="cb177-303"><a href="source-code.html#cb177-303" tabindex="-1"></a>  </span>
<span id="cb177-304"><a href="source-code.html#cb177-304" tabindex="-1"></a>  <span class="cf">if</span> (normalize) {</span>
<span id="cb177-305"><a href="source-code.html#cb177-305" tabindex="-1"></a>    <span class="co"># extract variance explained for each pca</span></span>
<span id="cb177-306"><a href="source-code.html#cb177-306" tabindex="-1"></a>    pca_var <span class="ot">&lt;-</span></span>
<span id="cb177-307"><a href="source-code.html#cb177-307" tabindex="-1"></a>      <span class="fu">as.numeric</span>(<span class="fu">str_match</span>(<span class="fu">colnames</span>(df), <span class="st">&quot;</span><span class="sc">\\</span><span class="st">(</span><span class="sc">\\</span><span class="st">s*(.*?)</span><span class="sc">\\</span><span class="st">s*%&quot;</span>)[, <span class="dv">2</span>])</span>
<span id="cb177-308"><a href="source-code.html#cb177-308" tabindex="-1"></a>    </span>
<span id="cb177-309"><a href="source-code.html#cb177-309" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pca_var)) {</span>
<span id="cb177-310"><a href="source-code.html#cb177-310" tabindex="-1"></a>      <span class="co"># calculate normalized pca values</span></span>
<span id="cb177-311"><a href="source-code.html#cb177-311" tabindex="-1"></a>      norm_pca <span class="ot">&lt;-</span> df[, i] <span class="sc">/</span> <span class="dv">100</span> <span class="sc">*</span> pca_var[i]</span>
<span id="cb177-312"><a href="source-code.html#cb177-312" tabindex="-1"></a>      <span class="co">#repopulate the dataframe</span></span>
<span id="cb177-313"><a href="source-code.html#cb177-313" tabindex="-1"></a>      df[, i] <span class="ot">&lt;-</span> norm_pca</span>
<span id="cb177-314"><a href="source-code.html#cb177-314" tabindex="-1"></a>    }</span>
<span id="cb177-315"><a href="source-code.html#cb177-315" tabindex="-1"></a>    </span>
<span id="cb177-316"><a href="source-code.html#cb177-316" tabindex="-1"></a>    </span>
<span id="cb177-317"><a href="source-code.html#cb177-317" tabindex="-1"></a>    </span>
<span id="cb177-318"><a href="source-code.html#cb177-318" tabindex="-1"></a>    </span>
<span id="cb177-319"><a href="source-code.html#cb177-319" tabindex="-1"></a>    </span>
<span id="cb177-320"><a href="source-code.html#cb177-320" tabindex="-1"></a>  }</span>
<span id="cb177-321"><a href="source-code.html#cb177-321" tabindex="-1"></a>  </span>
<span id="cb177-322"><a href="source-code.html#cb177-322" tabindex="-1"></a>  <span class="co">#check best k for k-means clustering method</span></span>
<span id="cb177-323"><a href="source-code.html#cb177-323" tabindex="-1"></a>  <span class="cf">if</span> (return_elbow) {</span>
<span id="cb177-324"><a href="source-code.html#cb177-324" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">fviz_nbclust</span>(df, kmeans, <span class="at">method =</span> <span class="st">&quot;silhouette&quot;</span>) <span class="sc">+</span></span>
<span id="cb177-325"><a href="source-code.html#cb177-325" tabindex="-1"></a>             <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Silhouette method&quot;</span>))</span>
<span id="cb177-326"><a href="source-code.html#cb177-326" tabindex="-1"></a>    </span>
<span id="cb177-327"><a href="source-code.html#cb177-327" tabindex="-1"></a>  }</span>
<span id="cb177-328"><a href="source-code.html#cb177-328" tabindex="-1"></a>  </span>
<span id="cb177-329"><a href="source-code.html#cb177-329" tabindex="-1"></a>  <span class="co"># #</span></span>
<span id="cb177-330"><a href="source-code.html#cb177-330" tabindex="-1"></a>  <span class="co"># fviz_nbclust(df, kmeans, method = &quot;silhouette&quot;)+</span></span>
<span id="cb177-331"><a href="source-code.html#cb177-331" tabindex="-1"></a>  <span class="co">#   labs(subtitle = &quot;Silhouette method&quot;)</span></span>
<span id="cb177-332"><a href="source-code.html#cb177-332" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb177-333"><a href="source-code.html#cb177-333" tabindex="-1"></a>  <span class="co"># fviz_nbclust(df, kmeans, nstart = 25,  method = &quot;gap_stat&quot;, nboot = 50)+</span></span>
<span id="cb177-334"><a href="source-code.html#cb177-334" tabindex="-1"></a>  <span class="co">#   labs(subtitle = &quot;Gap statistic method&quot;)</span></span>
<span id="cb177-335"><a href="source-code.html#cb177-335" tabindex="-1"></a>  </span>
<span id="cb177-336"><a href="source-code.html#cb177-336" tabindex="-1"></a>  <span class="co"># compute k-means clustering</span></span>
<span id="cb177-337"><a href="source-code.html#cb177-337" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb177-338"><a href="source-code.html#cb177-338" tabindex="-1"></a>  res.km <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(df, cluster_n, <span class="at">nstart =</span> <span class="dv">1000</span>)</span>
<span id="cb177-339"><a href="source-code.html#cb177-339" tabindex="-1"></a>  </span>
<span id="cb177-340"><a href="source-code.html#cb177-340" tabindex="-1"></a>  <span class="co"># change colnames so it works for our plot</span></span>
<span id="cb177-341"><a href="source-code.html#cb177-341" tabindex="-1"></a>  df12<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(<span class="fu">rownames</span>(df12),  <span class="st">&#39;KRA-0</span><span class="sc">\\</span><span class="st">d+&#39;</span>)</span>
<span id="cb177-342"><a href="source-code.html#cb177-342" tabindex="-1"></a>  num <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(<span class="fu">rownames</span>(df),  <span class="st">&#39;_</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.&#39;</span>)</span>
<span id="cb177-343"><a href="source-code.html#cb177-343" tabindex="-1"></a>  num <span class="ot">&lt;-</span> <span class="fu">str_remove_all</span>(num, <span class="at">pattern =</span> <span class="st">&#39;</span><span class="sc">\\</span><span class="st">.&#39;</span>)</span>
<span id="cb177-344"><a href="source-code.html#cb177-344" tabindex="-1"></a>  df12<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">paste0</span>(df12<span class="sc">$</span>class, num)</span>
<span id="cb177-345"><a href="source-code.html#cb177-345" tabindex="-1"></a>  pc1 <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df12)[<span class="dv">1</span>]</span>
<span id="cb177-346"><a href="source-code.html#cb177-346" tabindex="-1"></a>  pc2 <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df12)[<span class="dv">2</span>]</span>
<span id="cb177-347"><a href="source-code.html#cb177-347" tabindex="-1"></a>  </span>
<span id="cb177-348"><a href="source-code.html#cb177-348" tabindex="-1"></a>  <span class="fu">colnames</span>(df12) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;PC1&#39;</span>, <span class="st">&#39;PC2&#39;</span>, <span class="st">&#39;class&#39;</span>, <span class="st">&#39;label&#39;</span>)</span>
<span id="cb177-349"><a href="source-code.html#cb177-349" tabindex="-1"></a>  </span>
<span id="cb177-350"><a href="source-code.html#cb177-350" tabindex="-1"></a>  <span class="co"># plot nicely</span></span>
<span id="cb177-351"><a href="source-code.html#cb177-351" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df12, <span class="fu">aes</span>(<span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb177-352"><a href="source-code.html#cb177-352" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">1.0</span>,</span>
<span id="cb177-353"><a href="source-code.html#cb177-353" tabindex="-1"></a>               <span class="fu">aes</span>(</span>
<span id="cb177-354"><a href="source-code.html#cb177-354" tabindex="-1"></a>                 <span class="at">x =</span> PC1,</span>
<span id="cb177-355"><a href="source-code.html#cb177-355" tabindex="-1"></a>                 <span class="at">y =</span> PC2,</span>
<span id="cb177-356"><a href="source-code.html#cb177-356" tabindex="-1"></a>                 <span class="at">col =</span> <span class="fu">as.factor</span>(res.km<span class="sc">$</span>cluster)</span>
<span id="cb177-357"><a href="source-code.html#cb177-357" tabindex="-1"></a>               )) <span class="sc">+</span></span>
<span id="cb177-358"><a href="source-code.html#cb177-358" tabindex="-1"></a>    </span>
<span id="cb177-359"><a href="source-code.html#cb177-359" tabindex="-1"></a>    </span>
<span id="cb177-360"><a href="source-code.html#cb177-360" tabindex="-1"></a>    <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb177-361"><a href="source-code.html#cb177-361" tabindex="-1"></a>    </span>
<span id="cb177-362"><a href="source-code.html#cb177-362" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> pc1, <span class="at">y =</span> pc2) <span class="sc">+</span></span>
<span id="cb177-363"><a href="source-code.html#cb177-363" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">labels =</span> labels,</span>
<span id="cb177-364"><a href="source-code.html#cb177-364" tabindex="-1"></a>                       <span class="at">values =</span> cols,</span>
<span id="cb177-365"><a href="source-code.html#cb177-365" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">&quot;Clone&quot;</span>) <span class="sc">+</span></span>
<span id="cb177-366"><a href="source-code.html#cb177-366" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> legend_position,</span>
<span id="cb177-367"><a href="source-code.html#cb177-367" tabindex="-1"></a>          <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>),</span>
<span id="cb177-368"><a href="source-code.html#cb177-368" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>)) </span>
<span id="cb177-369"><a href="source-code.html#cb177-369" tabindex="-1"></a>  </span>
<span id="cb177-370"><a href="source-code.html#cb177-370" tabindex="-1"></a>  p</span>
<span id="cb177-371"><a href="source-code.html#cb177-371" tabindex="-1"></a>  </span>
<span id="cb177-372"><a href="source-code.html#cb177-372" tabindex="-1"></a>}</span>
<span id="cb177-373"><a href="source-code.html#cb177-373" tabindex="-1"></a></span>
<span id="cb177-374"><a href="source-code.html#cb177-374" tabindex="-1"></a>  </span>
<span id="cb177-375"><a href="source-code.html#cb177-375" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
</div>
<div id="divide_subclone_functions-script-extract_other_cells-extract_square-l_g-and-subclone_classes_for_genomeheatmap-functions" class="section level2 hasAnchor" number="6.7">
<h2><span class="header-section-number">6.7</span> divide_subclone_functions script: ‘extract_other_cells’, ‘extract_square’, ‘l_g’ and ‘subclone_classes_for_genomeheatmap’ functions<a href="source-code.html#divide_subclone_functions-script-extract_other_cells-extract_square-l_g-and-subclone_classes_for_genomeheatmap-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="source-code.html#cb178-1" tabindex="-1"></a>extract_other_cells <span class="ot">&lt;-</span> <span class="cf">function</span>(kra_name, list_of_subclones) {</span>
<span id="cb178-2"><a href="source-code.html#cb178-2" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">names</span>(man_select_files_edivisive) <span class="sc">==</span> kra_name)</span>
<span id="cb178-3"><a href="source-code.html#cb178-3" tabindex="-1"></a>  all <span class="ot">&lt;-</span>  <span class="fu">str_extract</span>(man_select_files_edivisive[[i]],  <span class="st">&#39;_</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">&#39;_&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">&#39;</span><span class="sc">\\</span><span class="st">.&#39;</span>) </span>
<span id="cb178-4"><a href="source-code.html#cb178-4" tabindex="-1"></a>  rest <span class="ot">&lt;-</span> all[<span class="fu">which</span>(<span class="sc">!</span>all <span class="sc">%in%</span> list_of_subclones)]</span>
<span id="cb178-5"><a href="source-code.html#cb178-5" tabindex="-1"></a>  <span class="fu">return</span>(rest)</span>
<span id="cb178-6"><a href="source-code.html#cb178-6" tabindex="-1"></a>}</span>
<span id="cb178-7"><a href="source-code.html#cb178-7" tabindex="-1"></a></span>
<span id="cb178-8"><a href="source-code.html#cb178-8" tabindex="-1"></a></span>
<span id="cb178-9"><a href="source-code.html#cb178-9" tabindex="-1"></a>extract_square <span class="ot">&lt;-</span> <span class="cf">function</span>(list_files1, list_files2, square, x, y) {</span>
<span id="cb178-10"><a href="source-code.html#cb178-10" tabindex="-1"></a>  <span class="co"># extracts all cells that lie within a square of a pca plot defined by </span></span>
<span id="cb178-11"><a href="source-code.html#cb178-11" tabindex="-1"></a>  <span class="co"># user. For example square c(0.1, 0.0) will extract all cells with</span></span>
<span id="cb178-12"><a href="source-code.html#cb178-12" tabindex="-1"></a>  <span class="co"># pc1 lower or higher that 0.1 and pc2 lower or higher than 0.0. User has to rearange functon</span></span>
<span id="cb178-13"><a href="source-code.html#cb178-13" tabindex="-1"></a>  <span class="co"># if he wants x lower or higher than 0.1</span></span>
<span id="cb178-14"><a href="source-code.html#cb178-14" tabindex="-1"></a>  cells <span class="ot">&lt;-</span> <span class="fu">c</span>(list_files1, list_files2)</span>
<span id="cb178-15"><a href="source-code.html#cb178-15" tabindex="-1"></a>  </span>
<span id="cb178-16"><a href="source-code.html#cb178-16" tabindex="-1"></a>  df12 <span class="ot">&lt;-</span> <span class="fu">plot_pca</span>(cells,</span>
<span id="cb178-17"><a href="source-code.html#cb178-17" tabindex="-1"></a>                   <span class="at">colorBy =</span> classes, </span>
<span id="cb178-18"><a href="source-code.html#cb178-18" tabindex="-1"></a>                   <span class="at">PC1=</span><span class="dv">1</span>, </span>
<span id="cb178-19"><a href="source-code.html#cb178-19" tabindex="-1"></a>                   <span class="at">PC2=</span><span class="dv">2</span>,</span>
<span id="cb178-20"><a href="source-code.html#cb178-20" tabindex="-1"></a>                   <span class="at">plot =</span> F)</span>
<span id="cb178-21"><a href="source-code.html#cb178-21" tabindex="-1"></a>  </span>
<span id="cb178-22"><a href="source-code.html#cb178-22" tabindex="-1"></a>  <span class="fu">colnames</span>(df12) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;PC1&#39;</span>, <span class="st">&#39;PC2&#39;</span>)</span>
<span id="cb178-23"><a href="source-code.html#cb178-23" tabindex="-1"></a>  </span>
<span id="cb178-24"><a href="source-code.html#cb178-24" tabindex="-1"></a>  </span>
<span id="cb178-25"><a href="source-code.html#cb178-25" tabindex="-1"></a>  <span class="co"># extracting dataframe with correct square</span></span>
<span id="cb178-26"><a href="source-code.html#cb178-26" tabindex="-1"></a>  <span class="cf">if</span>(x <span class="sc">==</span> <span class="st">&#39;&lt;&#39;</span> <span class="sc">&amp;</span> y <span class="sc">==</span> <span class="st">&#39;&lt;&#39;</span>) {</span>
<span id="cb178-27"><a href="source-code.html#cb178-27" tabindex="-1"></a>    df12 <span class="ot">&lt;-</span> <span class="fu">subset</span>(df12, PC1 <span class="sc">&lt;</span> square[<span class="dv">1</span>] <span class="sc">&amp;</span> PC2 <span class="sc">&lt;</span> square[<span class="dv">2</span>])</span>
<span id="cb178-28"><a href="source-code.html#cb178-28" tabindex="-1"></a>  }</span>
<span id="cb178-29"><a href="source-code.html#cb178-29" tabindex="-1"></a>  </span>
<span id="cb178-30"><a href="source-code.html#cb178-30" tabindex="-1"></a>  <span class="cf">if</span>(x <span class="sc">==</span> <span class="st">&#39;&lt;&#39;</span> <span class="sc">&amp;</span> y <span class="sc">==</span> <span class="st">&#39;&gt;&#39;</span>) {</span>
<span id="cb178-31"><a href="source-code.html#cb178-31" tabindex="-1"></a>    df12 <span class="ot">&lt;-</span> <span class="fu">subset</span>(df12, PC1 <span class="sc">&lt;</span> square[<span class="dv">1</span>] <span class="sc">&amp;</span> PC2 <span class="sc">&gt;</span> square[<span class="dv">2</span>])</span>
<span id="cb178-32"><a href="source-code.html#cb178-32" tabindex="-1"></a>  }</span>
<span id="cb178-33"><a href="source-code.html#cb178-33" tabindex="-1"></a>  </span>
<span id="cb178-34"><a href="source-code.html#cb178-34" tabindex="-1"></a>  <span class="cf">if</span>(x <span class="sc">==</span> <span class="st">&#39;&gt;&#39;</span> <span class="sc">&amp;</span> y <span class="sc">==</span> <span class="st">&#39;&lt;&#39;</span>) {</span>
<span id="cb178-35"><a href="source-code.html#cb178-35" tabindex="-1"></a>    df12 <span class="ot">&lt;-</span> <span class="fu">subset</span>(df12, PC1 <span class="sc">&gt;</span> square[<span class="dv">1</span>] <span class="sc">&amp;</span> PC2 <span class="sc">&lt;</span> square[<span class="dv">2</span>])</span>
<span id="cb178-36"><a href="source-code.html#cb178-36" tabindex="-1"></a>  }</span>
<span id="cb178-37"><a href="source-code.html#cb178-37" tabindex="-1"></a>  </span>
<span id="cb178-38"><a href="source-code.html#cb178-38" tabindex="-1"></a>  <span class="cf">if</span>(x <span class="sc">==</span> <span class="st">&#39;&gt;&#39;</span> <span class="sc">&amp;</span> y <span class="sc">==</span> <span class="st">&#39;&gt;&#39;</span>) {</span>
<span id="cb178-39"><a href="source-code.html#cb178-39" tabindex="-1"></a>    df12 <span class="ot">&lt;-</span> <span class="fu">subset</span>(df12, PC1 <span class="sc">&gt;</span> square[<span class="dv">1</span>] <span class="sc">&amp;</span> PC2 <span class="sc">&gt;</span> square[<span class="dv">2</span>])</span>
<span id="cb178-40"><a href="source-code.html#cb178-40" tabindex="-1"></a>  }</span>
<span id="cb178-41"><a href="source-code.html#cb178-41" tabindex="-1"></a>  </span>
<span id="cb178-42"><a href="source-code.html#cb178-42" tabindex="-1"></a>  <span class="co"># numbers is: </span></span>
<span id="cb178-43"><a href="source-code.html#cb178-43" tabindex="-1"></a>  cell_id <span class="ot">&lt;-</span>  <span class="fu">str_extract</span>(<span class="fu">rownames</span>(df12),  <span class="st">&#39;_</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">&#39;_&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">&#39;</span><span class="sc">\\</span><span class="st">.&#39;</span>)  </span>
<span id="cb178-44"><a href="source-code.html#cb178-44" tabindex="-1"></a>  </span>
<span id="cb178-45"><a href="source-code.html#cb178-45" tabindex="-1"></a>  <span class="fu">return</span>(cell_id)</span>
<span id="cb178-46"><a href="source-code.html#cb178-46" tabindex="-1"></a>  </span>
<span id="cb178-47"><a href="source-code.html#cb178-47" tabindex="-1"></a>}</span>
<span id="cb178-48"><a href="source-code.html#cb178-48" tabindex="-1"></a></span>
<span id="cb178-49"><a href="source-code.html#cb178-49" tabindex="-1"></a>l_g <span class="ot">&lt;-</span> <span class="cf">function</span>(x, kra_num, list_cells) {</span>
<span id="cb178-50"><a href="source-code.html#cb178-50" tabindex="-1"></a>  select <span class="ot">&lt;-</span> <span class="fu">grepl</span>(<span class="fu">paste0</span>(kra_num,<span class="st">&#39;_&#39;</span>,x,<span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>), list_cells)</span>
<span id="cb178-51"><a href="source-code.html#cb178-51" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="fu">which</span>(select)</span>
<span id="cb178-52"><a href="source-code.html#cb178-52" tabindex="-1"></a>  <span class="fu">return</span>(list_cells[i])</span>
<span id="cb178-53"><a href="source-code.html#cb178-53" tabindex="-1"></a>  </span>
<span id="cb178-54"><a href="source-code.html#cb178-54" tabindex="-1"></a>  </span>
<span id="cb178-55"><a href="source-code.html#cb178-55" tabindex="-1"></a>}</span>
<span id="cb178-56"><a href="source-code.html#cb178-56" tabindex="-1"></a></span>
<span id="cb178-57"><a href="source-code.html#cb178-57" tabindex="-1"></a></span>
<span id="cb178-58"><a href="source-code.html#cb178-58" tabindex="-1"></a>subclone_classes_for_genomeheatmap <span class="ot">&lt;-</span> <span class="cf">function</span>(list_of_subclones, cline) {</span>
<span id="cb178-59"><a href="source-code.html#cb178-59" tabindex="-1"></a>  <span class="co">#&#39; @param </span></span>
<span id="cb178-60"><a href="source-code.html#cb178-60" tabindex="-1"></a>  <span class="co">#&#39; list of subclones is the full list of rda files that have been assigned a subclone_classes_for_genomeheatmap</span></span>
<span id="cb178-61"><a href="source-code.html#cb178-61" tabindex="-1"></a>  <span class="co">#&#39; cline is the line (hub005, hub183 etc.)</span></span>
<span id="cb178-62"><a href="source-code.html#cb178-62" tabindex="-1"></a>  <span class="co">#&#39; rad is either prerad or rad</span></span>
<span id="cb178-63"><a href="source-code.html#cb178-63" tabindex="-1"></a>  <span class="co">#&#39; @return </span></span>
<span id="cb178-64"><a href="source-code.html#cb178-64" tabindex="-1"></a>  <span class="co">#&#39; returns a vector with that assigns a subclone</span></span>
<span id="cb178-65"><a href="source-code.html#cb178-65" tabindex="-1"></a>  </span>
<span id="cb178-66"><a href="source-code.html#cb178-66" tabindex="-1"></a>  extract_subclones <span class="ot">&lt;-</span> list_of_subclones[<span class="fu">grepl</span>(<span class="fu">names</span>(list_of_subclones), <span class="at">pattern =</span> <span class="fu">paste0</span>(cline))]</span>
<span id="cb178-67"><a href="source-code.html#cb178-67" tabindex="-1"></a>  </span>
<span id="cb178-68"><a href="source-code.html#cb178-68" tabindex="-1"></a>  size_subclones <span class="ot">&lt;-</span> <span class="fu">lapply</span>(extract_subclones, length)</span>
<span id="cb178-69"><a href="source-code.html#cb178-69" tabindex="-1"></a>  </span>
<span id="cb178-70"><a href="source-code.html#cb178-70" tabindex="-1"></a>  classes <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">names</span>(size_subclones), size_subclones)</span>
<span id="cb178-71"><a href="source-code.html#cb178-71" tabindex="-1"></a>  </span>
<span id="cb178-72"><a href="source-code.html#cb178-72" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">path =</span> <span class="fu">unlist</span>(extract_subclones),</span>
<span id="cb178-73"><a href="source-code.html#cb178-73" tabindex="-1"></a>                   <span class="at">class =</span> classes)</span>
<span id="cb178-74"><a href="source-code.html#cb178-74" tabindex="-1"></a>  </span>
<span id="cb178-75"><a href="source-code.html#cb178-75" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb178-76"><a href="source-code.html#cb178-76" tabindex="-1"></a>  </span>
<span id="cb178-77"><a href="source-code.html#cb178-77" tabindex="-1"></a>  </span>
<span id="cb178-78"><a href="source-code.html#cb178-78" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="plot_genomeheatmap-script-genomeheatmap-function" class="section level2 hasAnchor" number="6.8">
<h2><span class="header-section-number">6.8</span> plot_genomeheatmap script: ‘genomeheatmap’ function<a href="source-code.html#plot_genomeheatmap-script-genomeheatmap-function" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="source-code.html#cb179-1" tabindex="-1"></a>genomeheatmap <span class="ot">&lt;-</span> <span class="cf">function</span>(selected.files, </span>
<span id="cb179-2"><a href="source-code.html#cb179-2" tabindex="-1"></a>                          path, </span>
<span id="cb179-3"><a href="source-code.html#cb179-3" tabindex="-1"></a>                          <span class="at">classes_daan =</span> <span class="cn">NULL</span>, </span>
<span id="cb179-4"><a href="source-code.html#cb179-4" tabindex="-1"></a>                          <span class="at">class.col =</span> <span class="cn">NULL</span>, </span>
<span id="cb179-5"><a href="source-code.html#cb179-5" tabindex="-1"></a>                          <span class="at">dendogram =</span> F,</span>
<span id="cb179-6"><a href="source-code.html#cb179-6" tabindex="-1"></a>                          <span class="at">daan_colours =</span> T,</span>
<span id="cb179-7"><a href="source-code.html#cb179-7" tabindex="-1"></a>                          name) {</span>
<span id="cb179-8"><a href="source-code.html#cb179-8" tabindex="-1"></a>  <span class="co"># This code was adapted from the AneuFinder package</span></span>
<span id="cb179-9"><a href="source-code.html#cb179-9" tabindex="-1"></a>  <span class="co"># plots and saves genome heatmap of selected.files</span></span>
<span id="cb179-10"><a href="source-code.html#cb179-10" tabindex="-1"></a>  <span class="co"># @param </span></span>
<span id="cb179-11"><a href="source-code.html#cb179-11" tabindex="-1"></a>  <span class="co"># selected.files: vector of location of selected files.</span></span>
<span id="cb179-12"><a href="source-code.html#cb179-12" tabindex="-1"></a>  <span class="co"># output path: path were plots should be saved. </span></span>
<span id="cb179-13"><a href="source-code.html#cb179-13" tabindex="-1"></a>  <span class="co"># name: how you want to name the plot</span></span>
<span id="cb179-14"><a href="source-code.html#cb179-14" tabindex="-1"></a>  </span>
<span id="cb179-15"><a href="source-code.html#cb179-15" tabindex="-1"></a>  <span class="co"># get platename</span></span>
<span id="cb179-16"><a href="source-code.html#cb179-16" tabindex="-1"></a>  platename <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(selected.files[<span class="dv">1</span>],  <span class="st">&#39;KRA-0</span><span class="sc">\\</span><span class="st">d+&#39;</span>)</span>
<span id="cb179-17"><a href="source-code.html#cb179-17" tabindex="-1"></a>  </span>
<span id="cb179-18"><a href="source-code.html#cb179-18" tabindex="-1"></a>  <span class="co"># AneuFinder functions: </span></span>
<span id="cb179-19"><a href="source-code.html#cb179-19" tabindex="-1"></a>  startTimedMessage <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb179-20"><a href="source-code.html#cb179-20" tabindex="-1"></a>    </span>
<span id="cb179-21"><a href="source-code.html#cb179-21" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">paste0</span>(..., <span class="at">collapse=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb179-22"><a href="source-code.html#cb179-22" tabindex="-1"></a>    <span class="fu">message</span>(x, <span class="at">appendLF=</span><span class="cn">FALSE</span>)</span>
<span id="cb179-23"><a href="source-code.html#cb179-23" tabindex="-1"></a>    ptm <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb179-24"><a href="source-code.html#cb179-24" tabindex="-1"></a>    <span class="fu">return</span>(ptm)</span>
<span id="cb179-25"><a href="source-code.html#cb179-25" tabindex="-1"></a>    </span>
<span id="cb179-26"><a href="source-code.html#cb179-26" tabindex="-1"></a>  }</span>
<span id="cb179-27"><a href="source-code.html#cb179-27" tabindex="-1"></a>  </span>
<span id="cb179-28"><a href="source-code.html#cb179-28" tabindex="-1"></a>  transCoord <span class="ot">&lt;-</span> <span class="cf">function</span> (gr) </span>
<span id="cb179-29"><a href="source-code.html#cb179-29" tabindex="-1"></a>  {</span>
<span id="cb179-30"><a href="source-code.html#cb179-30" tabindex="-1"></a>    cum.seqlengths <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(<span class="fu">as.numeric</span>(<span class="fu">seqlengths</span>(gr)))</span>
<span id="cb179-31"><a href="source-code.html#cb179-31" tabindex="-1"></a>    cum.seqlengths<span class="fl">.0</span> <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, cum.seqlengths[<span class="sc">-</span><span class="fu">length</span>(cum.seqlengths)])</span>
<span id="cb179-32"><a href="source-code.html#cb179-32" tabindex="-1"></a>    <span class="fu">names</span>(cum.seqlengths<span class="fl">.0</span>) <span class="ot">&lt;-</span> <span class="fu">seqlevels</span>(gr)</span>
<span id="cb179-33"><a href="source-code.html#cb179-33" tabindex="-1"></a>    gr<span class="sc">$</span>start.genome <span class="ot">&lt;-</span> <span class="fu">start</span>(gr) <span class="sc">+</span> cum.seqlengths<span class="fl">.0</span>[<span class="fu">as.character</span>(<span class="fu">seqnames</span>(gr))]</span>
<span id="cb179-34"><a href="source-code.html#cb179-34" tabindex="-1"></a>    gr<span class="sc">$</span>end.genome <span class="ot">&lt;-</span> <span class="fu">end</span>(gr) <span class="sc">+</span> cum.seqlengths<span class="fl">.0</span>[<span class="fu">as.character</span>(<span class="fu">seqnames</span>(gr))]</span>
<span id="cb179-35"><a href="source-code.html#cb179-35" tabindex="-1"></a>    <span class="fu">return</span>(gr)</span>
<span id="cb179-36"><a href="source-code.html#cb179-36" tabindex="-1"></a>  }</span>
<span id="cb179-37"><a href="source-code.html#cb179-37" tabindex="-1"></a>  </span>
<span id="cb179-38"><a href="source-code.html#cb179-38" tabindex="-1"></a>  stopTimedMessage <span class="ot">&lt;-</span> <span class="cf">function</span>(ptm) {</span>
<span id="cb179-39"><a href="source-code.html#cb179-39" tabindex="-1"></a>    </span>
<span id="cb179-40"><a href="source-code.html#cb179-40" tabindex="-1"></a>    time <span class="ot">&lt;-</span> <span class="fu">proc.time</span>() <span class="sc">-</span> ptm</span>
<span id="cb179-41"><a href="source-code.html#cb179-41" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">&quot; &quot;</span>, <span class="fu">round</span>(time[<span class="dv">3</span>],<span class="dv">2</span>), <span class="st">&quot;s&quot;</span>)</span>
<span id="cb179-42"><a href="source-code.html#cb179-42" tabindex="-1"></a>    </span>
<span id="cb179-43"><a href="source-code.html#cb179-43" tabindex="-1"></a>  }</span>
<span id="cb179-44"><a href="source-code.html#cb179-44" tabindex="-1"></a>  </span>
<span id="cb179-45"><a href="source-code.html#cb179-45" tabindex="-1"></a>  initializeStates <span class="ot">&lt;-</span> <span class="cf">function</span> (states) </span>
<span id="cb179-46"><a href="source-code.html#cb179-46" tabindex="-1"></a>  {</span>
<span id="cb179-47"><a href="source-code.html#cb179-47" tabindex="-1"></a>    somy.states <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;somy&quot;</span>, states, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb179-48"><a href="source-code.html#cb179-48" tabindex="-1"></a>    somy.numbers <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">sapply</span>(<span class="fu">strsplit</span>(somy.states, <span class="st">&quot;-somy&quot;</span>), </span>
<span id="cb179-49"><a href="source-code.html#cb179-49" tabindex="-1"></a>                                      <span class="st">&quot;[[&quot;</span>, <span class="dv">1</span>))</span>
<span id="cb179-50"><a href="source-code.html#cb179-50" tabindex="-1"></a>    <span class="fu">names</span>(somy.numbers) <span class="ot">&lt;-</span> somy.states</span>
<span id="cb179-51"><a href="source-code.html#cb179-51" tabindex="-1"></a>    <span class="cf">if</span> (<span class="st">&quot;zero-inflation&quot;</span> <span class="sc">%in%</span> states) {</span>
<span id="cb179-52"><a href="source-code.html#cb179-52" tabindex="-1"></a>      multiplicity <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">zero-inflation</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">0</span>, somy.numbers)</span>
<span id="cb179-53"><a href="source-code.html#cb179-53" tabindex="-1"></a>    }</span>
<span id="cb179-54"><a href="source-code.html#cb179-54" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb179-55"><a href="source-code.html#cb179-55" tabindex="-1"></a>      multiplicity <span class="ot">&lt;-</span> somy.numbers</span>
<span id="cb179-56"><a href="source-code.html#cb179-56" tabindex="-1"></a>    }</span>
<span id="cb179-57"><a href="source-code.html#cb179-57" tabindex="-1"></a>    levels.distributions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;delta&quot;</span>, <span class="st">&quot;dgeom&quot;</span>, <span class="st">&quot;dnbinom&quot;</span>, <span class="st">&quot;dbinom&quot;</span>)</span>
<span id="cb179-58"><a href="source-code.html#cb179-58" tabindex="-1"></a>    distributions <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(states))</span>
<span id="cb179-59"><a href="source-code.html#cb179-59" tabindex="-1"></a>    <span class="fu">names</span>(distributions) <span class="ot">&lt;-</span> states</span>
<span id="cb179-60"><a href="source-code.html#cb179-60" tabindex="-1"></a>    distributions[states <span class="sc">==</span> <span class="st">&quot;zero-inflation&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;delta&quot;</span></span>
<span id="cb179-61"><a href="source-code.html#cb179-61" tabindex="-1"></a>    distributions[states <span class="sc">==</span> <span class="st">&quot;0-somy&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;dgeom&quot;</span></span>
<span id="cb179-62"><a href="source-code.html#cb179-62" tabindex="-1"></a>    distributions[(states <span class="sc">!=</span> <span class="st">&quot;zero-inflation&quot;</span>) <span class="sc">&amp;</span> (states <span class="sc">!=</span> <span class="st">&quot;0-somy&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;dnbinom&quot;</span></span>
<span id="cb179-63"><a href="source-code.html#cb179-63" tabindex="-1"></a>    states <span class="ot">&lt;-</span> <span class="fu">factor</span>(states, <span class="at">levels =</span> states)</span>
<span id="cb179-64"><a href="source-code.html#cb179-64" tabindex="-1"></a>    distributions <span class="ot">&lt;-</span> <span class="fu">factor</span>(distributions, <span class="at">levels =</span> levels.distributions)</span>
<span id="cb179-65"><a href="source-code.html#cb179-65" tabindex="-1"></a>    l <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">states =</span> states, <span class="at">distributions =</span> distributions, </span>
<span id="cb179-66"><a href="source-code.html#cb179-66" tabindex="-1"></a>              <span class="at">multiplicity =</span> multiplicity)</span>
<span id="cb179-67"><a href="source-code.html#cb179-67" tabindex="-1"></a>    <span class="fu">return</span>(l)</span>
<span id="cb179-68"><a href="source-code.html#cb179-68" tabindex="-1"></a>  }</span>
<span id="cb179-69"><a href="source-code.html#cb179-69" tabindex="-1"></a>  </span>
<span id="cb179-70"><a href="source-code.html#cb179-70" tabindex="-1"></a>  <span class="co">#  colours</span></span>
<span id="cb179-71"><a href="source-code.html#cb179-71" tabindex="-1"></a>  <span class="cf">if</span> (daan_colours) {</span>
<span id="cb179-72"><a href="source-code.html#cb179-72" tabindex="-1"></a>    stateColors <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">states =</span> <span class="fu">c</span>(<span class="st">&quot;zero-inflation&quot;</span>, <span class="fu">paste0</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>, <span class="st">&quot;-somy&quot;</span>),</span>
<span id="cb179-73"><a href="source-code.html#cb179-73" tabindex="-1"></a>                                       <span class="st">&quot;total&quot;</span>)) {</span>
<span id="cb179-74"><a href="source-code.html#cb179-74" tabindex="-1"></a>      </span>
<span id="cb179-75"><a href="source-code.html#cb179-75" tabindex="-1"></a>      state.colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">zero-inflation</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;#1d4661&quot;</span>, <span class="st">`</span><span class="at">0-somy</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;#1d4661&quot;</span>,</span>
<span id="cb179-76"><a href="source-code.html#cb179-76" tabindex="-1"></a>                        <span class="st">`</span><span class="at">1-somy</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;#3787BA&quot;</span>, <span class="st">`</span><span class="at">2-somy</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;#95B8C5&quot;</span>,</span>
<span id="cb179-77"><a href="source-code.html#cb179-77" tabindex="-1"></a>                        <span class="st">`</span><span class="at">3-somy</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;#F0ECEB&quot;</span>, <span class="st">`</span><span class="at">4-somy</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;#D7A290&quot;</span>, <span class="st">`</span><span class="at">5-somy</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;#BF583B&quot;</span>,</span>
<span id="cb179-78"><a href="source-code.html#cb179-78" tabindex="-1"></a>                        <span class="st">`</span><span class="at">6-somy</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;#8D1128&quot;</span>, <span class="st">`</span><span class="at">7-somy</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;#3C0912&quot;</span>, <span class="st">`</span><span class="at">8-somy</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb179-79"><a href="source-code.html#cb179-79" tabindex="-1"></a>                        <span class="at">total =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb179-80"><a href="source-code.html#cb179-80" tabindex="-1"></a>      </span>
<span id="cb179-81"><a href="source-code.html#cb179-81" tabindex="-1"></a>      states.with.color <span class="ot">&lt;-</span> <span class="fu">intersect</span>(states, <span class="fu">names</span>(state.colors))</span>
<span id="cb179-82"><a href="source-code.html#cb179-82" tabindex="-1"></a>      cols <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">&quot;black&quot;</span>, <span class="fu">length</span>(states))</span>
<span id="cb179-83"><a href="source-code.html#cb179-83" tabindex="-1"></a>      <span class="fu">names</span>(cols) <span class="ot">&lt;-</span> states</span>
<span id="cb179-84"><a href="source-code.html#cb179-84" tabindex="-1"></a>      cols[states.with.color] <span class="ot">&lt;-</span> state.colors[states.with.color]</span>
<span id="cb179-85"><a href="source-code.html#cb179-85" tabindex="-1"></a>      <span class="fu">return</span>(cols)</span>
<span id="cb179-86"><a href="source-code.html#cb179-86" tabindex="-1"></a>    }</span>
<span id="cb179-87"><a href="source-code.html#cb179-87" tabindex="-1"></a>    </span>
<span id="cb179-88"><a href="source-code.html#cb179-88" tabindex="-1"></a>  }</span>
<span id="cb179-89"><a href="source-code.html#cb179-89" tabindex="-1"></a></span>
<span id="cb179-90"><a href="source-code.html#cb179-90" tabindex="-1"></a>  </span>
<span id="cb179-91"><a href="source-code.html#cb179-91" tabindex="-1"></a>  </span>
<span id="cb179-92"><a href="source-code.html#cb179-92" tabindex="-1"></a>  <span class="co"># heatmapgenomewide adapted form AneuFinder package</span></span>
<span id="cb179-93"><a href="source-code.html#cb179-93" tabindex="-1"></a>  heatmapGenomewide_daan <span class="ot">&lt;-</span> <span class="cf">function</span> (hmms, <span class="at">ylabels =</span> <span class="cn">NULL</span>, classes, <span class="at">reorder.by.class =</span> <span class="cn">TRUE</span>, </span>
<span id="cb179-94"><a href="source-code.html#cb179-94" tabindex="-1"></a>                                      classes.color, <span class="at">file =</span> <span class="cn">NULL</span>, <span class="at">cluster =</span> <span class="cn">TRUE</span>, <span class="at">plot.breakpoints =</span> <span class="cn">FALSE</span>, </span>
<span id="cb179-95"><a href="source-code.html#cb179-95" tabindex="-1"></a>                                      <span class="at">hotspots =</span> <span class="cn">NULL</span>, <span class="at">exclude.regions =</span> <span class="cn">NULL</span>) </span>
<span id="cb179-96"><a href="source-code.html#cb179-96" tabindex="-1"></a>  {</span>
<span id="cb179-97"><a href="source-code.html#cb179-97" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(ylabels)) {</span>
<span id="cb179-98"><a href="source-code.html#cb179-98" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(ylabels) <span class="sc">!=</span> <span class="fu">length</span>(hmms)) {</span>
<span id="cb179-99"><a href="source-code.html#cb179-99" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;length(ylabels) must equal length(hmms)&quot;</span>)</span>
<span id="cb179-100"><a href="source-code.html#cb179-100" tabindex="-1"></a>      }</span>
<span id="cb179-101"><a href="source-code.html#cb179-101" tabindex="-1"></a>    }</span>
<span id="cb179-102"><a href="source-code.html#cb179-102" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(classes)) {</span>
<span id="cb179-103"><a href="source-code.html#cb179-103" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(classes) <span class="sc">!=</span> <span class="fu">length</span>(hmms)) {</span>
<span id="cb179-104"><a href="source-code.html#cb179-104" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;length(classes) must equal length(hmms)&quot;</span>)</span>
<span id="cb179-105"><a href="source-code.html#cb179-105" tabindex="-1"></a>      }</span>
<span id="cb179-106"><a href="source-code.html#cb179-106" tabindex="-1"></a>    }</span>
<span id="cb179-107"><a href="source-code.html#cb179-107" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(classes.color) <span class="sc">!=</span> <span class="fu">length</span>(<span class="fu">unique</span>(classes))) {</span>
<span id="cb179-108"><a href="source-code.html#cb179-108" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">&quot;&#39;classes.color&#39; must have the same length as unique(classes)&quot;</span>)</span>
<span id="cb179-109"><a href="source-code.html#cb179-109" tabindex="-1"></a>    }</span>
<span id="cb179-110"><a href="source-code.html#cb179-110" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(<span class="fu">names</span>(classes.color))) {</span>
<span id="cb179-111"><a href="source-code.html#cb179-111" tabindex="-1"></a>      <span class="fu">names</span>(classes.color) <span class="ot">&lt;-</span> <span class="fu">unique</span>(classes)</span>
<span id="cb179-112"><a href="source-code.html#cb179-112" tabindex="-1"></a>    }</span>
<span id="cb179-113"><a href="source-code.html#cb179-113" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">setequal</span>(<span class="fu">names</span>(classes.color), <span class="fu">unique</span>(classes))) {</span>
<span id="cb179-114"><a href="source-code.html#cb179-114" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">&quot;The names of &#39;classes.color&#39; must be equal to the unique elements in &#39;classes&#39;&quot;</span>)</span>
<span id="cb179-115"><a href="source-code.html#cb179-115" tabindex="-1"></a>    }</span>
<span id="cb179-116"><a href="source-code.html#cb179-116" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(hmms) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> cluster <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb179-117"><a href="source-code.html#cb179-117" tabindex="-1"></a>      cluster <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb179-118"><a href="source-code.html#cb179-118" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="st">&quot;Cannot do clustering because only one object was given.&quot;</span>)</span>
<span id="cb179-119"><a href="source-code.html#cb179-119" tabindex="-1"></a>    }</span>
<span id="cb179-120"><a href="source-code.html#cb179-120" tabindex="-1"></a>    hmms <span class="ot">&lt;-</span> <span class="fu">loadFromFiles</span>(hmms, <span class="at">check.class =</span> <span class="fu">c</span>(<span class="st">&quot;aneuHMM&quot;</span>, <span class="st">&quot;aneuBiHMM&quot;</span>))</span>
<span id="cb179-121"><a href="source-code.html#cb179-121" tabindex="-1"></a>    class.data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ID =</span> <span class="fu">sapply</span>(hmms, <span class="st">&quot;[[&quot;</span>, <span class="st">&quot;ID&quot;</span>))</span>
<span id="cb179-122"><a href="source-code.html#cb179-122" tabindex="-1"></a>    class.data<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="fu">factor</span>(class.data<span class="sc">$</span>ID, <span class="at">levels =</span> class.data<span class="sc">$</span>ID)</span>
<span id="cb179-123"><a href="source-code.html#cb179-123" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(ylabels)) {</span>
<span id="cb179-124"><a href="source-code.html#cb179-124" tabindex="-1"></a>      class.data<span class="sc">$</span>ylabel <span class="ot">&lt;-</span> <span class="fu">as.character</span>(class.data<span class="sc">$</span>ID)</span>
<span id="cb179-125"><a href="source-code.html#cb179-125" tabindex="-1"></a>    }</span>
<span id="cb179-126"><a href="source-code.html#cb179-126" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb179-127"><a href="source-code.html#cb179-127" tabindex="-1"></a>      class.data<span class="sc">$</span>ylabel <span class="ot">&lt;-</span> <span class="fu">as.character</span>(ylabels)</span>
<span id="cb179-128"><a href="source-code.html#cb179-128" tabindex="-1"></a>    }</span>
<span id="cb179-129"><a href="source-code.html#cb179-129" tabindex="-1"></a>    class.data<span class="sc">$</span>class <span class="ot">&lt;-</span> classes</span>
<span id="cb179-130"><a href="source-code.html#cb179-130" tabindex="-1"></a>    mapping <span class="ot">&lt;-</span> class.data<span class="sc">$</span>ylabel</span>
<span id="cb179-131"><a href="source-code.html#cb179-131" tabindex="-1"></a>    <span class="fu">names</span>(mapping) <span class="ot">&lt;-</span> class.data<span class="sc">$</span>ID</span>
<span id="cb179-132"><a href="source-code.html#cb179-132" tabindex="-1"></a>    <span class="cf">if</span> (reorder.by.class) {</span>
<span id="cb179-133"><a href="source-code.html#cb179-133" tabindex="-1"></a>      cl <span class="ot">&lt;-</span> <span class="fu">clusterHMMs</span>(hmms, <span class="at">cluster =</span> cluster, <span class="at">classes =</span> classes, </span>
<span id="cb179-134"><a href="source-code.html#cb179-134" tabindex="-1"></a>                        <span class="at">exclude.regions =</span> exclude.regions)</span>
<span id="cb179-135"><a href="source-code.html#cb179-135" tabindex="-1"></a>    }</span>
<span id="cb179-136"><a href="source-code.html#cb179-136" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb179-137"><a href="source-code.html#cb179-137" tabindex="-1"></a>      cl <span class="ot">&lt;-</span> <span class="fu">clusterHMMs</span>(hmms, <span class="at">cluster =</span> cluster, <span class="at">exclude.regions =</span> exclude.regions)</span>
<span id="cb179-138"><a href="source-code.html#cb179-138" tabindex="-1"></a>    }</span>
<span id="cb179-139"><a href="source-code.html#cb179-139" tabindex="-1"></a>    hmms <span class="ot">&lt;-</span> hmms[cl<span class="sc">$</span>IDorder]</span>
<span id="cb179-140"><a href="source-code.html#cb179-140" tabindex="-1"></a>    class.data <span class="ot">&lt;-</span> class.data[cl<span class="sc">$</span>IDorder, ]</span>
<span id="cb179-141"><a href="source-code.html#cb179-141" tabindex="-1"></a>    class.data<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="fu">factor</span>(class.data<span class="sc">$</span>ID, <span class="at">levels =</span> class.data<span class="sc">$</span>ID)</span>
<span id="cb179-142"><a href="source-code.html#cb179-142" tabindex="-1"></a>    segments.list <span class="ot">&lt;-</span> <span class="fu">GRangesList</span>()</span>
<span id="cb179-143"><a href="source-code.html#cb179-143" tabindex="-1"></a>    <span class="cf">for</span> (i1 <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(hmms)) {</span>
<span id="cb179-144"><a href="source-code.html#cb179-144" tabindex="-1"></a>      hmm <span class="ot">&lt;-</span> hmms[[i1]]</span>
<span id="cb179-145"><a href="source-code.html#cb179-145" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.null</span>(hmm<span class="sc">$</span>segments)) {</span>
<span id="cb179-146"><a href="source-code.html#cb179-146" tabindex="-1"></a>        segments.list[[hmm<span class="sc">$</span>ID]] <span class="ot">&lt;-</span> <span class="fu">GRanges</span>()</span>
<span id="cb179-147"><a href="source-code.html#cb179-147" tabindex="-1"></a>      }</span>
<span id="cb179-148"><a href="source-code.html#cb179-148" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb179-149"><a href="source-code.html#cb179-149" tabindex="-1"></a>        segments.list[[hmm<span class="sc">$</span>ID]] <span class="ot">&lt;-</span> hmm<span class="sc">$</span>segments</span>
<span id="cb179-150"><a href="source-code.html#cb179-150" tabindex="-1"></a>      }</span>
<span id="cb179-151"><a href="source-code.html#cb179-151" tabindex="-1"></a>    }</span>
<span id="cb179-152"><a href="source-code.html#cb179-152" tabindex="-1"></a>    <span class="cf">if</span> (plot.breakpoints) {</span>
<span id="cb179-153"><a href="source-code.html#cb179-153" tabindex="-1"></a>      breakpoints <span class="ot">&lt;-</span> <span class="fu">GRangesList</span>()</span>
<span id="cb179-154"><a href="source-code.html#cb179-154" tabindex="-1"></a>      <span class="cf">for</span> (i1 <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(hmms)) {</span>
<span id="cb179-155"><a href="source-code.html#cb179-155" tabindex="-1"></a>        hmm <span class="ot">&lt;-</span> hmms[[i1]]</span>
<span id="cb179-156"><a href="source-code.html#cb179-156" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">is.null</span>(hmm<span class="sc">$</span>breakpoints)) {</span>
<span id="cb179-157"><a href="source-code.html#cb179-157" tabindex="-1"></a>          breakpoints[[hmm<span class="sc">$</span>ID]] <span class="ot">&lt;-</span> <span class="fu">GRanges</span>()</span>
<span id="cb179-158"><a href="source-code.html#cb179-158" tabindex="-1"></a>        }</span>
<span id="cb179-159"><a href="source-code.html#cb179-159" tabindex="-1"></a>        <span class="cf">else</span> {</span>
<span id="cb179-160"><a href="source-code.html#cb179-160" tabindex="-1"></a>          breakpoints[[hmm<span class="sc">$</span>ID]] <span class="ot">&lt;-</span> hmm<span class="sc">$</span>breakpoints</span>
<span id="cb179-161"><a href="source-code.html#cb179-161" tabindex="-1"></a>        }</span>
<span id="cb179-162"><a href="source-code.html#cb179-162" tabindex="-1"></a>      }</span>
<span id="cb179-163"><a href="source-code.html#cb179-163" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(breakpoints) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb179-164"><a href="source-code.html#cb179-164" tabindex="-1"></a>        plot.breakpoints <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb179-165"><a href="source-code.html#cb179-165" tabindex="-1"></a>      }</span>
<span id="cb179-166"><a href="source-code.html#cb179-166" tabindex="-1"></a>    }</span>
<span id="cb179-167"><a href="source-code.html#cb179-167" tabindex="-1"></a>    ptm <span class="ot">&lt;-</span> <span class="fu">startTimedMessage</span>(<span class="st">&quot;Transforming coordinates ...&quot;</span>)</span>
<span id="cb179-168"><a href="source-code.html#cb179-168" tabindex="-1"></a>    segments.list <span class="ot">&lt;-</span> <span class="fu">endoapply</span>(segments.list, transCoord)</span>
<span id="cb179-169"><a href="source-code.html#cb179-169" tabindex="-1"></a>    <span class="cf">if</span> (plot.breakpoints) {</span>
<span id="cb179-170"><a href="source-code.html#cb179-170" tabindex="-1"></a>      breakpoints <span class="ot">&lt;-</span> <span class="fu">endoapply</span>(breakpoints, transCoord)</span>
<span id="cb179-171"><a href="source-code.html#cb179-171" tabindex="-1"></a>    }</span>
<span id="cb179-172"><a href="source-code.html#cb179-172" tabindex="-1"></a>    <span class="fu">stopTimedMessage</span>(ptm)</span>
<span id="cb179-173"><a href="source-code.html#cb179-173" tabindex="-1"></a>    ptm <span class="ot">&lt;-</span> <span class="fu">startTimedMessage</span>(<span class="st">&quot;Making the plot ...&quot;</span>)</span>
<span id="cb179-174"><a href="source-code.html#cb179-174" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb179-175"><a href="source-code.html#cb179-175" tabindex="-1"></a>    <span class="cf">for</span> (i1 <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(segments.list)) {</span>
<span id="cb179-176"><a href="source-code.html#cb179-176" tabindex="-1"></a>      df[[<span class="fu">length</span>(df) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">start =</span> segments.list[[i1]]<span class="sc">$</span>start.genome, </span>
<span id="cb179-177"><a href="source-code.html#cb179-177" tabindex="-1"></a>                                         <span class="at">end =</span> segments.list[[i1]]<span class="sc">$</span>end.genome, <span class="at">seqnames =</span> <span class="fu">seqnames</span>(segments.list[[i1]]), </span>
<span id="cb179-178"><a href="source-code.html#cb179-178" tabindex="-1"></a>                                         <span class="at">ID =</span> <span class="fu">names</span>(segments.list)[i1], <span class="at">state =</span> segments.list[[i1]]<span class="sc">$</span>state)</span>
<span id="cb179-179"><a href="source-code.html#cb179-179" tabindex="-1"></a>    }</span>
<span id="cb179-180"><a href="source-code.html#cb179-180" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, df)</span>
<span id="cb179-181"><a href="source-code.html#cb179-181" tabindex="-1"></a>    df<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>ID, <span class="at">levels =</span> <span class="fu">levels</span>(class.data<span class="sc">$</span>ID))</span>
<span id="cb179-182"><a href="source-code.html#cb179-182" tabindex="-1"></a>    df<span class="sc">$</span>ylabel <span class="ot">&lt;-</span> mapping[<span class="fu">as.character</span>(df<span class="sc">$</span>ID)]</span>
<span id="cb179-183"><a href="source-code.html#cb179-183" tabindex="-1"></a>    <span class="cf">if</span> (plot.breakpoints) {</span>
<span id="cb179-184"><a href="source-code.html#cb179-184" tabindex="-1"></a>      df.breakpoints <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb179-185"><a href="source-code.html#cb179-185" tabindex="-1"></a>      <span class="cf">for</span> (i1 <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(breakpoints)) {</span>
<span id="cb179-186"><a href="source-code.html#cb179-186" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">length</span>(breakpoints[[i1]]) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb179-187"><a href="source-code.html#cb179-187" tabindex="-1"></a>          df.breakpoints[[<span class="fu">length</span>(df.breakpoints) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">start =</span> breakpoints[[i1]]<span class="sc">$</span>start.genome, </span>
<span id="cb179-188"><a href="source-code.html#cb179-188" tabindex="-1"></a>                                                                     <span class="at">end =</span> breakpoints[[i1]]<span class="sc">$</span>end.genome, <span class="at">seqnames =</span> <span class="fu">seqnames</span>(breakpoints[[i1]]), </span>
<span id="cb179-189"><a href="source-code.html#cb179-189" tabindex="-1"></a>                                                                     <span class="at">ID =</span> <span class="fu">names</span>(segments.list)[i1], <span class="at">mid =</span> (breakpoints[[i1]]<span class="sc">$</span>start.genome <span class="sc">+</span> </span>
<span id="cb179-190"><a href="source-code.html#cb179-190" tabindex="-1"></a>                                                                                                             breakpoints[[i1]]<span class="sc">$</span>end.genome)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb179-191"><a href="source-code.html#cb179-191" tabindex="-1"></a>        }</span>
<span id="cb179-192"><a href="source-code.html#cb179-192" tabindex="-1"></a>        <span class="cf">else</span> {</span>
<span id="cb179-193"><a href="source-code.html#cb179-193" tabindex="-1"></a>          df.breakpoints[[<span class="fu">length</span>(df.breakpoints) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">start =</span> <span class="fu">numeric</span>(), </span>
<span id="cb179-194"><a href="source-code.html#cb179-194" tabindex="-1"></a>                                                                     <span class="at">end =</span> <span class="fu">numeric</span>(), <span class="at">seqnames =</span> <span class="fu">character</span>(), <span class="at">ID =</span> <span class="fu">character</span>(), </span>
<span id="cb179-195"><a href="source-code.html#cb179-195" tabindex="-1"></a>                                                                     <span class="at">mid =</span> <span class="fu">numeric</span>())</span>
<span id="cb179-196"><a href="source-code.html#cb179-196" tabindex="-1"></a>        }</span>
<span id="cb179-197"><a href="source-code.html#cb179-197" tabindex="-1"></a>      }</span>
<span id="cb179-198"><a href="source-code.html#cb179-198" tabindex="-1"></a>      df.breakpoints <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, df.breakpoints)</span>
<span id="cb179-199"><a href="source-code.html#cb179-199" tabindex="-1"></a>      df.breakpoints<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="fu">factor</span>(df.breakpoints<span class="sc">$</span>ID, <span class="at">levels =</span> <span class="fu">levels</span>(class.data<span class="sc">$</span>ID))</span>
<span id="cb179-200"><a href="source-code.html#cb179-200" tabindex="-1"></a>      df.breakpoints<span class="sc">$</span>ylabel <span class="ot">&lt;-</span> mapping[<span class="fu">as.character</span>(df.breakpoints<span class="sc">$</span>ID)]</span>
<span id="cb179-201"><a href="source-code.html#cb179-201" tabindex="-1"></a>    }</span>
<span id="cb179-202"><a href="source-code.html#cb179-202" tabindex="-1"></a>    cum.seqlengths <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(<span class="fu">as.numeric</span>(<span class="fu">seqlengths</span>(segments.list[[<span class="dv">1</span>]])))</span>
<span id="cb179-203"><a href="source-code.html#cb179-203" tabindex="-1"></a>    <span class="fu">names</span>(cum.seqlengths) <span class="ot">&lt;-</span> <span class="fu">seqlevels</span>(segments.list[[<span class="dv">1</span>]])</span>
<span id="cb179-204"><a href="source-code.html#cb179-204" tabindex="-1"></a>    cum.seqlengths<span class="fl">.0</span> <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, cum.seqlengths[<span class="sc">-</span><span class="fu">length</span>(cum.seqlengths)])</span>
<span id="cb179-205"><a href="source-code.html#cb179-205" tabindex="-1"></a>    <span class="fu">names</span>(cum.seqlengths<span class="fl">.0</span>) <span class="ot">&lt;-</span> <span class="fu">seqlevels</span>(segments.list[[<span class="dv">1</span>]])</span>
<span id="cb179-206"><a href="source-code.html#cb179-206" tabindex="-1"></a>    label.pos <span class="ot">&lt;-</span> <span class="fu">round</span>(cum.seqlengths<span class="fl">.0</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">seqlengths</span>(segments.list[[<span class="dv">1</span>]]))</span>
<span id="cb179-207"><a href="source-code.html#cb179-207" tabindex="-1"></a>    df.chroms <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, cum.seqlengths), <span class="at">x =</span> <span class="dv">1</span>, </span>
<span id="cb179-208"><a href="source-code.html#cb179-208" tabindex="-1"></a>                            <span class="at">xend =</span> <span class="fu">length</span>(segments.list))</span>
<span id="cb179-209"><a href="source-code.html#cb179-209" tabindex="-1"></a>    pltlist <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb179-210"><a href="source-code.html#cb179-210" tabindex="-1"></a>    widths <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb179-211"><a href="source-code.html#cb179-211" tabindex="-1"></a>    df<span class="sc">$</span>state <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>state, <span class="at">levels =</span> <span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">initializeStates</span>(<span class="fu">levels</span>(df<span class="sc">$</span>state))<span class="sc">$</span>multiplicity)))</span>
<span id="cb179-212"><a href="source-code.html#cb179-212" tabindex="-1"></a>    df<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>ID)</span>
<span id="cb179-213"><a href="source-code.html#cb179-213" tabindex="-1"></a>    ggplt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df) <span class="sc">+</span> <span class="fu">geom_linerange</span>(<span class="fu">aes_string</span>(<span class="at">ymin =</span> <span class="st">&quot;start&quot;</span>, </span>
<span id="cb179-214"><a href="source-code.html#cb179-214" tabindex="-1"></a>                                                    <span class="at">ymax =</span> <span class="st">&quot;end&quot;</span>, <span class="at">x =</span> <span class="st">&quot;x&quot;</span>, <span class="at">col =</span> <span class="st">&quot;state&quot;</span>), <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> label.pos, </span>
<span id="cb179-215"><a href="source-code.html#cb179-215" tabindex="-1"></a>                                                                                                                          <span class="at">labels =</span> <span class="fu">names</span>(label.pos))</span>
<span id="cb179-216"><a href="source-code.html#cb179-216" tabindex="-1"></a>    </span>
<span id="cb179-217"><a href="source-code.html#cb179-217" tabindex="-1"></a></span>
<span id="cb179-218"><a href="source-code.html#cb179-218" tabindex="-1"></a>    <span class="co"># ggplt &lt;- ggplt + scale_x_continuous(name = &quot;&quot;,</span></span>
<span id="cb179-219"><a href="source-code.html#cb179-219" tabindex="-1"></a>    <span class="co">#                      breaks = 1:length(unique(df$ylabel)),</span></span>
<span id="cb179-220"><a href="source-code.html#cb179-220" tabindex="-1"></a>    <span class="co">#                      labels = unique(df$ylabel))</span></span>
<span id="cb179-221"><a href="source-code.html#cb179-221" tabindex="-1"></a>    </span>
<span id="cb179-222"><a href="source-code.html#cb179-222" tabindex="-1"></a>    ggplt <span class="ot">&lt;-</span> ggplt <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">stateColors</span>(<span class="fu">levels</span>(df<span class="sc">$</span>state))) <span class="co"># adding custom colours</span></span>
<span id="cb179-223"><a href="source-code.html#cb179-223" tabindex="-1"></a>    <span class="co"># adjusintg x axis</span></span>
<span id="cb179-224"><a href="source-code.html#cb179-224" tabindex="-1"></a>    ggplt <span class="ot">&lt;-</span> ggplt <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb179-225"><a href="source-code.html#cb179-225" tabindex="-1"></a>                           <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb179-226"><a href="source-code.html#cb179-226" tabindex="-1"></a>                           <span class="at">axis.line =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb179-227"><a href="source-code.html#cb179-227" tabindex="-1"></a>    </span>
<span id="cb179-228"><a href="source-code.html#cb179-228" tabindex="-1"></a>    ggplt <span class="ot">&lt;-</span> ggplt <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="fu">aes_string</span>(<span class="at">x =</span> <span class="st">&quot;x&quot;</span>, <span class="at">xend =</span> <span class="st">&quot;xend&quot;</span>,</span>
<span id="cb179-229"><a href="source-code.html#cb179-229" tabindex="-1"></a>                                             <span class="at">y =</span> <span class="st">&quot;y&quot;</span>, <span class="at">yend =</span> <span class="st">&quot;y&quot;</span>), <span class="at">data =</span> df.chroms, <span class="at">col =</span> <span class="st">&quot;grey13&quot;</span>)</span>
<span id="cb179-230"><a href="source-code.html#cb179-230" tabindex="-1"></a>    </span>
<span id="cb179-231"><a href="source-code.html#cb179-231" tabindex="-1"></a>    </span>
<span id="cb179-232"><a href="source-code.html#cb179-232" tabindex="-1"></a>    </span>
<span id="cb179-233"><a href="source-code.html#cb179-233" tabindex="-1"></a>    <span class="co"># adjusting y axis</span></span>
<span id="cb179-234"><a href="source-code.html#cb179-234" tabindex="-1"></a>    ggplt <span class="ot">&lt;-</span> ggplt <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb179-235"><a href="source-code.html#cb179-235" tabindex="-1"></a>                           <span class="at">axis.line =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb179-236"><a href="source-code.html#cb179-236" tabindex="-1"></a>    </span>
<span id="cb179-237"><a href="source-code.html#cb179-237" tabindex="-1"></a>    <span class="co"># removing legend</span></span>
<span id="cb179-238"><a href="source-code.html#cb179-238" tabindex="-1"></a>    ggplt <span class="ot">&lt;-</span> ggplt <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>)</span>
<span id="cb179-239"><a href="source-code.html#cb179-239" tabindex="-1"></a>    </span>
<span id="cb179-240"><a href="source-code.html#cb179-240" tabindex="-1"></a>    ggplt <span class="ot">&lt;-</span> ggplt <span class="sc">+</span> <span class="fu">coord_flip</span>()</span>
<span id="cb179-241"><a href="source-code.html#cb179-241" tabindex="-1"></a>    </span>
<span id="cb179-242"><a href="source-code.html#cb179-242" tabindex="-1"></a>    <span class="co"># removing all axis names</span></span>
<span id="cb179-243"><a href="source-code.html#cb179-243" tabindex="-1"></a>    ggplt <span class="ot">&lt;-</span> ggplt <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb179-244"><a href="source-code.html#cb179-244" tabindex="-1"></a>    </span>
<span id="cb179-245"><a href="source-code.html#cb179-245" tabindex="-1"></a>    <span class="co"># add numeber of cells sequenced text</span></span>
<span id="cb179-246"><a href="source-code.html#cb179-246" tabindex="-1"></a>    ggplt <span class="ot">&lt;-</span> ggplt <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, </span>
<span id="cb179-247"><a href="source-code.html#cb179-247" tabindex="-1"></a>                              <span class="at">label =</span> <span class="fu">paste</span>(<span class="fu">length</span>(hmms), <span class="st">&#39;cells&#39;</span>), </span>
<span id="cb179-248"><a href="source-code.html#cb179-248" tabindex="-1"></a>                              <span class="at">x =</span> <span class="fu">length</span>(hmms)<span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb179-249"><a href="source-code.html#cb179-249" tabindex="-1"></a>                              <span class="at">y =</span> <span class="dv">3100000000</span>,</span>
<span id="cb179-250"><a href="source-code.html#cb179-250" tabindex="-1"></a>                              <span class="at">angle =</span> <span class="dv">270</span>,</span>
<span id="cb179-251"><a href="source-code.html#cb179-251" tabindex="-1"></a>                              <span class="at">size =</span> <span class="dv">50</span>)</span>
<span id="cb179-252"><a href="source-code.html#cb179-252" tabindex="-1"></a>    </span>
<span id="cb179-253"><a href="source-code.html#cb179-253" tabindex="-1"></a>    <span class="co"># decreasing plot margin</span></span>
<span id="cb179-254"><a href="source-code.html#cb179-254" tabindex="-1"></a>    ggplt <span class="ot">&lt;-</span> ggplt <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="st">&quot;cm&quot;</span>))</span>
<span id="cb179-255"><a href="source-code.html#cb179-255" tabindex="-1"></a>    </span>
<span id="cb179-256"><a href="source-code.html#cb179-256" tabindex="-1"></a>    </span>
<span id="cb179-257"><a href="source-code.html#cb179-257" tabindex="-1"></a>    <span class="cf">if</span> (plot.breakpoints) {</span>
<span id="cb179-258"><a href="source-code.html#cb179-258" tabindex="-1"></a>      df.breakpoints<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df.breakpoints<span class="sc">$</span>ID)</span>
<span id="cb179-259"><a href="source-code.html#cb179-259" tabindex="-1"></a>      ggplt <span class="ot">&lt;-</span> ggplt <span class="sc">+</span> <span class="fu">geom_linerange</span>(<span class="at">data =</span> df.breakpoints, </span>
<span id="cb179-260"><a href="source-code.html#cb179-260" tabindex="-1"></a>                                      <span class="at">mapping =</span> <span class="fu">aes_string</span>(<span class="at">x =</span> <span class="st">&quot;x&quot;</span>, <span class="at">ymin =</span> <span class="st">&quot;start&quot;</span>, <span class="at">ymax =</span> <span class="st">&quot;end&quot;</span>), </span>
<span id="cb179-261"><a href="source-code.html#cb179-261" tabindex="-1"></a>                                      <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> df.breakpoints, </span>
<span id="cb179-262"><a href="source-code.html#cb179-262" tabindex="-1"></a>                                                                        <span class="at">mapping =</span> <span class="fu">aes_string</span>(<span class="at">x =</span> <span class="st">&quot;x&quot;</span>, <span class="at">y =</span> <span class="st">&quot;mid&quot;</span>))</span>
<span id="cb179-263"><a href="source-code.html#cb179-263" tabindex="-1"></a>    }</span>
<span id="cb179-264"><a href="source-code.html#cb179-264" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(hotspots)) {</span>
<span id="cb179-265"><a href="source-code.html#cb179-265" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(hotspots) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb179-266"><a href="source-code.html#cb179-266" tabindex="-1"></a>        df.hot <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">transCoord</span>(hotspots))</span>
<span id="cb179-267"><a href="source-code.html#cb179-267" tabindex="-1"></a>        df.hot<span class="sc">$</span>xmin <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb179-268"><a href="source-code.html#cb179-268" tabindex="-1"></a>        df.hot<span class="sc">$</span>xmax <span class="ot">&lt;-</span> <span class="fu">length</span>(class.data<span class="sc">$</span>ID) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb179-269"><a href="source-code.html#cb179-269" tabindex="-1"></a>        ggplt <span class="ot">&lt;-</span> ggplt <span class="sc">+</span> <span class="fu">geom_rect</span>(<span class="at">data =</span> df.hot, <span class="at">mapping =</span> <span class="fu">aes_string</span>(<span class="at">xmin =</span> <span class="st">&quot;xmin&quot;</span>, </span>
<span id="cb179-270"><a href="source-code.html#cb179-270" tabindex="-1"></a>                                                                       <span class="at">xmax =</span> <span class="st">&quot;xmax&quot;</span>, <span class="at">ymin =</span> <span class="st">&quot;start.genome&quot;</span>, <span class="at">ymax =</span> <span class="st">&quot;end.genome&quot;</span>, </span>
<span id="cb179-271"><a href="source-code.html#cb179-271" tabindex="-1"></a>                                                                       <span class="at">alpha =</span> <span class="st">&quot;num.events&quot;</span>), <span class="at">fill =</span> <span class="st">&quot;hotpink4&quot;</span>) <span class="sc">+</span> <span class="fu">scale_alpha_continuous</span>(<span class="at">name =</span> <span class="st">&quot;breakpoints&quot;</span>, </span>
<span id="cb179-272"><a href="source-code.html#cb179-272" tabindex="-1"></a>                                                                                                                                          <span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.8</span>))</span>
<span id="cb179-273"><a href="source-code.html#cb179-273" tabindex="-1"></a>      }</span>
<span id="cb179-274"><a href="source-code.html#cb179-274" tabindex="-1"></a>    }</span>
<span id="cb179-275"><a href="source-code.html#cb179-275" tabindex="-1"></a>    </span>
<span id="cb179-276"><a href="source-code.html#cb179-276" tabindex="-1"></a>    </span>
<span id="cb179-277"><a href="source-code.html#cb179-277" tabindex="-1"></a>    width.heatmap <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">as.numeric</span>(<span class="fu">seqlengths</span>(hmms[[<span class="dv">1</span>]]<span class="sc">$</span>bins)))<span class="sc">/</span><span class="fl">3e+09</span> <span class="sc">*</span> </span>
<span id="cb179-278"><a href="source-code.html#cb179-278" tabindex="-1"></a>      <span class="dv">150</span></span>
<span id="cb179-279"><a href="source-code.html#cb179-279" tabindex="-1"></a>    height <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">length</span>(hmms) <span class="sc">*</span> <span class="fl">0.5</span>, <span class="dv">2</span>)</span>
<span id="cb179-280"><a href="source-code.html#cb179-280" tabindex="-1"></a>    pltlist[[<span class="st">&quot;heatmap&quot;</span>]] <span class="ot">&lt;-</span> ggplt</span>
<span id="cb179-281"><a href="source-code.html#cb179-281" tabindex="-1"></a>    widths[<span class="st">&quot;heatmap&quot;</span>] <span class="ot">&lt;-</span> width.heatmap</span>
<span id="cb179-282"><a href="source-code.html#cb179-282" tabindex="-1"></a>    <span class="co"># adding class colors</span></span>
<span id="cb179-283"><a href="source-code.html#cb179-283" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(classes)) {</span>
<span id="cb179-284"><a href="source-code.html#cb179-284" tabindex="-1"></a>      width.classes <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb179-285"><a href="source-code.html#cb179-285" tabindex="-1"></a>      class.data<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(class.data<span class="sc">$</span>ID)</span>
<span id="cb179-286"><a href="source-code.html#cb179-286" tabindex="-1"></a>      ggclass <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(class.data) <span class="sc">+</span> <span class="fu">geom_linerange</span>(<span class="fu">aes_string</span>(<span class="at">ymin =</span> <span class="dv">0</span>, </span>
<span id="cb179-287"><a href="source-code.html#cb179-287" tabindex="-1"></a>                                                                <span class="at">ymax =</span> <span class="dv">1</span>, <span class="at">x =</span> <span class="st">&quot;x&quot;</span>, <span class="at">col =</span> <span class="st">&quot;class&quot;</span>), <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">col =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb179-288"><a href="source-code.html#cb179-288" tabindex="-1"></a>        <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb179-289"><a href="source-code.html#cb179-289" tabindex="-1"></a>      ggclass <span class="ot">&lt;-</span> ggclass <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb179-290"><a href="source-code.html#cb179-290" tabindex="-1"></a>                                 <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb179-291"><a href="source-code.html#cb179-291" tabindex="-1"></a>                                 <span class="at">axis.line =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb179-292"><a href="source-code.html#cb179-292" tabindex="-1"></a>      ggclass <span class="ot">&lt;-</span> ggclass <span class="sc">+</span> <span class="fu">coord_flip</span>()</span>
<span id="cb179-293"><a href="source-code.html#cb179-293" tabindex="-1"></a>      </span>
<span id="cb179-294"><a href="source-code.html#cb179-294" tabindex="-1"></a>      <span class="co"># decreasing plot margin</span></span>
<span id="cb179-295"><a href="source-code.html#cb179-295" tabindex="-1"></a>      ggclass <span class="ot">&lt;-</span> ggclass <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="st">&quot;cm&quot;</span>))</span>
<span id="cb179-296"><a href="source-code.html#cb179-296" tabindex="-1"></a>      </span>
<span id="cb179-297"><a href="source-code.html#cb179-297" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(classes.color)) {</span>
<span id="cb179-298"><a href="source-code.html#cb179-298" tabindex="-1"></a>        ggclass <span class="ot">&lt;-</span> ggclass <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">breaks =</span> <span class="fu">names</span>(classes.color), </span>
<span id="cb179-299"><a href="source-code.html#cb179-299" tabindex="-1"></a>                                                <span class="at">values =</span> classes.color)</span>
<span id="cb179-300"><a href="source-code.html#cb179-300" tabindex="-1"></a>      }</span>
<span id="cb179-301"><a href="source-code.html#cb179-301" tabindex="-1"></a>      pltlist[[<span class="st">&quot;classbar&quot;</span>]] <span class="ot">&lt;-</span> ggclass</span>
<span id="cb179-302"><a href="source-code.html#cb179-302" tabindex="-1"></a>      widths[<span class="st">&quot;classbar&quot;</span>] <span class="ot">&lt;-</span> width.classes</span>
<span id="cb179-303"><a href="source-code.html#cb179-303" tabindex="-1"></a>    }</span>
<span id="cb179-304"><a href="source-code.html#cb179-304" tabindex="-1"></a>    <span class="co"># adding dendogram</span></span>
<span id="cb179-305"><a href="source-code.html#cb179-305" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(cl<span class="sc">$</span>hclust) <span class="sc">&amp;</span> dendogram) {</span>
<span id="cb179-306"><a href="source-code.html#cb179-306" tabindex="-1"></a>      dhc <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">as.dendrogram</span>(cl<span class="sc">$</span>hclust)</span>
<span id="cb179-307"><a href="source-code.html#cb179-307" tabindex="-1"></a>      ddata <span class="ot">&lt;-</span> ggdendro<span class="sc">::</span><span class="fu">dendro_data</span>(dhc, <span class="at">type =</span> <span class="st">&quot;rectangle&quot;</span>)</span>
<span id="cb179-308"><a href="source-code.html#cb179-308" tabindex="-1"></a>      ggdndr <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(ddata<span class="sc">$</span>segments) <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="fu">aes_string</span>(<span class="at">x =</span> <span class="st">&quot;x&quot;</span>, </span>
<span id="cb179-309"><a href="source-code.html#cb179-309" tabindex="-1"></a>                                                                 <span class="at">xend =</span> <span class="st">&quot;xend&quot;</span>, <span class="at">y =</span> <span class="st">&quot;y&quot;</span>, <span class="at">yend =</span> <span class="st">&quot;yend&quot;</span>)) <span class="sc">+</span> <span class="fu">scale_y_reverse</span>()</span>
<span id="cb179-310"><a href="source-code.html#cb179-310" tabindex="-1"></a>      ggdndr <span class="ot">&lt;-</span> ggdndr <span class="sc">+</span> <span class="fu">coord_flip</span>()</span>
<span id="cb179-311"><a href="source-code.html#cb179-311" tabindex="-1"></a>      ggdndr <span class="ot">&lt;-</span> ggdndr <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb179-312"><a href="source-code.html#cb179-312" tabindex="-1"></a>                               <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb179-313"><a href="source-code.html#cb179-313" tabindex="-1"></a>                               <span class="at">axis.line =</span> <span class="fu">element_blank</span>(), <span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb179-314"><a href="source-code.html#cb179-314" tabindex="-1"></a>      width.dendro <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb179-315"><a href="source-code.html#cb179-315" tabindex="-1"></a>      pltlist[[<span class="st">&quot;dendro&quot;</span>]] <span class="ot">&lt;-</span> ggdndr</span>
<span id="cb179-316"><a href="source-code.html#cb179-316" tabindex="-1"></a>      widths[<span class="st">&quot;dendro&quot;</span>] <span class="ot">&lt;-</span> width.dendro</span>
<span id="cb179-317"><a href="source-code.html#cb179-317" tabindex="-1"></a>    }</span>
<span id="cb179-318"><a href="source-code.html#cb179-318" tabindex="-1"></a>    <span class="co"># alligning ggpllt with dendogram and classes</span></span>
<span id="cb179-319"><a href="source-code.html#cb179-319" tabindex="-1"></a>    cowplt <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> <span class="fu">rev</span>(pltlist), <span class="at">align =</span> <span class="st">&quot;h&quot;</span>, </span>
<span id="cb179-320"><a href="source-code.html#cb179-320" tabindex="-1"></a>                                 <span class="at">ncol =</span> <span class="fu">length</span>(pltlist), <span class="at">rel_widths =</span> <span class="fu">rev</span>(widths))</span>
<span id="cb179-321"><a href="source-code.html#cb179-321" tabindex="-1"></a>    </span>
<span id="cb179-322"><a href="source-code.html#cb179-322" tabindex="-1"></a>    </span>
<span id="cb179-323"><a href="source-code.html#cb179-323" tabindex="-1"></a>    <span class="fu">stopTimedMessage</span>(ptm)</span>
<span id="cb179-324"><a href="source-code.html#cb179-324" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(file)) {</span>
<span id="cb179-325"><a href="source-code.html#cb179-325" tabindex="-1"></a>      ptm <span class="ot">&lt;-</span> <span class="fu">startTimedMessage</span>(<span class="st">&quot;Plotting to file &quot;</span>, file, <span class="st">&quot; ...&quot;</span>)</span>
<span id="cb179-326"><a href="source-code.html#cb179-326" tabindex="-1"></a>      <span class="fu">ggsave</span>(file, cowplt, <span class="at">width =</span> <span class="fu">sum</span>(widths), <span class="at">height =</span> height, </span>
<span id="cb179-327"><a href="source-code.html#cb179-327" tabindex="-1"></a>             <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>, <span class="at">limitsize =</span> <span class="cn">FALSE</span>)</span>
<span id="cb179-328"><a href="source-code.html#cb179-328" tabindex="-1"></a>      <span class="fu">stopTimedMessage</span>(ptm)</span>
<span id="cb179-329"><a href="source-code.html#cb179-329" tabindex="-1"></a>    }</span>
<span id="cb179-330"><a href="source-code.html#cb179-330" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb179-331"><a href="source-code.html#cb179-331" tabindex="-1"></a>      <span class="fu">return</span>(cowplt)</span>
<span id="cb179-332"><a href="source-code.html#cb179-332" tabindex="-1"></a>    }</span>
<span id="cb179-333"><a href="source-code.html#cb179-333" tabindex="-1"></a>  }</span>
<span id="cb179-334"><a href="source-code.html#cb179-334" tabindex="-1"></a>  </span>
<span id="cb179-335"><a href="source-code.html#cb179-335" tabindex="-1"></a>  <span class="co">#make heatmap and safe</span></span>
<span id="cb179-336"><a href="source-code.html#cb179-336" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>(<span class="fu">heatmapGenomewide_daan</span>(selected.files, <span class="at">classes =</span> classes_daan, <span class="at">classes.color =</span> class.col,</span>
<span id="cb179-337"><a href="source-code.html#cb179-337" tabindex="-1"></a>                         <span class="at">file =</span> <span class="fu">paste0</span>(path, <span class="st">&#39;/&#39;</span>, name, <span class="st">&#39;_&#39;</span>, platename, <span class="st">&#39;.pdf&#39;</span>)))</span>
<span id="cb179-338"><a href="source-code.html#cb179-338" tabindex="-1"></a>  </span>
<span id="cb179-339"><a href="source-code.html#cb179-339" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">print</span>(<span class="fu">paste0</span>(name, <span class="st">&#39; done.&#39;</span>)))</span>
<span id="cb179-340"><a href="source-code.html#cb179-340" tabindex="-1"></a>  </span>
<span id="cb179-341"><a href="source-code.html#cb179-341" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="fisher_test-script-perform_fisher-function" class="section level2 hasAnchor" number="6.9">
<h2><span class="header-section-number">6.9</span> fisher_test script: ‘perform_fisher’ function<a href="source-code.html#fisher_test-script-perform_fisher-function" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="source-code.html#cb180-1" tabindex="-1"></a>perform_fisher <span class="ot">&lt;-</span> <span class="cf">function</span>(dataframe,</span>
<span id="cb180-2"><a href="source-code.html#cb180-2" tabindex="-1"></a>                           population1,</span>
<span id="cb180-3"><a href="source-code.html#cb180-3" tabindex="-1"></a>                           population2) {</span>
<span id="cb180-4"><a href="source-code.html#cb180-4" tabindex="-1"></a>  <span class="co">#&#39; @param </span></span>
<span id="cb180-5"><a href="source-code.html#cb180-5" tabindex="-1"></a>  <span class="co">#&#39; dataframe is a df with columns paths and class with values &#39;hub015_rad_a&#39;, &#39;hub015_prerad_a&#39; etc.</span></span>
<span id="cb180-6"><a href="source-code.html#cb180-6" tabindex="-1"></a>  <span class="co">#&#39; population 1 and population two are the two pops you want to compare, for example prerad vs rad</span></span>
<span id="cb180-7"><a href="source-code.html#cb180-7" tabindex="-1"></a>  <span class="co">#&#39; or prerad versus rad cycle 2</span></span>
<span id="cb180-8"><a href="source-code.html#cb180-8" tabindex="-1"></a>  <span class="co">#&#39; @return</span></span>
<span id="cb180-9"><a href="source-code.html#cb180-9" tabindex="-1"></a>  <span class="co">#&#39; returns the p value of a Fisher&#39;s exact test. If the p value is above 0.05, the distributions</span></span>
<span id="cb180-10"><a href="source-code.html#cb180-10" tabindex="-1"></a>  <span class="co">#&#39; pre and post rad are the same. </span></span>
<span id="cb180-11"><a href="source-code.html#cb180-11" tabindex="-1"></a>  <span class="co">#&#39; </span></span>
<span id="cb180-12"><a href="source-code.html#cb180-12" tabindex="-1"></a>  </span>
<span id="cb180-13"><a href="source-code.html#cb180-13" tabindex="-1"></a>  dataframe<span class="sc">$</span>rad <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dataframe<span class="sc">$</span>class <span class="sc">%in%</span> population1, <span class="st">&#39;pop1&#39;</span>,</span>
<span id="cb180-14"><a href="source-code.html#cb180-14" tabindex="-1"></a>                          <span class="fu">ifelse</span>(dataframe<span class="sc">$</span>class <span class="sc">%in%</span> population2, <span class="st">&#39;pop2&#39;</span>,</span>
<span id="cb180-15"><a href="source-code.html#cb180-15" tabindex="-1"></a>                                 <span class="cn">NA</span>))</span>
<span id="cb180-16"><a href="source-code.html#cb180-16" tabindex="-1"></a>  </span>
<span id="cb180-17"><a href="source-code.html#cb180-17" tabindex="-1"></a>  org_id <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">str_extract</span>(<span class="fu">unique</span>(dataframe<span class="sc">$</span>class), <span class="st">&#39;hub</span><span class="sc">\\</span><span class="st">d{3}&#39;</span>))</span>
<span id="cb180-18"><a href="source-code.html#cb180-18" tabindex="-1"></a>  </span>
<span id="cb180-19"><a href="source-code.html#cb180-19" tabindex="-1"></a>  <span class="co"># remove na</span></span>
<span id="cb180-20"><a href="source-code.html#cb180-20" tabindex="-1"></a>  dataframe <span class="ot">&lt;-</span> dataframe[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(dataframe<span class="sc">$</span>rad)),]</span>
<span id="cb180-21"><a href="source-code.html#cb180-21" tabindex="-1"></a>  </span>
<span id="cb180-22"><a href="source-code.html#cb180-22" tabindex="-1"></a>  simple_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(string) {</span>
<span id="cb180-23"><a href="source-code.html#cb180-23" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">tail</span>(string,<span class="dv">1</span>))</span>
<span id="cb180-24"><a href="source-code.html#cb180-24" tabindex="-1"></a>  }</span>
<span id="cb180-25"><a href="source-code.html#cb180-25" tabindex="-1"></a>  </span>
<span id="cb180-26"><a href="source-code.html#cb180-26" tabindex="-1"></a>  dataframe<span class="sc">$</span>clone <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(stringr<span class="sc">::</span><span class="fu">str_split</span>(dataframe<span class="sc">$</span>class, <span class="at">pattern =</span> <span class="st">&#39;_&#39;</span>), simple_fun))</span>
<span id="cb180-27"><a href="source-code.html#cb180-27" tabindex="-1"></a>  </span>
<span id="cb180-28"><a href="source-code.html#cb180-28" tabindex="-1"></a>  <span class="co"># in hub015 and hub005, we defined subclones. These are actually part of the same clone, so should be </span></span>
<span id="cb180-29"><a href="source-code.html#cb180-29" tabindex="-1"></a>  <span class="co"># analysed together</span></span>
<span id="cb180-30"><a href="source-code.html#cb180-30" tabindex="-1"></a>  <span class="cf">if</span> (org_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;hub005&#39;</span>, <span class="st">&#39;hub015&#39;</span>)){</span>
<span id="cb180-31"><a href="source-code.html#cb180-31" tabindex="-1"></a>    dataframe<span class="sc">$</span>clone <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(dataframe<span class="sc">$</span>clone, <span class="at">pattern =</span> <span class="st">&#39;a.a|a.b&#39;</span>, <span class="at">replacement =</span> <span class="st">&#39;a&#39;</span>)</span>
<span id="cb180-32"><a href="source-code.html#cb180-32" tabindex="-1"></a>    </span>
<span id="cb180-33"><a href="source-code.html#cb180-33" tabindex="-1"></a>  }</span>
<span id="cb180-34"><a href="source-code.html#cb180-34" tabindex="-1"></a>  </span>
<span id="cb180-35"><a href="source-code.html#cb180-35" tabindex="-1"></a>  tab <span class="ot">&lt;-</span> <span class="fu">table</span>(dataframe<span class="sc">$</span>clone, dataframe<span class="sc">$</span>rad)</span>
<span id="cb180-36"><a href="source-code.html#cb180-36" tabindex="-1"></a>  </span>
<span id="cb180-37"><a href="source-code.html#cb180-37" tabindex="-1"></a>  </span>
<span id="cb180-38"><a href="source-code.html#cb180-38" tabindex="-1"></a>  <span class="co"># df &lt;- data.frame(cline &lt;- org_id, p_val &lt;- fisher.test(tab)$p.value)</span></span>
<span id="cb180-39"><a href="source-code.html#cb180-39" tabindex="-1"></a>  <span class="co"># </span></span>
<span id="cb180-40"><a href="source-code.html#cb180-40" tabindex="-1"></a>  <span class="co"># return(df) </span></span>
<span id="cb180-41"><a href="source-code.html#cb180-41" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">fisher.test</span>(tab)<span class="sc">$</span>p.value)</span>
<span id="cb180-42"><a href="source-code.html#cb180-42" tabindex="-1"></a>  </span>
<span id="cb180-43"><a href="source-code.html#cb180-43" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="find_specific_cna_sc-script-find_specific_cna_sc-function" class="section level2 hasAnchor" number="6.10">
<h2><span class="header-section-number">6.10</span> find_specific_cna_sc script: ‘find_specific_cna_sc’ function<a href="source-code.html#find_specific_cna_sc-script-find_specific_cna_sc-function" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="source-code.html#cb181-1" tabindex="-1"></a>find_specific_cna_sc <span class="ot">&lt;-</span></span>
<span id="cb181-2"><a href="source-code.html#cb181-2" tabindex="-1"></a>  <span class="cf">function</span>(list_resistant,</span>
<span id="cb181-3"><a href="source-code.html#cb181-3" tabindex="-1"></a>           list_sensitive,</span>
<span id="cb181-4"><a href="source-code.html#cb181-4" tabindex="-1"></a>           perc_cutoff_within_subclone_resistant,</span>
<span id="cb181-5"><a href="source-code.html#cb181-5" tabindex="-1"></a>           perc_cutoff_within_subclone_sensitive,</span>
<span id="cb181-6"><a href="source-code.html#cb181-6" tabindex="-1"></a>           per_cutoff_across_subclone_resistant,</span>
<span id="cb181-7"><a href="source-code.html#cb181-7" tabindex="-1"></a>           per_cutoff_across_subclone_sensitive,</span>
<span id="cb181-8"><a href="source-code.html#cb181-8" tabindex="-1"></a>           <span class="at">return_cnas_per_subclone =</span> F) {</span>
<span id="cb181-9"><a href="source-code.html#cb181-9" tabindex="-1"></a>    <span class="co">#&#39; @param list_resistant a list subclone names which itself contains a list of paths of paths to aneuHMM .Rda files. </span></span>
<span id="cb181-10"><a href="source-code.html#cb181-10" tabindex="-1"></a>    <span class="co">#&#39; @param list_sensitive a list subclone names which itself contains a list of paths of paths to aneuHMM .Rda files. </span></span>
<span id="cb181-11"><a href="source-code.html#cb181-11" tabindex="-1"></a>    <span class="co">#&#39; @param perc_cutoff_within_subclone_resistant user defined percentage cutoff to use (e.g. 0.6 means a certain CNA is shared by 60% of the cells</span></span>
<span id="cb181-12"><a href="source-code.html#cb181-12" tabindex="-1"></a>    <span class="co">#&#39; within a subclone).</span></span>
<span id="cb181-13"><a href="source-code.html#cb181-13" tabindex="-1"></a>    <span class="co">#&#39; @param perc_cutoff_within_subclone_senstive same as in perc_cutoff_within_subclone_resistant but for the sensitive group</span></span>
<span id="cb181-14"><a href="source-code.html#cb181-14" tabindex="-1"></a>    <span class="co">#&#39; @param per_cutoff_across_subclone_resistant user defined percentage cutoff to use (e.g. 0.7 means a certain CNA is shared in 70% of all subclones)</span></span>
<span id="cb181-15"><a href="source-code.html#cb181-15" tabindex="-1"></a>    <span class="co">#&#39; @param return_cnas_per_subclone boolean. If TRUE will return the shared by perc_cutoff_within_subclone CNAs for each list of each item within </span></span>
<span id="cb181-16"><a href="source-code.html#cb181-16" tabindex="-1"></a>    <span class="co">#&#39; list_resistant. Note list_sensitive should be set to NULL for proper results!!</span></span>
<span id="cb181-17"><a href="source-code.html#cb181-17" tabindex="-1"></a>    <span class="co">#&#39; @param per_cutoff_across_subclone_sensitive same as resistant but for the sensitive group</span></span>
<span id="cb181-18"><a href="source-code.html#cb181-18" tabindex="-1"></a>    <span class="co">#&#39; @example perc_cutoff_within_subclone = 0.6 and per_cutoff_across_subclone = 0.7 means the algorithm will find CNAs that are shared </span></span>
<span id="cb181-19"><a href="source-code.html#cb181-19" tabindex="-1"></a>    <span class="co">#&#39; by 60% of single cells within each subclone, and by 70% of all subclones. Important, a cutoff of 50% is the same as computing the median.</span></span>
<span id="cb181-20"><a href="source-code.html#cb181-20" tabindex="-1"></a>    <span class="co">#&#39; @return a list of GRanges showing unique to list_resistant amplifications and deletions and unique to list_sensitive</span></span>
<span id="cb181-21"><a href="source-code.html#cb181-21" tabindex="-1"></a>    <span class="co">#&#39; amplifications and deletions or, if return_cnas_per_subclone see param return_cnas_per_subclone above.</span></span>
<span id="cb181-22"><a href="source-code.html#cb181-22" tabindex="-1"></a>    <span class="co">#&#39; @details Note that this algorithm is NOT sensitive to the number of single cells within each subclone. </span></span>
<span id="cb181-23"><a href="source-code.html#cb181-23" tabindex="-1"></a>    </span>
<span id="cb181-24"><a href="source-code.html#cb181-24" tabindex="-1"></a>    <span class="do">#############</span></span>
<span id="cb181-25"><a href="source-code.html#cb181-25" tabindex="-1"></a>    <span class="co"># Libraries #</span></span>
<span id="cb181-26"><a href="source-code.html#cb181-26" tabindex="-1"></a>    <span class="do">#############</span></span>
<span id="cb181-27"><a href="source-code.html#cb181-27" tabindex="-1"></a>    <span class="fu">require</span>(plyranges)</span>
<span id="cb181-28"><a href="source-code.html#cb181-28" tabindex="-1"></a>    <span class="fu">require</span>(AneuFinder)</span>
<span id="cb181-29"><a href="source-code.html#cb181-29" tabindex="-1"></a>    </span>
<span id="cb181-30"><a href="source-code.html#cb181-30" tabindex="-1"></a>    <span class="do">###########</span></span>
<span id="cb181-31"><a href="source-code.html#cb181-31" tabindex="-1"></a>    <span class="co"># Part 1. #</span></span>
<span id="cb181-32"><a href="source-code.html#cb181-32" tabindex="-1"></a>    <span class="do">###########</span></span>
<span id="cb181-33"><a href="source-code.html#cb181-33" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">&#39;Computing (this may take some minutes)...&#39;</span>)</span>
<span id="cb181-34"><a href="source-code.html#cb181-34" tabindex="-1"></a>    </span>
<span id="cb181-35"><a href="source-code.html#cb181-35" tabindex="-1"></a>    resistant_sc <span class="ot">&lt;-</span></span>
<span id="cb181-36"><a href="source-code.html#cb181-36" tabindex="-1"></a>      <span class="fu">lapply</span>(list_resistant,</span>
<span id="cb181-37"><a href="source-code.html#cb181-37" tabindex="-1"></a>             loadFromFiles,</span>
<span id="cb181-38"><a href="source-code.html#cb181-38" tabindex="-1"></a>             <span class="at">check.class =</span> <span class="fu">c</span>(<span class="st">&quot;aneuHMM&quot;</span>, <span class="st">&quot;aneuBiHMM&quot;</span>))</span>
<span id="cb181-39"><a href="source-code.html#cb181-39" tabindex="-1"></a>    sensitive_sc <span class="ot">&lt;-</span></span>
<span id="cb181-40"><a href="source-code.html#cb181-40" tabindex="-1"></a>      <span class="fu">lapply</span>(list_sensitive,</span>
<span id="cb181-41"><a href="source-code.html#cb181-41" tabindex="-1"></a>             loadFromFiles,</span>
<span id="cb181-42"><a href="source-code.html#cb181-42" tabindex="-1"></a>             <span class="at">check.class =</span> <span class="fu">c</span>(<span class="st">&quot;aneuHMM&quot;</span>, <span class="st">&quot;aneuBiHMM&quot;</span>))</span>
<span id="cb181-43"><a href="source-code.html#cb181-43" tabindex="-1"></a>    </span>
<span id="cb181-44"><a href="source-code.html#cb181-44" tabindex="-1"></a>    <span class="co"># find specific CNAs needs a list of GRanges where each GRange has columns</span></span>
<span id="cb181-45"><a href="source-code.html#cb181-45" tabindex="-1"></a>    <span class="co"># seqnames, ranges, strand (not necessary) and cn.</span></span>
<span id="cb181-46"><a href="source-code.html#cb181-46" tabindex="-1"></a>    wrangle_sc <span class="ot">&lt;-</span> <span class="cf">function</span>(list_lff) {</span>
<span id="cb181-47"><a href="source-code.html#cb181-47" tabindex="-1"></a>      <span class="co"># segments is the reduced bins GRange (so all equal CN bins put together)</span></span>
<span id="cb181-48"><a href="source-code.html#cb181-48" tabindex="-1"></a>      wrangle_within <span class="ot">&lt;-</span> <span class="cf">function</span>(list_lff_within) {</span>
<span id="cb181-49"><a href="source-code.html#cb181-49" tabindex="-1"></a>        segments <span class="ot">&lt;-</span> list_lff_within<span class="sc">$</span>segments</span>
<span id="cb181-50"><a href="source-code.html#cb181-50" tabindex="-1"></a>        <span class="co"># ugly way of adding a cn column</span></span>
<span id="cb181-51"><a href="source-code.html#cb181-51" tabindex="-1"></a>        segments<span class="sc">$</span>cn <span class="ot">&lt;-</span> segments<span class="sc">$</span>copy.number</span>
<span id="cb181-52"><a href="source-code.html#cb181-52" tabindex="-1"></a>        </span>
<span id="cb181-53"><a href="source-code.html#cb181-53" tabindex="-1"></a>        <span class="fu">return</span>(segments)</span>
<span id="cb181-54"><a href="source-code.html#cb181-54" tabindex="-1"></a>        </span>
<span id="cb181-55"><a href="source-code.html#cb181-55" tabindex="-1"></a>        <span class="co"># </span><span class="re">END</span><span class="co"> of wrange_within function</span></span>
<span id="cb181-56"><a href="source-code.html#cb181-56" tabindex="-1"></a>        </span>
<span id="cb181-57"><a href="source-code.html#cb181-57" tabindex="-1"></a>      }</span>
<span id="cb181-58"><a href="source-code.html#cb181-58" tabindex="-1"></a>      within_subcl <span class="ot">&lt;-</span> <span class="fu">lapply</span>(list_lff, wrangle_within)</span>
<span id="cb181-59"><a href="source-code.html#cb181-59" tabindex="-1"></a>      </span>
<span id="cb181-60"><a href="source-code.html#cb181-60" tabindex="-1"></a>      <span class="co"># </span><span class="re">END</span><span class="co"> OF wrangle_sc function</span></span>
<span id="cb181-61"><a href="source-code.html#cb181-61" tabindex="-1"></a>      </span>
<span id="cb181-62"><a href="source-code.html#cb181-62" tabindex="-1"></a>    }</span>
<span id="cb181-63"><a href="source-code.html#cb181-63" tabindex="-1"></a></span>
<span id="cb181-64"><a href="source-code.html#cb181-64" tabindex="-1"></a>    list_resistant <span class="ot">&lt;-</span> <span class="fu">lapply</span>(resistant_sc, wrangle_sc)</span>
<span id="cb181-65"><a href="source-code.html#cb181-65" tabindex="-1"></a>    list_sensitive <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sensitive_sc, wrangle_sc)</span>
<span id="cb181-66"><a href="source-code.html#cb181-66" tabindex="-1"></a>    </span>
<span id="cb181-67"><a href="source-code.html#cb181-67" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">&#39;Extracted segment info from files&#39;</span>)</span>
<span id="cb181-68"><a href="source-code.html#cb181-68" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">1</span>) </span>
<span id="cb181-69"><a href="source-code.html#cb181-69" tabindex="-1"></a>    </span>
<span id="cb181-70"><a href="source-code.html#cb181-70" tabindex="-1"></a>    <span class="do">###########</span></span>
<span id="cb181-71"><a href="source-code.html#cb181-71" tabindex="-1"></a>    <span class="co"># Part 2. #</span></span>
<span id="cb181-72"><a href="source-code.html#cb181-72" tabindex="-1"></a>    <span class="do">###########</span></span>
<span id="cb181-73"><a href="source-code.html#cb181-73" tabindex="-1"></a>    <span class="co"># The Granges are now still arranged in bins. We are first going to</span></span>
<span id="cb181-74"><a href="source-code.html#cb181-74" tabindex="-1"></a>    <span class="co"># combine bins with similar copy number.</span></span>
<span id="cb181-75"><a href="source-code.html#cb181-75" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">&#39;Computing (this may take some minutes)...&#39;</span>)</span>
<span id="cb181-76"><a href="source-code.html#cb181-76" tabindex="-1"></a>    combine_indels <span class="ot">&lt;-</span> <span class="cf">function</span>(subclone_consensus) {</span>
<span id="cb181-77"><a href="source-code.html#cb181-77" tabindex="-1"></a>      <span class="co">#&#39; @param subclone_consensus_list is a GRanges with seqnames, ranges, strand and cn</span></span>
<span id="cb181-78"><a href="source-code.html#cb181-78" tabindex="-1"></a>      <span class="co">#&#39; @returns list of Granges where each Granges has only CNA of cn2 or cn&gt;2</span></span>
<span id="cb181-79"><a href="source-code.html#cb181-79" tabindex="-1"></a>      </span>
<span id="cb181-80"><a href="source-code.html#cb181-80" tabindex="-1"></a>      combine_within <span class="ot">&lt;-</span> <span class="cf">function</span>(subclone_consensus_within) {</span>
<span id="cb181-81"><a href="source-code.html#cb181-81" tabindex="-1"></a>        <span class="co"># subset subclone_consensus in cn &lt;2, cn = 2 and cn &gt; 2</span></span>
<span id="cb181-82"><a href="source-code.html#cb181-82" tabindex="-1"></a>        cn_less_2 <span class="ot">&lt;-</span></span>
<span id="cb181-83"><a href="source-code.html#cb181-83" tabindex="-1"></a>          subclone_consensus_within[subclone_consensus_within<span class="sc">$</span>cn <span class="sc">&lt;</span> <span class="dv">2</span>,]</span>
<span id="cb181-84"><a href="source-code.html#cb181-84" tabindex="-1"></a>        cn_more_2 <span class="ot">&lt;-</span></span>
<span id="cb181-85"><a href="source-code.html#cb181-85" tabindex="-1"></a>          subclone_consensus_within[subclone_consensus_within<span class="sc">$</span>cn <span class="sc">&gt;</span> <span class="dv">2</span>,]</span>
<span id="cb181-86"><a href="source-code.html#cb181-86" tabindex="-1"></a>        </span>
<span id="cb181-87"><a href="source-code.html#cb181-87" tabindex="-1"></a>        <span class="co"># reduce each GRanges (joins consecutive ranges together)</span></span>
<span id="cb181-88"><a href="source-code.html#cb181-88" tabindex="-1"></a>        cn_less_2 <span class="ot">&lt;-</span> <span class="fu">reduce</span>(cn_less_2)</span>
<span id="cb181-89"><a href="source-code.html#cb181-89" tabindex="-1"></a>        cn_more_2 <span class="ot">&lt;-</span> <span class="fu">reduce</span>(cn_more_2)</span>
<span id="cb181-90"><a href="source-code.html#cb181-90" tabindex="-1"></a>        </span>
<span id="cb181-91"><a href="source-code.html#cb181-91" tabindex="-1"></a>        <span class="co"># reduce deletes metadata.</span></span>
<span id="cb181-92"><a href="source-code.html#cb181-92" tabindex="-1"></a>        <span class="co"># adding metadata</span></span>
<span id="cb181-93"><a href="source-code.html#cb181-93" tabindex="-1"></a>        cn_less_2<span class="sc">$</span>cn <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">&#39;&lt;2&#39;</span>, <span class="fu">length</span>(cn_less_2))</span>
<span id="cb181-94"><a href="source-code.html#cb181-94" tabindex="-1"></a>        </span>
<span id="cb181-95"><a href="source-code.html#cb181-95" tabindex="-1"></a>        cn_more_2<span class="sc">$</span>cn <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">&#39;&lt;2&#39;</span>, <span class="fu">length</span>(cn_more_2))</span>
<span id="cb181-96"><a href="source-code.html#cb181-96" tabindex="-1"></a>        </span>
<span id="cb181-97"><a href="source-code.html#cb181-97" tabindex="-1"></a>        <span class="co"># make list and rename items</span></span>
<span id="cb181-98"><a href="source-code.html#cb181-98" tabindex="-1"></a>        GR_list <span class="ot">&lt;-</span> <span class="fu">GRangesList</span>(cn_less_2, cn_more_2)</span>
<span id="cb181-99"><a href="source-code.html#cb181-99" tabindex="-1"></a>        <span class="fu">names</span>(GR_list) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;&lt;2&#39;</span>, <span class="st">&#39;&gt;2&#39;</span>)</span>
<span id="cb181-100"><a href="source-code.html#cb181-100" tabindex="-1"></a>        </span>
<span id="cb181-101"><a href="source-code.html#cb181-101" tabindex="-1"></a>        <span class="co"># Return #</span></span>
<span id="cb181-102"><a href="source-code.html#cb181-102" tabindex="-1"></a>        <span class="fu">return</span>(GR_list)</span>
<span id="cb181-103"><a href="source-code.html#cb181-103" tabindex="-1"></a>      }</span>
<span id="cb181-104"><a href="source-code.html#cb181-104" tabindex="-1"></a>      </span>
<span id="cb181-105"><a href="source-code.html#cb181-105" tabindex="-1"></a>      combine_subcl <span class="ot">&lt;-</span> <span class="fu">lapply</span>(subclone_consensus, combine_within)</span>
<span id="cb181-106"><a href="source-code.html#cb181-106" tabindex="-1"></a>      </span>
<span id="cb181-107"><a href="source-code.html#cb181-107" tabindex="-1"></a>    }</span>
<span id="cb181-108"><a href="source-code.html#cb181-108" tabindex="-1"></a>    </span>
<span id="cb181-109"><a href="source-code.html#cb181-109" tabindex="-1"></a>    <span class="co"># run an apply function here on each Granges in list_resistant versus list_sensitive</span></span>
<span id="cb181-110"><a href="source-code.html#cb181-110" tabindex="-1"></a>    resistant_split <span class="ot">&lt;-</span> <span class="fu">lapply</span>(list_resistant, combine_indels)</span>
<span id="cb181-111"><a href="source-code.html#cb181-111" tabindex="-1"></a>    sensitive_split <span class="ot">&lt;-</span> <span class="fu">lapply</span>(list_sensitive, combine_indels)</span>
<span id="cb181-112"><a href="source-code.html#cb181-112" tabindex="-1"></a>    </span>
<span id="cb181-113"><a href="source-code.html#cb181-113" tabindex="-1"></a>    <span class="co"># splits deletions together within each subclone</span></span>
<span id="cb181-114"><a href="source-code.html#cb181-114" tabindex="-1"></a>    grouper_del <span class="ot">&lt;-</span> <span class="cf">function</span>(gr) {</span>
<span id="cb181-115"><a href="source-code.html#cb181-115" tabindex="-1"></a>      grouper_within <span class="ot">&lt;-</span> <span class="cf">function</span>(gr_within) {</span>
<span id="cb181-116"><a href="source-code.html#cb181-116" tabindex="-1"></a>        <span class="fu">return</span>(gr_within<span class="sc">$</span><span class="st">&#39;&lt;2&#39;</span>)</span>
<span id="cb181-117"><a href="source-code.html#cb181-117" tabindex="-1"></a>      }</span>
<span id="cb181-118"><a href="source-code.html#cb181-118" tabindex="-1"></a>      </span>
<span id="cb181-119"><a href="source-code.html#cb181-119" tabindex="-1"></a>      within_grouper <span class="ot">&lt;-</span> <span class="fu">lapply</span>(gr, grouper_within)</span>
<span id="cb181-120"><a href="source-code.html#cb181-120" tabindex="-1"></a>    }</span>
<span id="cb181-121"><a href="source-code.html#cb181-121" tabindex="-1"></a>    </span>
<span id="cb181-122"><a href="source-code.html#cb181-122" tabindex="-1"></a>    <span class="co"># splits amplifciations together within each subclone</span></span>
<span id="cb181-123"><a href="source-code.html#cb181-123" tabindex="-1"></a>    grouper_ampl <span class="ot">&lt;-</span> <span class="cf">function</span>(gr) {</span>
<span id="cb181-124"><a href="source-code.html#cb181-124" tabindex="-1"></a>      grouper_within <span class="ot">&lt;-</span> <span class="cf">function</span>(gr_within) {</span>
<span id="cb181-125"><a href="source-code.html#cb181-125" tabindex="-1"></a>        <span class="fu">return</span>(gr_within<span class="sc">$</span><span class="st">&#39;&gt;2&#39;</span>)</span>
<span id="cb181-126"><a href="source-code.html#cb181-126" tabindex="-1"></a>      }</span>
<span id="cb181-127"><a href="source-code.html#cb181-127" tabindex="-1"></a>      </span>
<span id="cb181-128"><a href="source-code.html#cb181-128" tabindex="-1"></a>      within_grouper <span class="ot">&lt;-</span> <span class="fu">lapply</span>(gr, grouper_within)</span>
<span id="cb181-129"><a href="source-code.html#cb181-129" tabindex="-1"></a>    }</span>
<span id="cb181-130"><a href="source-code.html#cb181-130" tabindex="-1"></a>    </span>
<span id="cb181-131"><a href="source-code.html#cb181-131" tabindex="-1"></a>    <span class="co"># run apply on each subclone</span></span>
<span id="cb181-132"><a href="source-code.html#cb181-132" tabindex="-1"></a>    resistant_split_del <span class="ot">&lt;-</span> <span class="fu">lapply</span>(resistant_split, grouper_del)</span>
<span id="cb181-133"><a href="source-code.html#cb181-133" tabindex="-1"></a>    resistant_split_ampl <span class="ot">&lt;-</span> <span class="fu">lapply</span>(resistant_split, grouper_ampl)</span>
<span id="cb181-134"><a href="source-code.html#cb181-134" tabindex="-1"></a>    </span>
<span id="cb181-135"><a href="source-code.html#cb181-135" tabindex="-1"></a>    sensitive_split_del <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sensitive_split, grouper_del)</span>
<span id="cb181-136"><a href="source-code.html#cb181-136" tabindex="-1"></a>    sensitive_split_ampl <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sensitive_split, grouper_ampl)</span>
<span id="cb181-137"><a href="source-code.html#cb181-137" tabindex="-1"></a>    </span>
<span id="cb181-138"><a href="source-code.html#cb181-138" tabindex="-1"></a>    <span class="do">###########</span></span>
<span id="cb181-139"><a href="source-code.html#cb181-139" tabindex="-1"></a>    <span class="co"># Part 3. #</span></span>
<span id="cb181-140"><a href="source-code.html#cb181-140" tabindex="-1"></a>    <span class="do">###########</span></span>
<span id="cb181-141"><a href="source-code.html#cb181-141" tabindex="-1"></a>    <span class="co"># Part 3A #</span></span>
<span id="cb181-142"><a href="source-code.html#cb181-142" tabindex="-1"></a>    <span class="do">###########</span></span>
<span id="cb181-143"><a href="source-code.html#cb181-143" tabindex="-1"></a>    <span class="co"># Finding common CNAs within each subclone</span></span>
<span id="cb181-144"><a href="source-code.html#cb181-144" tabindex="-1"></a>    shared_cnas <span class="ot">&lt;-</span></span>
<span id="cb181-145"><a href="source-code.html#cb181-145" tabindex="-1"></a>      <span class="cf">function</span>(list_GRanges,</span>
<span id="cb181-146"><a href="source-code.html#cb181-146" tabindex="-1"></a>               perc_cutoff_within_subclone) {</span>
<span id="cb181-147"><a href="source-code.html#cb181-147" tabindex="-1"></a>        <span class="co">#&#39; @param list_GRanges is a list of GRanges with seqnames, ranges, strand and cn</span></span>
<span id="cb181-148"><a href="source-code.html#cb181-148" tabindex="-1"></a>        <span class="co">#&#39; @param perc_cutoff_within_subclone user defined percentage cutoff to use (e.g. 0.6)</span></span>
<span id="cb181-149"><a href="source-code.html#cb181-149" tabindex="-1"></a>        <span class="co">#&#39; @returns Granges where each Granges is shared by =&gt; perc_cutoff_within_subclone</span></span>
<span id="cb181-150"><a href="source-code.html#cb181-150" tabindex="-1"></a>        </span>
<span id="cb181-151"><a href="source-code.html#cb181-151" tabindex="-1"></a>        <span class="co"># finding overlaps in x% of regions: wait for response community:</span></span>
<span id="cb181-152"><a href="source-code.html#cb181-152" tabindex="-1"></a>        <span class="co"># https://stackoverflow.com/questions/74900085/find-ranges-that-are-shared-by-80-or-more-of-10-granges-objects</span></span>
<span id="cb181-153"><a href="source-code.html#cb181-153" tabindex="-1"></a>        <span class="co"># https://support.bioconductor.org/p/9148540/</span></span>
<span id="cb181-154"><a href="source-code.html#cb181-154" tabindex="-1"></a>        </span>
<span id="cb181-155"><a href="source-code.html#cb181-155" tabindex="-1"></a>        shared_cnas_within <span class="ot">&lt;-</span> <span class="cf">function</span>(list_GRanges_within) {</span>
<span id="cb181-156"><a href="source-code.html#cb181-156" tabindex="-1"></a>          n <span class="ot">&lt;-</span> <span class="fu">length</span>(list_GRanges_within) <span class="co"># number of range sets</span></span>
<span id="cb181-157"><a href="source-code.html#cb181-157" tabindex="-1"></a>          shared_cna <span class="ot">&lt;-</span></span>
<span id="cb181-158"><a href="source-code.html#cb181-158" tabindex="-1"></a>            <span class="fu">bind_ranges</span>(list_GRanges_within, <span class="at">.id =</span> <span class="st">&quot;origin&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb181-159"><a href="source-code.html#cb181-159" tabindex="-1"></a>            <span class="fu">compute_coverage</span>() <span class="sc">%&gt;%</span></span>
<span id="cb181-160"><a href="source-code.html#cb181-160" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">fraction_cov =</span> score <span class="sc">/</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb181-161"><a href="source-code.html#cb181-161" tabindex="-1"></a>            <span class="fu">filter</span>(fraction_cov <span class="sc">&gt;=</span> perc_cutoff_within_subclone) <span class="sc">%&gt;%</span></span>
<span id="cb181-162"><a href="source-code.html#cb181-162" tabindex="-1"></a>            <span class="fu">reduce_ranges</span>()</span>
<span id="cb181-163"><a href="source-code.html#cb181-163" tabindex="-1"></a>          </span>
<span id="cb181-164"><a href="source-code.html#cb181-164" tabindex="-1"></a>          <span class="fu">return</span>(shared_cna)</span>
<span id="cb181-165"><a href="source-code.html#cb181-165" tabindex="-1"></a>        }</span>
<span id="cb181-166"><a href="source-code.html#cb181-166" tabindex="-1"></a>        </span>
<span id="cb181-167"><a href="source-code.html#cb181-167" tabindex="-1"></a>        <span class="fu">lapply</span>(list_GRanges, shared_cnas_within)</span>
<span id="cb181-168"><a href="source-code.html#cb181-168" tabindex="-1"></a>      }</span>
<span id="cb181-169"><a href="source-code.html#cb181-169" tabindex="-1"></a>    </span>
<span id="cb181-170"><a href="source-code.html#cb181-170" tabindex="-1"></a>    resistant_shared_del <span class="ot">&lt;-</span></span>
<span id="cb181-171"><a href="source-code.html#cb181-171" tabindex="-1"></a>      <span class="fu">shared_cnas</span>(resistant_split_del, <span class="at">perc_cutoff_within_subclone =</span> perc_cutoff_within_subclone_resistant)</span>
<span id="cb181-172"><a href="source-code.html#cb181-172" tabindex="-1"></a>    resistant_shared_ampl <span class="ot">&lt;-</span></span>
<span id="cb181-173"><a href="source-code.html#cb181-173" tabindex="-1"></a>      <span class="fu">shared_cnas</span>(resistant_split_ampl, <span class="at">perc_cutoff_within_subclone =</span> perc_cutoff_within_subclone_resistant)</span>
<span id="cb181-174"><a href="source-code.html#cb181-174" tabindex="-1"></a>    sensitive_shared_del <span class="ot">&lt;-</span></span>
<span id="cb181-175"><a href="source-code.html#cb181-175" tabindex="-1"></a>      <span class="fu">shared_cnas</span>(sensitive_split_del, <span class="at">perc_cutoff_within_subclone =</span> perc_cutoff_within_subclone_sensitive)</span>
<span id="cb181-176"><a href="source-code.html#cb181-176" tabindex="-1"></a>    sensitive_shared_ampl <span class="ot">&lt;-</span></span>
<span id="cb181-177"><a href="source-code.html#cb181-177" tabindex="-1"></a>      <span class="fu">shared_cnas</span>(sensitive_split_ampl, <span class="at">perc_cutoff_within_subclone =</span> perc_cutoff_within_subclone_sensitive)</span>
<span id="cb181-178"><a href="source-code.html#cb181-178" tabindex="-1"></a>    </span>
<span id="cb181-179"><a href="source-code.html#cb181-179" tabindex="-1"></a>    <span class="co"># </span><span class="re">END</span><span class="co"> of function if return_cnas_per_subclone == T</span></span>
<span id="cb181-180"><a href="source-code.html#cb181-180" tabindex="-1"></a>    <span class="cf">if</span> (return_cnas_per_subclone <span class="sc">==</span> T) {</span>
<span id="cb181-181"><a href="source-code.html#cb181-181" tabindex="-1"></a>      cna_list <span class="ot">&lt;-</span> <span class="fu">list</span> (<span class="at">deletions =</span> <span class="fu">c</span>(resistant_shared_del, sensitive_shared_del), </span>
<span id="cb181-182"><a href="source-code.html#cb181-182" tabindex="-1"></a>                        <span class="at">amplifications =</span> <span class="fu">c</span>(resistant_shared_ampl, sensitive_shared_del))</span>
<span id="cb181-183"><a href="source-code.html#cb181-183" tabindex="-1"></a>      </span>
<span id="cb181-184"><a href="source-code.html#cb181-184" tabindex="-1"></a>      <span class="fu">print</span>(</span>
<span id="cb181-185"><a href="source-code.html#cb181-185" tabindex="-1"></a>        <span class="fu">paste0</span>(</span>
<span id="cb181-186"><a href="source-code.html#cb181-186" tabindex="-1"></a>          <span class="st">&#39;Extracted CNAs that are shared by &#39;</span>,</span>
<span id="cb181-187"><a href="source-code.html#cb181-187" tabindex="-1"></a>          <span class="fu">as.numeric</span>(perc_cutoff_within_subclone_resistant) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb181-188"><a href="source-code.html#cb181-188" tabindex="-1"></a>          <span class="st">&#39;% of single cells within each resistant subclone, and by &#39;</span>,</span>
<span id="cb181-189"><a href="source-code.html#cb181-189" tabindex="-1"></a>          <span class="fu">as.numeric</span>(perc_cutoff_within_subclone_sensitive) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb181-190"><a href="source-code.html#cb181-190" tabindex="-1"></a>          <span class="st">&#39;% of single cells within each sensitive subclone&#39;</span></span>
<span id="cb181-191"><a href="source-code.html#cb181-191" tabindex="-1"></a>        )</span>
<span id="cb181-192"><a href="source-code.html#cb181-192" tabindex="-1"></a>      )</span>
<span id="cb181-193"><a href="source-code.html#cb181-193" tabindex="-1"></a>      <span class="do">##########</span></span>
<span id="cb181-194"><a href="source-code.html#cb181-194" tabindex="-1"></a>      <span class="co"># Unload #</span></span>
<span id="cb181-195"><a href="source-code.html#cb181-195" tabindex="-1"></a>      <span class="do">##########</span></span>
<span id="cb181-196"><a href="source-code.html#cb181-196" tabindex="-1"></a>      <span class="fu">suppressWarnings</span>(<span class="fu">invisible</span>(<span class="fu">lapply</span>(<span class="fu">paste0</span>(<span class="st">&quot;package:&quot;</span>, <span class="fu">names</span>(<span class="fu">sessionInfo</span>()<span class="sc">$</span>otherPkgs)),   <span class="co"># Unload add-on packages</span></span>
<span id="cb181-197"><a href="source-code.html#cb181-197" tabindex="-1"></a>                                        detach,</span>
<span id="cb181-198"><a href="source-code.html#cb181-198" tabindex="-1"></a>                                        <span class="at">character.only =</span> <span class="cn">TRUE</span>, <span class="at">unload =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb181-199"><a href="source-code.html#cb181-199" tabindex="-1"></a>      </span>
<span id="cb181-200"><a href="source-code.html#cb181-200" tabindex="-1"></a>      <span class="fu">return</span>(cna_list)</span>
<span id="cb181-201"><a href="source-code.html#cb181-201" tabindex="-1"></a>    }</span>
<span id="cb181-202"><a href="source-code.html#cb181-202" tabindex="-1"></a>    </span>
<span id="cb181-203"><a href="source-code.html#cb181-203" tabindex="-1"></a>    <span class="co"># Part 3B #</span></span>
<span id="cb181-204"><a href="source-code.html#cb181-204" tabindex="-1"></a>    <span class="do">###########</span></span>
<span id="cb181-205"><a href="source-code.html#cb181-205" tabindex="-1"></a>    <span class="co"># Finding common CNAs across subclones</span></span>
<span id="cb181-206"><a href="source-code.html#cb181-206" tabindex="-1"></a>    shared_cnas_across_subclones <span class="ot">&lt;-</span></span>
<span id="cb181-207"><a href="source-code.html#cb181-207" tabindex="-1"></a>      <span class="cf">function</span>(list_GRanges,</span>
<span id="cb181-208"><a href="source-code.html#cb181-208" tabindex="-1"></a>               per_cutoff_across_subclone) {</span>
<span id="cb181-209"><a href="source-code.html#cb181-209" tabindex="-1"></a>        <span class="co">#&#39; @param list_GRanges is a list of GRanges with seqnames, ranges, strand and cn</span></span>
<span id="cb181-210"><a href="source-code.html#cb181-210" tabindex="-1"></a>        <span class="co">#&#39; @param perc_cutoff user defined percentage cutoff to use (e.g. 0.6)</span></span>
<span id="cb181-211"><a href="source-code.html#cb181-211" tabindex="-1"></a>        <span class="co">#&#39; @returns Granges where each Granges is shared by =&gt; perc_cutoff_within_subclone</span></span>
<span id="cb181-212"><a href="source-code.html#cb181-212" tabindex="-1"></a>        </span>
<span id="cb181-213"><a href="source-code.html#cb181-213" tabindex="-1"></a>        <span class="co"># finding overlaps in x% of regions: wait for response community:</span></span>
<span id="cb181-214"><a href="source-code.html#cb181-214" tabindex="-1"></a>        <span class="co"># https://stackoverflow.com/questions/74900085/find-ranges-that-are-shared-by-80-or-more-of-10-granges-objects</span></span>
<span id="cb181-215"><a href="source-code.html#cb181-215" tabindex="-1"></a>        <span class="co"># https://support.bioconductor.org/p/9148540/</span></span>
<span id="cb181-216"><a href="source-code.html#cb181-216" tabindex="-1"></a>        </span>
<span id="cb181-217"><a href="source-code.html#cb181-217" tabindex="-1"></a>        n <span class="ot">&lt;-</span> <span class="fu">length</span>(list_GRanges) <span class="co"># number of range sets</span></span>
<span id="cb181-218"><a href="source-code.html#cb181-218" tabindex="-1"></a>        shared_cna <span class="ot">&lt;-</span></span>
<span id="cb181-219"><a href="source-code.html#cb181-219" tabindex="-1"></a>          <span class="fu">bind_ranges</span>(list_GRanges, <span class="at">.id =</span> <span class="st">&quot;origin&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb181-220"><a href="source-code.html#cb181-220" tabindex="-1"></a>          <span class="fu">compute_coverage</span>() <span class="sc">%&gt;%</span></span>
<span id="cb181-221"><a href="source-code.html#cb181-221" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">fraction_cov =</span> score <span class="sc">/</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb181-222"><a href="source-code.html#cb181-222" tabindex="-1"></a>          <span class="fu">filter</span>(fraction_cov <span class="sc">&gt;=</span> per_cutoff_across_subclone) <span class="sc">%&gt;%</span></span>
<span id="cb181-223"><a href="source-code.html#cb181-223" tabindex="-1"></a>          <span class="fu">reduce_ranges</span>()</span>
<span id="cb181-224"><a href="source-code.html#cb181-224" tabindex="-1"></a>        </span>
<span id="cb181-225"><a href="source-code.html#cb181-225" tabindex="-1"></a>        <span class="fu">return</span>(shared_cna)</span>
<span id="cb181-226"><a href="source-code.html#cb181-226" tabindex="-1"></a>        </span>
<span id="cb181-227"><a href="source-code.html#cb181-227" tabindex="-1"></a>      }</span>
<span id="cb181-228"><a href="source-code.html#cb181-228" tabindex="-1"></a>    </span>
<span id="cb181-229"><a href="source-code.html#cb181-229" tabindex="-1"></a>    resistant_shared_del_across <span class="ot">&lt;-</span></span>
<span id="cb181-230"><a href="source-code.html#cb181-230" tabindex="-1"></a>      <span class="fu">shared_cnas_across_subclones</span>(resistant_shared_del, <span class="at">per_cutoff_across_subclone =</span> per_cutoff_across_subclone_resistant)</span>
<span id="cb181-231"><a href="source-code.html#cb181-231" tabindex="-1"></a>    resistant_shared_ampl_across <span class="ot">&lt;-</span></span>
<span id="cb181-232"><a href="source-code.html#cb181-232" tabindex="-1"></a>      <span class="fu">shared_cnas_across_subclones</span>(resistant_shared_ampl, <span class="at">per_cutoff_across_subclone =</span> per_cutoff_across_subclone_resistant)</span>
<span id="cb181-233"><a href="source-code.html#cb181-233" tabindex="-1"></a>    sensitive_shared_del_across <span class="ot">&lt;-</span></span>
<span id="cb181-234"><a href="source-code.html#cb181-234" tabindex="-1"></a>      <span class="fu">shared_cnas_across_subclones</span>(sensitive_shared_del, <span class="at">per_cutoff_across_subclone =</span> per_cutoff_across_subclone_sensitive)</span>
<span id="cb181-235"><a href="source-code.html#cb181-235" tabindex="-1"></a>    sensitive_shared_ampl_across <span class="ot">&lt;-</span></span>
<span id="cb181-236"><a href="source-code.html#cb181-236" tabindex="-1"></a>      <span class="fu">shared_cnas_across_subclones</span>(sensitive_shared_ampl, <span class="at">per_cutoff_across_subclone =</span> per_cutoff_across_subclone_sensitive)</span>
<span id="cb181-237"><a href="source-code.html#cb181-237" tabindex="-1"></a>    </span>
<span id="cb181-238"><a href="source-code.html#cb181-238" tabindex="-1"></a>    <span class="fu">print</span>(</span>
<span id="cb181-239"><a href="source-code.html#cb181-239" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb181-240"><a href="source-code.html#cb181-240" tabindex="-1"></a>        <span class="st">&#39;Extracted CNAs that are shared by &#39;</span>,</span>
<span id="cb181-241"><a href="source-code.html#cb181-241" tabindex="-1"></a>        <span class="fu">as.numeric</span>(perc_cutoff_within_subclone_resistant) <span class="sc">*</span> <span class="dv">100</span>, <span class="st">&#39; and &#39;</span>, <span class="fu">as.numeric</span>(perc_cutoff_within_subclone_sensitive) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb181-242"><a href="source-code.html#cb181-242" tabindex="-1"></a>        <span class="st">&#39;% of single cells within resistant and sensitive subclones, respectively, and that are shared by &#39;</span>,</span>
<span id="cb181-243"><a href="source-code.html#cb181-243" tabindex="-1"></a>        <span class="fu">as.numeric</span>(per_cutoff_across_subclone_resistant) <span class="sc">*</span> <span class="dv">100</span>, <span class="st">&#39; and &#39;</span>, <span class="fu">as.numeric</span>(per_cutoff_across_subclone_sensitive) <span class="sc">*</span> <span class="dv">100</span>, </span>
<span id="cb181-244"><a href="source-code.html#cb181-244" tabindex="-1"></a>        <span class="st">&#39;% across resistant and sensitive subclones, respectively.&#39;</span></span>
<span id="cb181-245"><a href="source-code.html#cb181-245" tabindex="-1"></a>      )</span>
<span id="cb181-246"><a href="source-code.html#cb181-246" tabindex="-1"></a>    )</span>
<span id="cb181-247"><a href="source-code.html#cb181-247" tabindex="-1"></a>    </span>
<span id="cb181-248"><a href="source-code.html#cb181-248" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">1</span>) </span>
<span id="cb181-249"><a href="source-code.html#cb181-249" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">&#39;Computing (few seconds)...&#39;</span>)</span>
<span id="cb181-250"><a href="source-code.html#cb181-250" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">2</span>) </span>
<span id="cb181-251"><a href="source-code.html#cb181-251" tabindex="-1"></a>    </span>
<span id="cb181-252"><a href="source-code.html#cb181-252" tabindex="-1"></a>    <span class="do">###########</span></span>
<span id="cb181-253"><a href="source-code.html#cb181-253" tabindex="-1"></a>    <span class="co"># Part 4. #</span></span>
<span id="cb181-254"><a href="source-code.html#cb181-254" tabindex="-1"></a>    <span class="do">###########</span></span>
<span id="cb181-255"><a href="source-code.html#cb181-255" tabindex="-1"></a>    <span class="co"># Now that we have shared CNAs across subclones with the resistant and sensitive group, we need to extract</span></span>
<span id="cb181-256"><a href="source-code.html#cb181-256" tabindex="-1"></a>    <span class="co"># only those CNAs that are unique to the resistant group.</span></span>
<span id="cb181-257"><a href="source-code.html#cb181-257" tabindex="-1"></a>    </span>
<span id="cb181-258"><a href="source-code.html#cb181-258" tabindex="-1"></a>    <span class="co"># unique to resistant lines deletions:</span></span>
<span id="cb181-259"><a href="source-code.html#cb181-259" tabindex="-1"></a>    unique_resistant_del <span class="ot">&lt;-</span></span>
<span id="cb181-260"><a href="source-code.html#cb181-260" tabindex="-1"></a>      <span class="fu">setdiff</span>(resistant_shared_del_across, sensitive_shared_del_across)</span>
<span id="cb181-261"><a href="source-code.html#cb181-261" tabindex="-1"></a>    <span class="co"># unique to resistant lines amplifications</span></span>
<span id="cb181-262"><a href="source-code.html#cb181-262" tabindex="-1"></a>    unique_resistant_ampl <span class="ot">&lt;-</span></span>
<span id="cb181-263"><a href="source-code.html#cb181-263" tabindex="-1"></a>      <span class="fu">setdiff</span>(resistant_shared_ampl_across,</span>
<span id="cb181-264"><a href="source-code.html#cb181-264" tabindex="-1"></a>              sensitive_shared_ampl_across)</span>
<span id="cb181-265"><a href="source-code.html#cb181-265" tabindex="-1"></a>    </span>
<span id="cb181-266"><a href="source-code.html#cb181-266" tabindex="-1"></a>    <span class="co"># unique to sensitive lines deletions:</span></span>
<span id="cb181-267"><a href="source-code.html#cb181-267" tabindex="-1"></a>    unique_sensitive_del <span class="ot">&lt;-</span></span>
<span id="cb181-268"><a href="source-code.html#cb181-268" tabindex="-1"></a>      <span class="fu">setdiff</span>(sensitive_shared_del_across, resistant_shared_del_across)</span>
<span id="cb181-269"><a href="source-code.html#cb181-269" tabindex="-1"></a>    <span class="co"># unique to sensitive lines amplifications:</span></span>
<span id="cb181-270"><a href="source-code.html#cb181-270" tabindex="-1"></a>    unique_sensitive_ampl <span class="ot">&lt;-</span></span>
<span id="cb181-271"><a href="source-code.html#cb181-271" tabindex="-1"></a>      <span class="fu">setdiff</span>(sensitive_shared_ampl_across,</span>
<span id="cb181-272"><a href="source-code.html#cb181-272" tabindex="-1"></a>              resistant_shared_ampl_across)</span>
<span id="cb181-273"><a href="source-code.html#cb181-273" tabindex="-1"></a>    </span>
<span id="cb181-274"><a href="source-code.html#cb181-274" tabindex="-1"></a>    <span class="fu">print</span>(</span>
<span id="cb181-275"><a href="source-code.html#cb181-275" tabindex="-1"></a>      <span class="st">&#39;Identified amplifications and deletions that are unique to resistant or sensitive subclones&#39;</span></span>
<span id="cb181-276"><a href="source-code.html#cb181-276" tabindex="-1"></a>    )</span>
<span id="cb181-277"><a href="source-code.html#cb181-277" tabindex="-1"></a>    </span>
<span id="cb181-278"><a href="source-code.html#cb181-278" tabindex="-1"></a>    <span class="do">##########</span></span>
<span id="cb181-279"><a href="source-code.html#cb181-279" tabindex="-1"></a>    <span class="co"># Return #</span></span>
<span id="cb181-280"><a href="source-code.html#cb181-280" tabindex="-1"></a>    <span class="do">##########</span></span>
<span id="cb181-281"><a href="source-code.html#cb181-281" tabindex="-1"></a>    returner <span class="ot">&lt;-</span></span>
<span id="cb181-282"><a href="source-code.html#cb181-282" tabindex="-1"></a>      <span class="fu">list</span>(</span>
<span id="cb181-283"><a href="source-code.html#cb181-283" tabindex="-1"></a>        unique_resistant_del,</span>
<span id="cb181-284"><a href="source-code.html#cb181-284" tabindex="-1"></a>        unique_resistant_ampl,</span>
<span id="cb181-285"><a href="source-code.html#cb181-285" tabindex="-1"></a>        unique_sensitive_del,</span>
<span id="cb181-286"><a href="source-code.html#cb181-286" tabindex="-1"></a>        unique_sensitive_ampl</span>
<span id="cb181-287"><a href="source-code.html#cb181-287" tabindex="-1"></a>      )</span>
<span id="cb181-288"><a href="source-code.html#cb181-288" tabindex="-1"></a>    <span class="fu">names</span>(returner) <span class="ot">&lt;-</span></span>
<span id="cb181-289"><a href="source-code.html#cb181-289" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb181-290"><a href="source-code.html#cb181-290" tabindex="-1"></a>        <span class="st">&#39;unique_resistant_del&#39;</span>,</span>
<span id="cb181-291"><a href="source-code.html#cb181-291" tabindex="-1"></a>        <span class="st">&#39;unique_resistant_ampl&#39;</span>,</span>
<span id="cb181-292"><a href="source-code.html#cb181-292" tabindex="-1"></a>        <span class="st">&#39;unique_sensitive_del&#39;</span>,</span>
<span id="cb181-293"><a href="source-code.html#cb181-293" tabindex="-1"></a>        <span class="st">&#39;unique_sensitive_ampl&#39;</span></span>
<span id="cb181-294"><a href="source-code.html#cb181-294" tabindex="-1"></a>      )</span>
<span id="cb181-295"><a href="source-code.html#cb181-295" tabindex="-1"></a>    </span>
<span id="cb181-296"><a href="source-code.html#cb181-296" tabindex="-1"></a>    <span class="do">##########</span></span>
<span id="cb181-297"><a href="source-code.html#cb181-297" tabindex="-1"></a>    <span class="co"># Unload #</span></span>
<span id="cb181-298"><a href="source-code.html#cb181-298" tabindex="-1"></a>    <span class="do">##########</span></span>
<span id="cb181-299"><a href="source-code.html#cb181-299" tabindex="-1"></a>    <span class="fu">suppressWarnings</span>(<span class="fu">invisible</span>(<span class="fu">lapply</span>(<span class="fu">paste0</span>(<span class="st">&quot;package:&quot;</span>, <span class="fu">names</span>(<span class="fu">sessionInfo</span>()<span class="sc">$</span>otherPkgs)),   <span class="co"># Unload add-on packages</span></span>
<span id="cb181-300"><a href="source-code.html#cb181-300" tabindex="-1"></a>                     detach,</span>
<span id="cb181-301"><a href="source-code.html#cb181-301" tabindex="-1"></a>                     <span class="at">character.only =</span> <span class="cn">TRUE</span>, <span class="at">unload =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb181-302"><a href="source-code.html#cb181-302" tabindex="-1"></a>    </span>
<span id="cb181-303"><a href="source-code.html#cb181-303" tabindex="-1"></a>    <span class="fu">return</span>(returner)</span>
<span id="cb181-304"><a href="source-code.html#cb181-304" tabindex="-1"></a>  }</span></code></pre></div>
</div>
<div id="get_cytoband_coverage-script-get_cytoband_coverage-function" class="section level2 hasAnchor" number="6.11">
<h2><span class="header-section-number">6.11</span> get_cytoband_coverage script: ‘get_cytoband_coverage’ function<a href="source-code.html#get_cytoband_coverage-script-get_cytoband_coverage-function" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="source-code.html#cb182-1" tabindex="-1"></a>get_cytoband_coverage <span class="ot">&lt;-</span> <span class="cf">function</span>(Grange) {</span>
<span id="cb182-2"><a href="source-code.html#cb182-2" tabindex="-1"></a>  <span class="co">#&#39; @param Grange a grange with seqnames and granges.</span></span>
<span id="cb182-3"><a href="source-code.html#cb182-3" tabindex="-1"></a>  <span class="co">#&#39; @returns returns a GRange with cytogenetic locations including</span></span>
<span id="cb182-4"><a href="source-code.html#cb182-4" tabindex="-1"></a>  <span class="co">#&#39; percentage of overlap and a dataframe containing information on how much of</span></span>
<span id="cb182-5"><a href="source-code.html#cb182-5" tabindex="-1"></a>  <span class="co">#&#39; the total arm was affected.</span></span>
<span id="cb182-6"><a href="source-code.html#cb182-6" tabindex="-1"></a>  </span>
<span id="cb182-7"><a href="source-code.html#cb182-7" tabindex="-1"></a>  <span class="do">#############</span></span>
<span id="cb182-8"><a href="source-code.html#cb182-8" tabindex="-1"></a>  <span class="co"># Libraries #</span></span>
<span id="cb182-9"><a href="source-code.html#cb182-9" tabindex="-1"></a>  <span class="do">#############</span></span>
<span id="cb182-10"><a href="source-code.html#cb182-10" tabindex="-1"></a>  <span class="fu">require</span>(tidyverse)</span>
<span id="cb182-11"><a href="source-code.html#cb182-11" tabindex="-1"></a>  <span class="fu">require</span>(plyranges)</span>
<span id="cb182-12"><a href="source-code.html#cb182-12" tabindex="-1"></a>  </span>
<span id="cb182-13"><a href="source-code.html#cb182-13" tabindex="-1"></a>  <span class="do">########</span></span>
<span id="cb182-14"><a href="source-code.html#cb182-14" tabindex="-1"></a>  <span class="co"># Data #</span></span>
<span id="cb182-15"><a href="source-code.html#cb182-15" tabindex="-1"></a>  <span class="do">########</span></span>
<span id="cb182-16"><a href="source-code.html#cb182-16" tabindex="-1"></a>  <span class="co"># Uncomment me, this is to download cytogenetic coordinates</span></span>
<span id="cb182-17"><a href="source-code.html#cb182-17" tabindex="-1"></a>  <span class="co"># library(biovizBase)</span></span>
<span id="cb182-18"><a href="source-code.html#cb182-18" tabindex="-1"></a>  <span class="co"># hg38IdeogramCyto &lt;- getIdeogram(&quot;hg38&quot;, cytobands = TRUE)</span></span>
<span id="cb182-19"><a href="source-code.html#cb182-19" tabindex="-1"></a>  <span class="co"># save(hg38IdeogramCyto, file = &#39;rda/cna_analysis/hg38IdeogramCyto.rda&#39;)</span></span>
<span id="cb182-20"><a href="source-code.html#cb182-20" tabindex="-1"></a>  </span>
<span id="cb182-21"><a href="source-code.html#cb182-21" tabindex="-1"></a>  <span class="co"># !!! ADDING ../cna_analysis for publication in GitHub !!!</span></span>
<span id="cb182-22"><a href="source-code.html#cb182-22" tabindex="-1"></a>  <span class="fu">load</span>(<span class="st">&#39;../cna_analysis/rda/cna_analysis/hg38IdeogramCyto.rda&#39;</span>)</span>
<span id="cb182-23"><a href="source-code.html#cb182-23" tabindex="-1"></a>  </span>
<span id="cb182-24"><a href="source-code.html#cb182-24" tabindex="-1"></a>  </span>
<span id="cb182-25"><a href="source-code.html#cb182-25" tabindex="-1"></a>  <span class="do">###########</span></span>
<span id="cb182-26"><a href="source-code.html#cb182-26" tabindex="-1"></a>  <span class="co"># Wrangle #</span></span>
<span id="cb182-27"><a href="source-code.html#cb182-27" tabindex="-1"></a>  <span class="do">###########</span></span>
<span id="cb182-28"><a href="source-code.html#cb182-28" tabindex="-1"></a>  <span class="co"># Convert both GRanges to similar karyogram style</span></span>
<span id="cb182-29"><a href="source-code.html#cb182-29" tabindex="-1"></a>  <span class="fu">seqlevelsStyle</span>(Grange) <span class="ot">&lt;-</span> <span class="st">&quot;NCBI&quot;</span></span>
<span id="cb182-30"><a href="source-code.html#cb182-30" tabindex="-1"></a>  <span class="fu">seqlevelsStyle</span>(hg38IdeogramCyto) <span class="ot">&lt;-</span> <span class="st">&quot;NCBI&quot;</span></span>
<span id="cb182-31"><a href="source-code.html#cb182-31" tabindex="-1"></a>  </span>
<span id="cb182-32"><a href="source-code.html#cb182-32" tabindex="-1"></a>  Grange_list_cytoband <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb182-33"><a href="source-code.html#cb182-33" tabindex="-1"></a>  Grange_list_pq_affected <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb182-34"><a href="source-code.html#cb182-34" tabindex="-1"></a>  </span>
<span id="cb182-35"><a href="source-code.html#cb182-35" tabindex="-1"></a>  <span class="co"># return empty Grange and empty data.frame if Grange is empty</span></span>
<span id="cb182-36"><a href="source-code.html#cb182-36" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(Grange) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb182-37"><a href="source-code.html#cb182-37" tabindex="-1"></a>    <span class="co"># return empty Grange</span></span>
<span id="cb182-38"><a href="source-code.html#cb182-38" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="fu">GRanges</span>(</span>
<span id="cb182-39"><a href="source-code.html#cb182-39" tabindex="-1"></a>      <span class="at">seqnames =</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb182-40"><a href="source-code.html#cb182-40" tabindex="-1"></a>      <span class="fu">IRanges</span>(<span class="at">start =</span> <span class="fu">integer</span>(<span class="dv">0</span>), <span class="at">end =</span> <span class="fu">integer</span>(<span class="dv">0</span>)),</span>
<span id="cb182-41"><a href="source-code.html#cb182-41" tabindex="-1"></a>      <span class="at">cytobands_cov =</span>  <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb182-42"><a href="source-code.html#cb182-42" tabindex="-1"></a>    ),</span>
<span id="cb182-43"><a href="source-code.html#cb182-43" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">seqnames =</span> <span class="fu">character</span>(), </span>
<span id="cb182-44"><a href="source-code.html#cb182-44" tabindex="-1"></a>               <span class="at">start_of_arm =</span> <span class="fu">numeric</span>(), </span>
<span id="cb182-45"><a href="source-code.html#cb182-45" tabindex="-1"></a>               <span class="at">end_of_arm =</span> <span class="fu">numeric</span>(), </span>
<span id="cb182-46"><a href="source-code.html#cb182-46" tabindex="-1"></a>               <span class="at">width_of_arm =</span> <span class="fu">numeric</span>(), </span>
<span id="cb182-47"><a href="source-code.html#cb182-47" tabindex="-1"></a>               <span class="at">strand =</span> <span class="fu">character</span>(), </span>
<span id="cb182-48"><a href="source-code.html#cb182-48" tabindex="-1"></a>               <span class="at">chromosome =</span> <span class="fu">character</span>(), </span>
<span id="cb182-49"><a href="source-code.html#cb182-49" tabindex="-1"></a>               <span class="at">arm =</span> <span class="fu">character</span>(), </span>
<span id="cb182-50"><a href="source-code.html#cb182-50" tabindex="-1"></a>               <span class="at">percentage_arm_affected =</span> <span class="fu">numeric</span>(), </span>
<span id="cb182-51"><a href="source-code.html#cb182-51" tabindex="-1"></a>               <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb182-52"><a href="source-code.html#cb182-52" tabindex="-1"></a>    ))</span>
<span id="cb182-53"><a href="source-code.html#cb182-53" tabindex="-1"></a>  }</span>
<span id="cb182-54"><a href="source-code.html#cb182-54" tabindex="-1"></a>  </span>
<span id="cb182-55"><a href="source-code.html#cb182-55" tabindex="-1"></a>  <span class="cf">for</span> (row <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(Grange)) {</span>
<span id="cb182-56"><a href="source-code.html#cb182-56" tabindex="-1"></a>    for_range <span class="ot">&lt;-</span> Grange[row]</span>
<span id="cb182-57"><a href="source-code.html#cb182-57" tabindex="-1"></a>    </span>
<span id="cb182-58"><a href="source-code.html#cb182-58" tabindex="-1"></a>    <span class="do">##########</span></span>
<span id="cb182-59"><a href="source-code.html#cb182-59" tabindex="-1"></a>    <span class="co"># Part 1 #</span></span>
<span id="cb182-60"><a href="source-code.html#cb182-60" tabindex="-1"></a>    <span class="do">##########</span></span>
<span id="cb182-61"><a href="source-code.html#cb182-61" tabindex="-1"></a>    <span class="do">## First find specific cytoband locations</span></span>
<span id="cb182-62"><a href="source-code.html#cb182-62" tabindex="-1"></a>    <span class="co"># finding overlaps</span></span>
<span id="cb182-63"><a href="source-code.html#cb182-63" tabindex="-1"></a>    hits <span class="ot">&lt;-</span> <span class="fu">findOverlaps</span>(for_range, hg38IdeogramCyto)</span>
<span id="cb182-64"><a href="source-code.html#cb182-64" tabindex="-1"></a>    </span>
<span id="cb182-65"><a href="source-code.html#cb182-65" tabindex="-1"></a>    <span class="co"># computing percentage overlap</span></span>
<span id="cb182-66"><a href="source-code.html#cb182-66" tabindex="-1"></a>    overlaps <span class="ot">&lt;-</span></span>
<span id="cb182-67"><a href="source-code.html#cb182-67" tabindex="-1"></a>      <span class="fu">pintersect</span>(for_range[<span class="fu">queryHits</span>(hits)], hg38IdeogramCyto[<span class="fu">subjectHits</span>(hits)])</span>
<span id="cb182-68"><a href="source-code.html#cb182-68" tabindex="-1"></a>    percentOverlap <span class="ot">&lt;-</span></span>
<span id="cb182-69"><a href="source-code.html#cb182-69" tabindex="-1"></a>      <span class="fu">width</span>(overlaps) <span class="sc">/</span> <span class="fu">width</span>(hg38IdeogramCyto[<span class="fu">subjectHits</span>(hits)])</span>
<span id="cb182-70"><a href="source-code.html#cb182-70" tabindex="-1"></a>    </span>
<span id="cb182-71"><a href="source-code.html#cb182-71" tabindex="-1"></a>    <span class="co"># extracting cytobands</span></span>
<span id="cb182-72"><a href="source-code.html#cb182-72" tabindex="-1"></a>    cytobands <span class="ot">&lt;-</span></span>
<span id="cb182-73"><a href="source-code.html#cb182-73" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="fu">seqnames</span>(hg38IdeogramCyto[<span class="fu">subjectHits</span>(hits)]), hg38IdeogramCyto[<span class="fu">subjectHits</span>(hits)]<span class="sc">$</span>name)</span>
<span id="cb182-74"><a href="source-code.html#cb182-74" tabindex="-1"></a>    <span class="co"># replace &#39;chr&#39;</span></span>
<span id="cb182-75"><a href="source-code.html#cb182-75" tabindex="-1"></a>    cytobands <span class="ot">&lt;-</span></span>
<span id="cb182-76"><a href="source-code.html#cb182-76" tabindex="-1"></a>      <span class="fu">str_replace</span>(cytobands, <span class="at">pattern =</span> <span class="st">&#39;chr&#39;</span>, <span class="at">replacement =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb182-77"><a href="source-code.html#cb182-77" tabindex="-1"></a>    </span>
<span id="cb182-78"><a href="source-code.html#cb182-78" tabindex="-1"></a>    cytobands_cov <span class="ot">&lt;-</span></span>
<span id="cb182-79"><a href="source-code.html#cb182-79" tabindex="-1"></a>      <span class="fu">list</span>(<span class="fu">paste0</span>(cytobands, <span class="st">&#39;;&#39;</span>, <span class="fu">round</span>(percentOverlap, <span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="st">&#39;%&#39;</span>))</span>
<span id="cb182-80"><a href="source-code.html#cb182-80" tabindex="-1"></a>    </span>
<span id="cb182-81"><a href="source-code.html#cb182-81" tabindex="-1"></a>    for_range<span class="sc">$</span>cytobands_cov <span class="ot">&lt;-</span> cytobands_cov</span>
<span id="cb182-82"><a href="source-code.html#cb182-82" tabindex="-1"></a>    </span>
<span id="cb182-83"><a href="source-code.html#cb182-83" tabindex="-1"></a>    Grange_list_cytoband[[row]] <span class="ot">&lt;-</span> for_range</span>
<span id="cb182-84"><a href="source-code.html#cb182-84" tabindex="-1"></a>    </span>
<span id="cb182-85"><a href="source-code.html#cb182-85" tabindex="-1"></a>    <span class="do">##########</span></span>
<span id="cb182-86"><a href="source-code.html#cb182-86" tabindex="-1"></a>    <span class="co"># Part 2 #</span></span>
<span id="cb182-87"><a href="source-code.html#cb182-87" tabindex="-1"></a>    <span class="do">##########</span></span>
<span id="cb182-88"><a href="source-code.html#cb182-88" tabindex="-1"></a>    <span class="co"># make dataframe that shows how much of an arm is affected </span></span>
<span id="cb182-89"><a href="source-code.html#cb182-89" tabindex="-1"></a>    </span>
<span id="cb182-90"><a href="source-code.html#cb182-90" tabindex="-1"></a>    <span class="co"># Grange with p and q IRanges</span></span>
<span id="cb182-91"><a href="source-code.html#cb182-91" tabindex="-1"></a>    p_q <span class="ot">&lt;-</span> hg38IdeogramCyto</span>
<span id="cb182-92"><a href="source-code.html#cb182-92" tabindex="-1"></a>    </span>
<span id="cb182-93"><a href="source-code.html#cb182-93" tabindex="-1"></a>    p_q<span class="sc">$</span>arm <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(p_q<span class="sc">$</span>name, <span class="st">&#39;p|q&#39;</span>)</span>
<span id="cb182-94"><a href="source-code.html#cb182-94" tabindex="-1"></a>    </span>
<span id="cb182-95"><a href="source-code.html#cb182-95" tabindex="-1"></a>    p_q <span class="ot">&lt;-</span> <span class="fu">subset</span>(p_q, seqnames <span class="sc">%in%</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>), <span class="st">&#39;X&#39;</span>, <span class="st">&#39;Y&#39;</span>))</span>
<span id="cb182-96"><a href="source-code.html#cb182-96" tabindex="-1"></a>    </span>
<span id="cb182-97"><a href="source-code.html#cb182-97" tabindex="-1"></a>    p_q <span class="ot">&lt;-</span> p_q <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(seqnames, arm) <span class="sc">%&gt;%</span> <span class="fu">reduce_ranges</span>()</span>
<span id="cb182-98"><a href="source-code.html#cb182-98" tabindex="-1"></a>    </span>
<span id="cb182-99"><a href="source-code.html#cb182-99" tabindex="-1"></a>    <span class="co"># finding overlaps</span></span>
<span id="cb182-100"><a href="source-code.html#cb182-100" tabindex="-1"></a>    hits_pq <span class="ot">&lt;-</span> <span class="fu">findOverlaps</span>(for_range, p_q)</span>
<span id="cb182-101"><a href="source-code.html#cb182-101" tabindex="-1"></a>    </span>
<span id="cb182-102"><a href="source-code.html#cb182-102" tabindex="-1"></a>    <span class="co"># computing percentage overlap</span></span>
<span id="cb182-103"><a href="source-code.html#cb182-103" tabindex="-1"></a>    overlaps <span class="ot">&lt;-</span></span>
<span id="cb182-104"><a href="source-code.html#cb182-104" tabindex="-1"></a>      <span class="fu">pintersect</span>(for_range[<span class="fu">queryHits</span>(hits_pq)], p_q[<span class="fu">subjectHits</span>(hits_pq)])</span>
<span id="cb182-105"><a href="source-code.html#cb182-105" tabindex="-1"></a>    percentOverlap <span class="ot">&lt;-</span></span>
<span id="cb182-106"><a href="source-code.html#cb182-106" tabindex="-1"></a>      <span class="fu">width</span>(overlaps) <span class="sc">/</span> <span class="fu">width</span>(p_q[<span class="fu">subjectHits</span>(hits_pq)])</span>
<span id="cb182-107"><a href="source-code.html#cb182-107" tabindex="-1"></a>    </span>
<span id="cb182-108"><a href="source-code.html#cb182-108" tabindex="-1"></a>    p_q_percentage <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(p_q[<span class="fu">subjectHits</span>(hits_pq)])</span>
<span id="cb182-109"><a href="source-code.html#cb182-109" tabindex="-1"></a>    </span>
<span id="cb182-110"><a href="source-code.html#cb182-110" tabindex="-1"></a>    p_q_percentage<span class="sc">$</span>percentage_arm_affected <span class="ot">&lt;-</span> percentOverlap <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb182-111"><a href="source-code.html#cb182-111" tabindex="-1"></a>    </span>
<span id="cb182-112"><a href="source-code.html#cb182-112" tabindex="-1"></a>    <span class="fu">colnames</span>(p_q_percentage) <span class="ot">&lt;-</span></span>
<span id="cb182-113"><a href="source-code.html#cb182-113" tabindex="-1"></a>      <span class="fu">c</span>(</span>
<span id="cb182-114"><a href="source-code.html#cb182-114" tabindex="-1"></a>        <span class="st">&#39;seqnames&#39;</span>,</span>
<span id="cb182-115"><a href="source-code.html#cb182-115" tabindex="-1"></a>        <span class="st">&#39;start_of_arm&#39;</span>,</span>
<span id="cb182-116"><a href="source-code.html#cb182-116" tabindex="-1"></a>        <span class="st">&#39;end_of_arm&#39;</span>,</span>
<span id="cb182-117"><a href="source-code.html#cb182-117" tabindex="-1"></a>        <span class="st">&#39;width_of_arm&#39;</span>,</span>
<span id="cb182-118"><a href="source-code.html#cb182-118" tabindex="-1"></a>        <span class="st">&#39;strand&#39;</span>,</span>
<span id="cb182-119"><a href="source-code.html#cb182-119" tabindex="-1"></a>        <span class="st">&#39;chromosome&#39;</span>,</span>
<span id="cb182-120"><a href="source-code.html#cb182-120" tabindex="-1"></a>        <span class="st">&#39;arm&#39;</span>,</span>
<span id="cb182-121"><a href="source-code.html#cb182-121" tabindex="-1"></a>        <span class="st">&#39;percentage_arm_affected&#39;</span></span>
<span id="cb182-122"><a href="source-code.html#cb182-122" tabindex="-1"></a>      )</span>
<span id="cb182-123"><a href="source-code.html#cb182-123" tabindex="-1"></a>    </span>
<span id="cb182-124"><a href="source-code.html#cb182-124" tabindex="-1"></a>    </span>
<span id="cb182-125"><a href="source-code.html#cb182-125" tabindex="-1"></a>    </span>
<span id="cb182-126"><a href="source-code.html#cb182-126" tabindex="-1"></a>    </span>
<span id="cb182-127"><a href="source-code.html#cb182-127" tabindex="-1"></a>    Grange_list_pq_affected[[row]] <span class="ot">&lt;-</span> p_q_percentage</span>
<span id="cb182-128"><a href="source-code.html#cb182-128" tabindex="-1"></a>    </span>
<span id="cb182-129"><a href="source-code.html#cb182-129" tabindex="-1"></a>    </span>
<span id="cb182-130"><a href="source-code.html#cb182-130" tabindex="-1"></a>  }</span>
<span id="cb182-131"><a href="source-code.html#cb182-131" tabindex="-1"></a>  </span>
<span id="cb182-132"><a href="source-code.html#cb182-132" tabindex="-1"></a>  Grange <span class="ot">&lt;-</span> <span class="fu">bind_ranges</span>(Grange_list_cytoband)</span>
<span id="cb182-133"><a href="source-code.html#cb182-133" tabindex="-1"></a>  pq_arm_affect <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(Grange_list_pq_affected)</span>
<span id="cb182-134"><a href="source-code.html#cb182-134" tabindex="-1"></a>  </span>
<span id="cb182-135"><a href="source-code.html#cb182-135" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(Grange, pq_arm_affect))</span>
<span id="cb182-136"><a href="source-code.html#cb182-136" tabindex="-1"></a>  </span>
<span id="cb182-137"><a href="source-code.html#cb182-137" tabindex="-1"></a>  <span class="do">### </span><span class="re">END</span><span class="do"> of function </span><span class="al">###</span></span>
<span id="cb182-138"><a href="source-code.html#cb182-138" tabindex="-1"></a>  </span>
<span id="cb182-139"><a href="source-code.html#cb182-139" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="get_genes-script-get_genes-functoin" class="section level2 hasAnchor" number="6.12">
<h2><span class="header-section-number">6.12</span> get_genes script: ‘get_genes’ functoin<a href="source-code.html#get_genes-script-get_genes-functoin" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="source-code.html#cb183-1" tabindex="-1"></a>get_genes <span class="ot">&lt;-</span> <span class="cf">function</span>(GRange) { </span>
<span id="cb183-2"><a href="source-code.html#cb183-2" tabindex="-1"></a>  <span class="co">#&#39; @param Grange a grange with seqnames and granges. </span></span>
<span id="cb183-3"><a href="source-code.html#cb183-3" tabindex="-1"></a>  <span class="co">#&#39; @returns returns df with all genes encoded within the GRange regions. </span></span>
<span id="cb183-4"><a href="source-code.html#cb183-4" tabindex="-1"></a>  </span>
<span id="cb183-5"><a href="source-code.html#cb183-5" tabindex="-1"></a>  <span class="fu">require</span>(GenomicRanges)</span>
<span id="cb183-6"><a href="source-code.html#cb183-6" tabindex="-1"></a>  <span class="fu">require</span>(biomaRt)</span>
<span id="cb183-7"><a href="source-code.html#cb183-7" tabindex="-1"></a>  </span>
<span id="cb183-8"><a href="source-code.html#cb183-8" tabindex="-1"></a>  <span class="co"># This code should be run only once and is therefore commented. </span></span>
<span id="cb183-9"><a href="source-code.html#cb183-9" tabindex="-1"></a>  <span class="co"># code from: https://www.biostars.org/p/311199/</span></span>
<span id="cb183-10"><a href="source-code.html#cb183-10" tabindex="-1"></a>  </span>
<span id="cb183-11"><a href="source-code.html#cb183-11" tabindex="-1"></a>  <span class="co"># Set up an gene annotation template to use</span></span>
<span id="cb183-12"><a href="source-code.html#cb183-12" tabindex="-1"></a>  <span class="co"># mart &lt;- useMart(biomart=&quot;ensembl&quot;, dataset=&quot;hsapiens_gene_ensembl&quot;)</span></span>
<span id="cb183-13"><a href="source-code.html#cb183-13" tabindex="-1"></a>  <span class="co"># mart &lt;- useMart(biomart=&quot;ENSEMBL_MART_ENSEMBL&quot;, host=&quot;www.ensembl.org&quot;, path=&quot;/biomart/martservice&quot;, dataset=&quot;hsapiens_gene_ensembl&quot;)</span></span>
<span id="cb183-14"><a href="source-code.html#cb183-14" tabindex="-1"></a>  <span class="co"># genes &lt;- getBM(attributes=c(&quot;hgnc_symbol&quot;,&quot;chromosome_name&quot;,&quot;start_position&quot;,&quot;end_position&quot;), mart=mart)</span></span>
<span id="cb183-15"><a href="source-code.html#cb183-15" tabindex="-1"></a>  <span class="co"># genes &lt;- genes[genes[,1]!=&quot;&quot; &amp; genes[,2] %in% c(1:22,&quot;X&quot;,&quot;Y&quot;),]</span></span>
<span id="cb183-16"><a href="source-code.html#cb183-16" tabindex="-1"></a>  <span class="co"># xidx &lt;- which(genes[,2]==&quot;X&quot;)</span></span>
<span id="cb183-17"><a href="source-code.html#cb183-17" tabindex="-1"></a>  <span class="co"># yidx &lt;- which(genes[,2]==&quot;Y&quot;)</span></span>
<span id="cb183-18"><a href="source-code.html#cb183-18" tabindex="-1"></a>  <span class="co"># genes[xidx, 2] &lt;- 23</span></span>
<span id="cb183-19"><a href="source-code.html#cb183-19" tabindex="-1"></a>  <span class="co"># genes[yidx, 2] &lt;- 24</span></span>
<span id="cb183-20"><a href="source-code.html#cb183-20" tabindex="-1"></a>  <span class="co"># genes[,2] &lt;- sapply(genes[,2],as.integer)</span></span>
<span id="cb183-21"><a href="source-code.html#cb183-21" tabindex="-1"></a>  <span class="co"># genes &lt;- genes[order(genes[,3]),]</span></span>
<span id="cb183-22"><a href="source-code.html#cb183-22" tabindex="-1"></a>  <span class="co"># genes &lt;- genes[order(genes[,2]),]</span></span>
<span id="cb183-23"><a href="source-code.html#cb183-23" tabindex="-1"></a>  <span class="co"># save(genes, file = &#39;rda/cna_analysis/genes.rda&#39;)</span></span>
<span id="cb183-24"><a href="source-code.html#cb183-24" tabindex="-1"></a>  <span class="co"># colnames(genes) &lt;- c(&quot;GeneSymbol&quot;,&quot;Chr&quot;,&quot;Start&quot;,&quot;End&quot;)</span></span>
<span id="cb183-25"><a href="source-code.html#cb183-25" tabindex="-1"></a>  <span class="co"># genes_GR &lt;- makeGRangesFromDataFrame(genes,keep.extra.columns = TRUE)</span></span>
<span id="cb183-26"><a href="source-code.html#cb183-26" tabindex="-1"></a>  <span class="co"># save(genes_GR, file = &#39;rda/cna_analysis/genes_GR.rda&#39;)</span></span>
<span id="cb183-27"><a href="source-code.html#cb183-27" tabindex="-1"></a>  </span>
<span id="cb183-28"><a href="source-code.html#cb183-28" tabindex="-1"></a>  <span class="co"># loading genelist and genomic location</span></span>
<span id="cb183-29"><a href="source-code.html#cb183-29" tabindex="-1"></a>  <span class="fu">load</span>(<span class="st">&quot;../cna_analysis/rda/cna_analysis/genes_GR.rda&quot;</span>, <span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb183-30"><a href="source-code.html#cb183-30" tabindex="-1"></a>  <span class="fu">load</span>(<span class="st">&#39;../cna_analysis/rda/cna_analysis/genes.rda&#39;</span>, <span class="at">envir =</span> .GlobalEnv )</span>
<span id="cb183-31"><a href="source-code.html#cb183-31" tabindex="-1"></a>  </span>
<span id="cb183-32"><a href="source-code.html#cb183-32" tabindex="-1"></a>  <span class="co"># Convert both GRanges to similar karyogram style</span></span>
<span id="cb183-33"><a href="source-code.html#cb183-33" tabindex="-1"></a>  <span class="fu">seqlevelsStyle</span>(GRange) <span class="ot">&lt;-</span> <span class="st">&quot;UCSC&quot;</span></span>
<span id="cb183-34"><a href="source-code.html#cb183-34" tabindex="-1"></a>  GRange <span class="ot">&lt;-</span> <span class="fu">renameSeqlevels</span>(GRange, <span class="fu">paste0</span>(<span class="st">&#39;chr&#39;</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">23</span>)))</span>
<span id="cb183-35"><a href="source-code.html#cb183-35" tabindex="-1"></a>  </span>
<span id="cb183-36"><a href="source-code.html#cb183-36" tabindex="-1"></a>  <span class="fu">seqlevelsStyle</span>(genes_GR) <span class="ot">&lt;-</span> <span class="st">&quot;UCSC&quot;</span></span>
<span id="cb183-37"><a href="source-code.html#cb183-37" tabindex="-1"></a>  </span>
<span id="cb183-38"><a href="source-code.html#cb183-38" tabindex="-1"></a>  <span class="co"># Finding hits with genes_GR and GRanges</span></span>
<span id="cb183-39"><a href="source-code.html#cb183-39" tabindex="-1"></a>  hits <span class="ot">&lt;-</span> <span class="fu">findOverlaps</span>(genes_GR, GRange, <span class="at">type=</span><span class="st">&quot;within&quot;</span>)</span>
<span id="cb183-40"><a href="source-code.html#cb183-40" tabindex="-1"></a>  </span>
<span id="cb183-41"><a href="source-code.html#cb183-41" tabindex="-1"></a>  <span class="co"># constructing</span></span>
<span id="cb183-42"><a href="source-code.html#cb183-42" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">as.data.frame</span>(GRange)[<span class="fu">subjectHits</span>(hits),],genes[<span class="fu">queryHits</span>(hits),])</span>
<span id="cb183-43"><a href="source-code.html#cb183-43" tabindex="-1"></a>  </span>
<span id="cb183-44"><a href="source-code.html#cb183-44" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb183-45"><a href="source-code.html#cb183-45" tabindex="-1"></a>  </span>
<span id="cb183-46"><a href="source-code.html#cb183-46" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="get_oncogenes-scripts-get_oncogenes-function" class="section level2 hasAnchor" number="6.13">
<h2><span class="header-section-number">6.13</span> get_oncogenes scripts: ‘get_oncogenes’ function<a href="source-code.html#get_oncogenes-scripts-get_oncogenes-function" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="source-code.html#cb184-1" tabindex="-1"></a>get_oncogenes <span class="ot">&lt;-</span> <span class="cf">function</span>(GRange) {</span>
<span id="cb184-2"><a href="source-code.html#cb184-2" tabindex="-1"></a>  <span class="co">#&#39; @param Grange a grange with seqnames and granges. </span></span>
<span id="cb184-3"><a href="source-code.html#cb184-3" tabindex="-1"></a>  <span class="co">#&#39; @returns returns df with all genes encoded within the GRange regions. </span></span>
<span id="cb184-4"><a href="source-code.html#cb184-4" tabindex="-1"></a>  <span class="fu">source</span>(<span class="st">&#39;R/get_genes.R&#39;</span>)</span>
<span id="cb184-5"><a href="source-code.html#cb184-5" tabindex="-1"></a>  </span>
<span id="cb184-6"><a href="source-code.html#cb184-6" tabindex="-1"></a>  <span class="co"># first finding all genes within GRange</span></span>
<span id="cb184-7"><a href="source-code.html#cb184-7" tabindex="-1"></a>  all_genes <span class="ot">&lt;-</span> <span class="fu">get_genes</span>(GRange) </span>
<span id="cb184-8"><a href="source-code.html#cb184-8" tabindex="-1"></a>  </span>
<span id="cb184-9"><a href="source-code.html#cb184-9" tabindex="-1"></a>  <span class="co"># change colnames so dataframes match</span></span>
<span id="cb184-10"><a href="source-code.html#cb184-10" tabindex="-1"></a>  <span class="fu">colnames</span>(all_genes)[<span class="fu">which</span>(<span class="fu">names</span>(all_genes) <span class="sc">==</span> <span class="st">&#39;hgnc_symbol&#39;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;Gene Symbol&quot;</span>   </span>
<span id="cb184-11"><a href="source-code.html#cb184-11" tabindex="-1"></a>  </span>
<span id="cb184-12"><a href="source-code.html#cb184-12" tabindex="-1"></a>  <span class="co"># downloading oncogenes</span></span>
<span id="cb184-13"><a href="source-code.html#cb184-13" tabindex="-1"></a>  <span class="fu">require</span>(readr)</span>
<span id="cb184-14"><a href="source-code.html#cb184-14" tabindex="-1"></a>  oncogenes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;../cna_analysis/data/cna_analysis/Census_allMon May 30 12_43_01 2022.csv&quot;</span>)</span>
<span id="cb184-15"><a href="source-code.html#cb184-15" tabindex="-1"></a>  </span>
<span id="cb184-16"><a href="source-code.html#cb184-16" tabindex="-1"></a>  </span>
<span id="cb184-17"><a href="source-code.html#cb184-17" tabindex="-1"></a>  <span class="co"># subset df_genes so to only have oncogenes</span></span>
<span id="cb184-18"><a href="source-code.html#cb184-18" tabindex="-1"></a>  <span class="fu">require</span>(tidyverse)</span>
<span id="cb184-19"><a href="source-code.html#cb184-19" tabindex="-1"></a>  oncogenes <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(oncogenes, all_genes)</span>
<span id="cb184-20"><a href="source-code.html#cb184-20" tabindex="-1"></a>  </span>
<span id="cb184-21"><a href="source-code.html#cb184-21" tabindex="-1"></a>  <span class="fu">return</span>(oncogenes)</span>
<span id="cb184-22"><a href="source-code.html#cb184-22" tabindex="-1"></a>  </span>
<span id="cb184-23"><a href="source-code.html#cb184-23" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="plot_genes_karyotype-script-plot_genes_karyotype-function" class="section level2 hasAnchor" number="6.14">
<h2><span class="header-section-number">6.14</span> plot_genes_karyotype script: ‘plot_genes_karyotype’ function<a href="source-code.html#plot_genes_karyotype-script-plot_genes_karyotype-function" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="source-code.html#cb185-1" tabindex="-1"></a>plot_genes_karyotype <span class="ot">&lt;-</span></span>
<span id="cb185-2"><a href="source-code.html#cb185-2" tabindex="-1"></a>  <span class="cf">function</span>(GRange,</span>
<span id="cb185-3"><a href="source-code.html#cb185-3" tabindex="-1"></a>           <span class="at">dist =</span> <span class="sc">-</span><span class="dv">30</span>,</span>
<span id="cb185-4"><a href="source-code.html#cb185-4" tabindex="-1"></a>           show_genes,</span>
<span id="cb185-5"><a href="source-code.html#cb185-5" tabindex="-1"></a>           <span class="at">show_chromosomes =</span> <span class="fu">c</span>(</span>
<span id="cb185-6"><a href="source-code.html#cb185-6" tabindex="-1"></a>             <span class="st">&quot;chr1&quot;</span>,</span>
<span id="cb185-7"><a href="source-code.html#cb185-7" tabindex="-1"></a>             <span class="st">&quot;chr2&quot;</span>,</span>
<span id="cb185-8"><a href="source-code.html#cb185-8" tabindex="-1"></a>             <span class="st">&quot;chr3&quot;</span>,</span>
<span id="cb185-9"><a href="source-code.html#cb185-9" tabindex="-1"></a>             <span class="st">&quot;chr4&quot;</span>,</span>
<span id="cb185-10"><a href="source-code.html#cb185-10" tabindex="-1"></a>             <span class="st">&quot;chr5&quot;</span>,</span>
<span id="cb185-11"><a href="source-code.html#cb185-11" tabindex="-1"></a>             <span class="st">&quot;chr6&quot;</span>,</span>
<span id="cb185-12"><a href="source-code.html#cb185-12" tabindex="-1"></a>             <span class="st">&quot;chr7&quot;</span>,</span>
<span id="cb185-13"><a href="source-code.html#cb185-13" tabindex="-1"></a>             <span class="st">&quot;chr8&quot;</span>,</span>
<span id="cb185-14"><a href="source-code.html#cb185-14" tabindex="-1"></a>             <span class="st">&quot;chr9&quot;</span>,</span>
<span id="cb185-15"><a href="source-code.html#cb185-15" tabindex="-1"></a>             <span class="st">&quot;chr10&quot;</span>,</span>
<span id="cb185-16"><a href="source-code.html#cb185-16" tabindex="-1"></a>             <span class="st">&quot;chr11&quot;</span>,</span>
<span id="cb185-17"><a href="source-code.html#cb185-17" tabindex="-1"></a>             <span class="st">&quot;chr12&quot;</span>,</span>
<span id="cb185-18"><a href="source-code.html#cb185-18" tabindex="-1"></a>             <span class="st">&quot;chr13&quot;</span>,</span>
<span id="cb185-19"><a href="source-code.html#cb185-19" tabindex="-1"></a>             <span class="st">&quot;chr14&quot;</span>,</span>
<span id="cb185-20"><a href="source-code.html#cb185-20" tabindex="-1"></a>             <span class="st">&quot;chr15&quot;</span>,</span>
<span id="cb185-21"><a href="source-code.html#cb185-21" tabindex="-1"></a>             <span class="st">&quot;chr16&quot;</span>,</span>
<span id="cb185-22"><a href="source-code.html#cb185-22" tabindex="-1"></a>             <span class="st">&quot;chr17&quot;</span>,</span>
<span id="cb185-23"><a href="source-code.html#cb185-23" tabindex="-1"></a>             <span class="st">&quot;chr18&quot;</span>,</span>
<span id="cb185-24"><a href="source-code.html#cb185-24" tabindex="-1"></a>             <span class="st">&quot;chr19&quot;</span>,</span>
<span id="cb185-25"><a href="source-code.html#cb185-25" tabindex="-1"></a>             <span class="st">&quot;chr20&quot;</span>,</span>
<span id="cb185-26"><a href="source-code.html#cb185-26" tabindex="-1"></a>             <span class="st">&quot;chr21&quot;</span>,</span>
<span id="cb185-27"><a href="source-code.html#cb185-27" tabindex="-1"></a>             <span class="st">&quot;chr22&quot;</span>,</span>
<span id="cb185-28"><a href="source-code.html#cb185-28" tabindex="-1"></a>             <span class="st">&quot;chrX&quot;</span></span>
<span id="cb185-29"><a href="source-code.html#cb185-29" tabindex="-1"></a>           )) {</span>
<span id="cb185-30"><a href="source-code.html#cb185-30" tabindex="-1"></a>    <span class="co">#&#39; @param GRange a GRange with seqnames, ranges, strand and hgnc_symbol</span></span>
<span id="cb185-31"><a href="source-code.html#cb185-31" tabindex="-1"></a>    <span class="co">#&#39; @param dist How far away the genes should be plotted from the lines.</span></span>
<span id="cb185-32"><a href="source-code.html#cb185-32" tabindex="-1"></a>    <span class="co">#&#39; Between -40 and -70 seems to do the trick most of the times.</span></span>
<span id="cb185-33"><a href="source-code.html#cb185-33" tabindex="-1"></a>    <span class="co">#&#39; @param show_genes is a vector of gene symbols to show.</span></span>
<span id="cb185-34"><a href="source-code.html#cb185-34" tabindex="-1"></a>    <span class="co">#&#39; @param show_chromosomes is a vector indicating which chromosomes to show.</span></span>
<span id="cb185-35"><a href="source-code.html#cb185-35" tabindex="-1"></a>    <span class="co">#&#39; @return a karyotype with genes labeled</span></span>
<span id="cb185-36"><a href="source-code.html#cb185-36" tabindex="-1"></a>    <span class="co">#&#39; @details. Throws an error when the GRange does not contain either</span></span>
<span id="cb185-37"><a href="source-code.html#cb185-37" tabindex="-1"></a>    <span class="co">#&#39; ampflications or deletions. This can be ignored, the resulting plot</span></span>
<span id="cb185-38"><a href="source-code.html#cb185-38" tabindex="-1"></a>    <span class="co">#&#39; is correct</span></span>
<span id="cb185-39"><a href="source-code.html#cb185-39" tabindex="-1"></a>    </span>
<span id="cb185-40"><a href="source-code.html#cb185-40" tabindex="-1"></a>    <span class="do">#############</span></span>
<span id="cb185-41"><a href="source-code.html#cb185-41" tabindex="-1"></a>    <span class="co"># Libraries #</span></span>
<span id="cb185-42"><a href="source-code.html#cb185-42" tabindex="-1"></a>    <span class="do">#############</span></span>
<span id="cb185-43"><a href="source-code.html#cb185-43" tabindex="-1"></a>    <span class="fu">require</span>(karyoploteR)</span>
<span id="cb185-44"><a href="source-code.html#cb185-44" tabindex="-1"></a>    <span class="fu">require</span>(stringr)</span>
<span id="cb185-45"><a href="source-code.html#cb185-45" tabindex="-1"></a>    </span>
<span id="cb185-46"><a href="source-code.html#cb185-46" tabindex="-1"></a>    <span class="do">###########</span></span>
<span id="cb185-47"><a href="source-code.html#cb185-47" tabindex="-1"></a>    <span class="co"># Wrangle #</span></span>
<span id="cb185-48"><a href="source-code.html#cb185-48" tabindex="-1"></a>    <span class="do">###########</span></span>
<span id="cb185-49"><a href="source-code.html#cb185-49" tabindex="-1"></a>    <span class="co"># making sure seqlevels match</span></span>
<span id="cb185-50"><a href="source-code.html#cb185-50" tabindex="-1"></a>    <span class="fu">seqlevelsStyle</span>(GRange) <span class="ot">&lt;-</span> <span class="st">&#39;UCSC&#39;</span></span>
<span id="cb185-51"><a href="source-code.html#cb185-51" tabindex="-1"></a>    </span>
<span id="cb185-52"><a href="source-code.html#cb185-52" tabindex="-1"></a>    kp <span class="ot">&lt;-</span> <span class="fu">plotKaryotype</span>(</span>
<span id="cb185-53"><a href="source-code.html#cb185-53" tabindex="-1"></a>      <span class="st">&quot;hg38&quot;</span>,</span>
<span id="cb185-54"><a href="source-code.html#cb185-54" tabindex="-1"></a>      <span class="at">plot.type =</span> <span class="dv">5</span>,</span>
<span id="cb185-55"><a href="source-code.html#cb185-55" tabindex="-1"></a>      <span class="at">labels.plotter =</span> <span class="cn">NULL</span>,</span>
<span id="cb185-56"><a href="source-code.html#cb185-56" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb185-57"><a href="source-code.html#cb185-57" tabindex="-1"></a>      <span class="at">cex =</span> <span class="dv">4</span>,</span>
<span id="cb185-58"><a href="source-code.html#cb185-58" tabindex="-1"></a>      <span class="at">chromosomes =</span> show_chromosomes</span>
<span id="cb185-59"><a href="source-code.html#cb185-59" tabindex="-1"></a>    )</span>
<span id="cb185-60"><a href="source-code.html#cb185-60" tabindex="-1"></a>    </span>
<span id="cb185-61"><a href="source-code.html#cb185-61" tabindex="-1"></a>    <span class="co">#renaming seqlevels</span></span>
<span id="cb185-62"><a href="source-code.html#cb185-62" tabindex="-1"></a>    seqlevels_grange_change <span class="ot">&lt;-</span></span>
<span id="cb185-63"><a href="source-code.html#cb185-63" tabindex="-1"></a>      <span class="fu">str_replace_all</span>(<span class="fu">seqlevels</span>(GRange),</span>
<span id="cb185-64"><a href="source-code.html#cb185-64" tabindex="-1"></a>                      <span class="at">pattern =</span> <span class="st">&#39;chr23&#39;</span>,</span>
<span id="cb185-65"><a href="source-code.html#cb185-65" tabindex="-1"></a>                      <span class="at">replacement =</span> <span class="st">&#39;chrX&#39;</span>)</span>
<span id="cb185-66"><a href="source-code.html#cb185-66" tabindex="-1"></a>    </span>
<span id="cb185-67"><a href="source-code.html#cb185-67" tabindex="-1"></a>    GRange <span class="ot">&lt;-</span> <span class="fu">renameSeqlevels</span>(GRange, <span class="at">value =</span> seqlevels_grange_change)</span>
<span id="cb185-68"><a href="source-code.html#cb185-68" tabindex="-1"></a>    </span>
<span id="cb185-69"><a href="source-code.html#cb185-69" tabindex="-1"></a>    <span class="fu">kpAddChromosomeNames</span>(</span>
<span id="cb185-70"><a href="source-code.html#cb185-70" tabindex="-1"></a>      kp,</span>
<span id="cb185-71"><a href="source-code.html#cb185-71" tabindex="-1"></a>      <span class="at">chr.names =</span> <span class="fu">str_remove_all</span>(show_chromosomes, <span class="st">&#39;chr&#39;</span>),</span>
<span id="cb185-72"><a href="source-code.html#cb185-72" tabindex="-1"></a>      <span class="at">cex =</span> <span class="fl">1.3</span></span>
<span id="cb185-73"><a href="source-code.html#cb185-73" tabindex="-1"></a>    )</span>
<span id="cb185-74"><a href="source-code.html#cb185-74" tabindex="-1"></a>    </span>
<span id="cb185-75"><a href="source-code.html#cb185-75" tabindex="-1"></a>    <span class="co"># split into amplifications and deletions</span></span>
<span id="cb185-76"><a href="source-code.html#cb185-76" tabindex="-1"></a>    ampl <span class="ot">&lt;-</span> GRange[GRange<span class="sc">$</span>cn <span class="sc">==</span> <span class="st">&#39;amplified&#39;</span>]</span>
<span id="cb185-77"><a href="source-code.html#cb185-77" tabindex="-1"></a>    ampl <span class="ot">&lt;-</span> ampl[ampl<span class="sc">$</span>hgnc_symbol <span class="sc">%in%</span> show_genes]</span>
<span id="cb185-78"><a href="source-code.html#cb185-78" tabindex="-1"></a>    </span>
<span id="cb185-79"><a href="source-code.html#cb185-79" tabindex="-1"></a>    del <span class="ot">&lt;-</span> GRange[GRange<span class="sc">$</span>cn <span class="sc">==</span> <span class="st">&#39;deleted&#39;</span>]</span>
<span id="cb185-80"><a href="source-code.html#cb185-80" tabindex="-1"></a>    del <span class="ot">&lt;-</span> del[del<span class="sc">$</span>hgnc_symbol <span class="sc">%in%</span> show_genes]</span>
<span id="cb185-81"><a href="source-code.html#cb185-81" tabindex="-1"></a>    </span>
<span id="cb185-82"><a href="source-code.html#cb185-82" tabindex="-1"></a>    <span class="fu">tryCatch</span>(</span>
<span id="cb185-83"><a href="source-code.html#cb185-83" tabindex="-1"></a>      cor <span class="ot">&lt;-</span></span>
<span id="cb185-84"><a href="source-code.html#cb185-84" tabindex="-1"></a>        <span class="fu">cor.test</span>(df<span class="sc">$</span>AUC, df<span class="sc">$</span>dependency, <span class="at">use =</span> <span class="st">&quot;complete.obs&quot;</span>),</span>
<span id="cb185-85"><a href="source-code.html#cb185-85" tabindex="-1"></a>      <span class="at">error =</span> <span class="cf">function</span>(e)</span>
<span id="cb185-86"><a href="source-code.html#cb185-86" tabindex="-1"></a>        <span class="cn">NULL</span></span>
<span id="cb185-87"><a href="source-code.html#cb185-87" tabindex="-1"></a>    )</span>
<span id="cb185-88"><a href="source-code.html#cb185-88" tabindex="-1"></a>    </span>
<span id="cb185-89"><a href="source-code.html#cb185-89" tabindex="-1"></a>    <span class="fu">tryCatch</span>(</span>
<span id="cb185-90"><a href="source-code.html#cb185-90" tabindex="-1"></a>      <span class="fu">kpPlotMarkers</span>(</span>
<span id="cb185-91"><a href="source-code.html#cb185-91" tabindex="-1"></a>        kp,</span>
<span id="cb185-92"><a href="source-code.html#cb185-92" tabindex="-1"></a>        <span class="at">data =</span> ampl,</span>
<span id="cb185-93"><a href="source-code.html#cb185-93" tabindex="-1"></a>        <span class="at">labels =</span> ampl<span class="sc">$</span>hgnc_symbol,</span>
<span id="cb185-94"><a href="source-code.html#cb185-94" tabindex="-1"></a>        <span class="at">ignore.chromosome.ends =</span> T,</span>
<span id="cb185-95"><a href="source-code.html#cb185-95" tabindex="-1"></a>        <span class="at">r0 =</span> <span class="dv">1</span>,</span>
<span id="cb185-96"><a href="source-code.html#cb185-96" tabindex="-1"></a>        <span class="at">r1 =</span> <span class="fl">0.85</span>,</span>
<span id="cb185-97"><a href="source-code.html#cb185-97" tabindex="-1"></a>        <span class="at">label.dist =</span> <span class="fl">0.003</span>,</span>
<span id="cb185-98"><a href="source-code.html#cb185-98" tabindex="-1"></a>        <span class="at">label.margin =</span> dist,</span>
<span id="cb185-99"><a href="source-code.html#cb185-99" tabindex="-1"></a>        <span class="at">marker.parts =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb185-100"><a href="source-code.html#cb185-100" tabindex="-1"></a>        <span class="at">line.color =</span> <span class="st">&#39;firebrick&#39;</span>,</span>
<span id="cb185-101"><a href="source-code.html#cb185-101" tabindex="-1"></a>        <span class="at">label.color =</span> <span class="st">&#39;firebrick&#39;</span></span>
<span id="cb185-102"><a href="source-code.html#cb185-102" tabindex="-1"></a>      ),</span>
<span id="cb185-103"><a href="source-code.html#cb185-103" tabindex="-1"></a>      <span class="at">error =</span> <span class="cf">function</span>(e)</span>
<span id="cb185-104"><a href="source-code.html#cb185-104" tabindex="-1"></a>        <span class="cn">NULL</span></span>
<span id="cb185-105"><a href="source-code.html#cb185-105" tabindex="-1"></a>    )</span>
<span id="cb185-106"><a href="source-code.html#cb185-106" tabindex="-1"></a>    </span>
<span id="cb185-107"><a href="source-code.html#cb185-107" tabindex="-1"></a>    </span>
<span id="cb185-108"><a href="source-code.html#cb185-108" tabindex="-1"></a>    <span class="fu">tryCatch</span>(</span>
<span id="cb185-109"><a href="source-code.html#cb185-109" tabindex="-1"></a>      <span class="fu">kpPlotMarkers</span>(</span>
<span id="cb185-110"><a href="source-code.html#cb185-110" tabindex="-1"></a>        kp,</span>
<span id="cb185-111"><a href="source-code.html#cb185-111" tabindex="-1"></a>        <span class="at">data =</span> del,</span>
<span id="cb185-112"><a href="source-code.html#cb185-112" tabindex="-1"></a>        <span class="at">labels =</span> del<span class="sc">$</span>hgnc_symbol,</span>
<span id="cb185-113"><a href="source-code.html#cb185-113" tabindex="-1"></a>        <span class="at">ignore.chromosome.ends =</span> T,</span>
<span id="cb185-114"><a href="source-code.html#cb185-114" tabindex="-1"></a>        <span class="at">r0 =</span> <span class="dv">1</span>,</span>
<span id="cb185-115"><a href="source-code.html#cb185-115" tabindex="-1"></a>        <span class="at">r1 =</span> <span class="fl">0.4</span>,</span>
<span id="cb185-116"><a href="source-code.html#cb185-116" tabindex="-1"></a>        <span class="at">label.dist =</span> <span class="fl">0.003</span>,</span>
<span id="cb185-117"><a href="source-code.html#cb185-117" tabindex="-1"></a>        <span class="at">cex =</span> <span class="dv">8</span>,</span>
<span id="cb185-118"><a href="source-code.html#cb185-118" tabindex="-1"></a>        <span class="at">label.margin =</span> dist,</span>
<span id="cb185-119"><a href="source-code.html#cb185-119" tabindex="-1"></a>        <span class="at">marker.parts =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb185-120"><a href="source-code.html#cb185-120" tabindex="-1"></a>        <span class="at">line.color =</span> <span class="st">&#39;steelblue&#39;</span>,</span>
<span id="cb185-121"><a href="source-code.html#cb185-121" tabindex="-1"></a>        <span class="at">label.color =</span> <span class="st">&#39;steelblue&#39;</span></span>
<span id="cb185-122"><a href="source-code.html#cb185-122" tabindex="-1"></a>      ),</span>
<span id="cb185-123"><a href="source-code.html#cb185-123" tabindex="-1"></a>      <span class="at">error =</span> <span class="cf">function</span>(e)</span>
<span id="cb185-124"><a href="source-code.html#cb185-124" tabindex="-1"></a>        <span class="cn">NULL</span></span>
<span id="cb185-125"><a href="source-code.html#cb185-125" tabindex="-1"></a>    )</span>
<span id="cb185-126"><a href="source-code.html#cb185-126" tabindex="-1"></a>    </span>
<span id="cb185-127"><a href="source-code.html#cb185-127" tabindex="-1"></a>    </span>
<span id="cb185-128"><a href="source-code.html#cb185-128" tabindex="-1"></a>  }</span></code></pre></div>
</div>
<div id="shifters-script-create_cn_matrix-and-cluster_and_shift_transitions-functions" class="section level2 hasAnchor" number="6.15">
<h2><span class="header-section-number">6.15</span> shifters script: ‘create_cn_matrix’ and ‘cluster_and_shift_transitions’ functions<a href="source-code.html#shifters-script-create_cn_matrix-and-cluster_and_shift_transitions-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For the ‘create_cn_matrix’ and ‘cluster_and_shift_transitions’ functions, please submit a code sharing request to the corresponding author of this paper:</p>
<p>Bolhaqueiro, A.C.F., Ponsioen, B., Bakker, B. et al. Ongoing chromosomal instability and karyotype evolution in human colorectal cancer organoids. Nat Genet 51, 824–834 (2019). <a href="https://doi-org.proxy.library.uu.nl/10.1038/s41588-019-0399-6" class="uri">https://doi-org.proxy.library.uu.nl/10.1038/s41588-019-0399-6</a></p>
</div>
<div id="calculate_heterogeneity_score-script-calculate_heterogeneity_score-function" class="section level2 hasAnchor" number="6.16">
<h2><span class="header-section-number">6.16</span> calculate_heterogeneity_score script: ‘calculate_heterogeneity_score’ function<a href="source-code.html#calculate_heterogeneity_score-script-calculate_heterogeneity_score-function" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For the ‘calculate_heterogeneity_score’ function, please submit a code sharing request to the corresponding author of this paper:</p>
<p>Bolhaqueiro, A.C.F., Ponsioen, B., Bakker, B. et al. Ongoing chromosomal instability and karyotype evolution in human colorectal cancer organoids. Nat Genet 51, 824–834 (2019). <a href="https://doi-org.proxy.library.uu.nl/10.1038/s41588-019-0399-6" class="uri">https://doi-org.proxy.library.uu.nl/10.1038/s41588-019-0399-6</a></p>
</div>
<div id="cna_profiler-script-cna_profiler-function" class="section level2 hasAnchor" number="6.17">
<h2><span class="header-section-number">6.17</span> cna_profiler script: ‘cna_profiler’ function<a href="source-code.html#cna_profiler-script-cna_profiler-function" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="source-code.html#cb186-1" tabindex="-1"></a>cna_profiler <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb186-2"><a href="source-code.html#cb186-2" tabindex="-1"></a>  <span class="co">#&#39; @param df is a datafame containing all the copy number calls of all the files.</span></span>
<span id="cb186-3"><a href="source-code.html#cb186-3" tabindex="-1"></a>  <span class="co">#&#39;                       Columns: 01) seqnames</span></span>
<span id="cb186-4"><a href="source-code.html#cb186-4" tabindex="-1"></a>  <span class="co">#&#39;                                02) start</span></span>
<span id="cb186-5"><a href="source-code.html#cb186-5" tabindex="-1"></a>  <span class="co">#&#39;                                03) end</span></span>
<span id="cb186-6"><a href="source-code.html#cb186-6" tabindex="-1"></a>  <span class="co">#&#39;                                04) width</span></span>
<span id="cb186-7"><a href="source-code.html#cb186-7" tabindex="-1"></a>  <span class="co">#&#39;                                05) strand</span></span>
<span id="cb186-8"><a href="source-code.html#cb186-8" tabindex="-1"></a>  <span class="co">#&#39;                                06) [copy.number cell 1]</span></span>
<span id="cb186-9"><a href="source-code.html#cb186-9" tabindex="-1"></a>  <span class="co">#&#39;                                07) [copy.number cell 2], etc.</span></span>
<span id="cb186-10"><a href="source-code.html#cb186-10" tabindex="-1"></a>  <span class="co">#&#39; @return Outputs a dataframe that states the ratio (normalized to total cells) of</span></span>
<span id="cb186-11"><a href="source-code.html#cb186-11" tabindex="-1"></a>  <span class="co">#&#39; small, medium, large and whole chromosome CNAs</span></span>
<span id="cb186-12"><a href="source-code.html#cb186-12" tabindex="-1"></a></span>
<span id="cb186-13"><a href="source-code.html#cb186-13" tabindex="-1"></a>  <span class="fu">require</span>(tidyverse)</span>
<span id="cb186-14"><a href="source-code.html#cb186-14" tabindex="-1"></a>  <span class="fu">require</span>(GWASTools)</span>
<span id="cb186-15"><a href="source-code.html#cb186-15" tabindex="-1"></a>  </span>
<span id="cb186-16"><a href="source-code.html#cb186-16" tabindex="-1"></a>  <span class="co"># defining some parameters</span></span>
<span id="cb186-17"><a href="source-code.html#cb186-17" tabindex="-1"></a>  <span class="co"># number of cells </span></span>
<span id="cb186-18"><a href="source-code.html#cb186-18" tabindex="-1"></a>  n_cells <span class="ot">&lt;-</span> <span class="fu">ncol</span>(df) <span class="sc">-</span> <span class="dv">5</span></span>
<span id="cb186-19"><a href="source-code.html#cb186-19" tabindex="-1"></a>  </span>
<span id="cb186-20"><a href="source-code.html#cb186-20" tabindex="-1"></a>  <span class="co"># extract centromere positions</span></span>
<span id="cb186-21"><a href="source-code.html#cb186-21" tabindex="-1"></a>  <span class="fu">data</span>(centromeres.hg38)</span>
<span id="cb186-22"><a href="source-code.html#cb186-22" tabindex="-1"></a>  </span>
<span id="cb186-23"><a href="source-code.html#cb186-23" tabindex="-1"></a>  centromeres.hg38 <span class="ot">&lt;-</span> <span class="fu">subset</span>(centromeres.hg38, chrom <span class="sc">!=</span> <span class="st">&#39;Y&#39;</span>)</span>
<span id="cb186-24"><a href="source-code.html#cb186-24" tabindex="-1"></a>  <span class="fu">names</span>(centromeres.hg38) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;seqnames&#39;</span>, <span class="st">&#39;start&#39;</span>, <span class="st">&#39;end&#39;</span>)</span>
<span id="cb186-25"><a href="source-code.html#cb186-25" tabindex="-1"></a>  </span>
<span id="cb186-26"><a href="source-code.html#cb186-26" tabindex="-1"></a>  </span>
<span id="cb186-27"><a href="source-code.html#cb186-27" tabindex="-1"></a>  <span class="co"># extract total length chromosomes</span></span>
<span id="cb186-28"><a href="source-code.html#cb186-28" tabindex="-1"></a>  total_length <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(seqnames) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="fu">sum</span>(width))</span>
<span id="cb186-29"><a href="source-code.html#cb186-29" tabindex="-1"></a>  </span>
<span id="cb186-30"><a href="source-code.html#cb186-30" tabindex="-1"></a>  <span class="co"># construct dataframe containing chromosome name, centromere position (start and end) and total length chromosome</span></span>
<span id="cb186-31"><a href="source-code.html#cb186-31" tabindex="-1"></a>  chrom_centro_total <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(total_length, centromeres.hg38)</span>
<span id="cb186-32"><a href="source-code.html#cb186-32" tabindex="-1"></a>  </span>
<span id="cb186-33"><a href="source-code.html#cb186-33" tabindex="-1"></a>  <span class="co"># compute arm lengths</span></span>
<span id="cb186-34"><a href="source-code.html#cb186-34" tabindex="-1"></a>  chrom_centro_total<span class="sc">$</span>p_arm <span class="ot">&lt;-</span> chrom_centro_total<span class="sc">$</span>start <span class="sc">+</span> (chrom_centro_total<span class="sc">$</span>end<span class="sc">-</span>chrom_centro_total<span class="sc">$</span>start)</span>
<span id="cb186-35"><a href="source-code.html#cb186-35" tabindex="-1"></a>  chrom_centro_total<span class="sc">$</span>q_arm <span class="ot">&lt;-</span> chrom_centro_total<span class="sc">$</span><span class="st">`</span><span class="at">sum(width)</span><span class="st">`</span> <span class="sc">-</span>  chrom_centro_total<span class="sc">$</span>p_arm</span>
<span id="cb186-36"><a href="source-code.html#cb186-36" tabindex="-1"></a>  </span>
<span id="cb186-37"><a href="source-code.html#cb186-37" tabindex="-1"></a>  <span class="do">##### !!!!!!!! ######</span></span>
<span id="cb186-38"><a href="source-code.html#cb186-38" tabindex="-1"></a>  <span class="co"># Check if this is still correct when using new assemblies !</span></span>
<span id="cb186-39"><a href="source-code.html#cb186-39" tabindex="-1"></a>  </span>
<span id="cb186-40"><a href="source-code.html#cb186-40" tabindex="-1"></a>  <span class="co"># now all p_arms except for chromosome 1 are correct (for some reason the p-arm is the larger arm here). </span></span>
<span id="cb186-41"><a href="source-code.html#cb186-41" tabindex="-1"></a>  <span class="co"># I am going to swithc it. </span></span>
<span id="cb186-42"><a href="source-code.html#cb186-42" tabindex="-1"></a>  p_arm_1 <span class="ot">&lt;-</span> chrom_centro_total<span class="sc">$</span>q_arm[<span class="dv">1</span>]</span>
<span id="cb186-43"><a href="source-code.html#cb186-43" tabindex="-1"></a>  q_arm_1 <span class="ot">&lt;-</span> chrom_centro_total<span class="sc">$</span>p_arm[<span class="dv">1</span>]</span>
<span id="cb186-44"><a href="source-code.html#cb186-44" tabindex="-1"></a>  </span>
<span id="cb186-45"><a href="source-code.html#cb186-45" tabindex="-1"></a>  chrom_centro_total[<span class="dv">1</span>,<span class="dv">5</span>] <span class="ot">&lt;-</span> p_arm_1</span>
<span id="cb186-46"><a href="source-code.html#cb186-46" tabindex="-1"></a>  chrom_centro_total[<span class="dv">1</span>,<span class="dv">6</span>] <span class="ot">&lt;-</span> q_arm_1</span>
<span id="cb186-47"><a href="source-code.html#cb186-47" tabindex="-1"></a>  </span>
<span id="cb186-48"><a href="source-code.html#cb186-48" tabindex="-1"></a>  </span>
<span id="cb186-49"><a href="source-code.html#cb186-49" tabindex="-1"></a>  <span class="co"># function to extract CNA for each chromosome, run this function for each chromosome</span></span>
<span id="cb186-50"><a href="source-code.html#cb186-50" tabindex="-1"></a>  cna_extract <span class="ot">&lt;-</span> <span class="cf">function</span>(chromosome) {</span>
<span id="cb186-51"><a href="source-code.html#cb186-51" tabindex="-1"></a>    <span class="co"># @parama: chromosome is the chromosome (i.e., 1, 2,3, X, etc) </span></span>
<span id="cb186-52"><a href="source-code.html#cb186-52" tabindex="-1"></a>    df_chrom <span class="ot">&lt;-</span> <span class="fu">subset</span>(df, seqnames <span class="sc">==</span> chromosome)</span>
<span id="cb186-53"><a href="source-code.html#cb186-53" tabindex="-1"></a>    </span>
<span id="cb186-54"><a href="source-code.html#cb186-54" tabindex="-1"></a>    <span class="co"># run this function for each column in df_chrom</span></span>
<span id="cb186-55"><a href="source-code.html#cb186-55" tabindex="-1"></a>    cna_extract_cell <span class="ot">&lt;-</span> <span class="cf">function</span>(column_i) {</span>
<span id="cb186-56"><a href="source-code.html#cb186-56" tabindex="-1"></a>      <span class="co"># @ param column i is the integer of the column in df_chrom </span></span>
<span id="cb186-57"><a href="source-code.html#cb186-57" tabindex="-1"></a>      <span class="co"># from which to extract CNAs</span></span>
<span id="cb186-58"><a href="source-code.html#cb186-58" tabindex="-1"></a>      </span>
<span id="cb186-59"><a href="source-code.html#cb186-59" tabindex="-1"></a>      <span class="co"># extract rows that switch CNA value (for example from 2 to 3)</span></span>
<span id="cb186-60"><a href="source-code.html#cb186-60" tabindex="-1"></a>      CNA_change <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="fu">tail</span>(df_chrom[,column_i],<span class="sc">-</span><span class="dv">1</span>) <span class="sc">!=</span> <span class="fu">head</span>(df_chrom[,column_i],<span class="sc">-</span><span class="dv">1</span>)))</span>
<span id="cb186-61"><a href="source-code.html#cb186-61" tabindex="-1"></a>      </span>
<span id="cb186-62"><a href="source-code.html#cb186-62" tabindex="-1"></a>      <span class="co"># extract indices</span></span>
<span id="cb186-63"><a href="source-code.html#cb186-63" tabindex="-1"></a>      CNA_change_indices <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">sort</span>(<span class="fu">c</span>(<span class="dv">1</span>,CNA_change, (CNA_change<span class="dv">-1</span>), <span class="fu">nrow</span>(df_chrom))))</span>
<span id="cb186-64"><a href="source-code.html#cb186-64" tabindex="-1"></a>      </span>
<span id="cb186-65"><a href="source-code.html#cb186-65" tabindex="-1"></a>      <span class="co"># construct dataframe containing end and start of each CNA</span></span>
<span id="cb186-66"><a href="source-code.html#cb186-66" tabindex="-1"></a>      CNA_change_df <span class="ot">&lt;-</span> df_chrom[CNA_change_indices,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>, column_i)]</span>
<span id="cb186-67"><a href="source-code.html#cb186-67" tabindex="-1"></a>      <span class="fu">names</span>(CNA_change_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;seqnames&#39;</span>, <span class="st">&#39;start&#39;</span>, <span class="st">&#39;end&#39;</span>, <span class="st">&#39;width&#39;</span>, <span class="st">&#39;strand&#39;</span>, <span class="st">&#39;cna&#39;</span>)</span>
<span id="cb186-68"><a href="source-code.html#cb186-68" tabindex="-1"></a>      </span>
<span id="cb186-69"><a href="source-code.html#cb186-69" tabindex="-1"></a>      start_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb186-70"><a href="source-code.html#cb186-70" tabindex="-1"></a>      end_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb186-71"><a href="source-code.html#cb186-71" tabindex="-1"></a>      </span>
<span id="cb186-72"><a href="source-code.html#cb186-72" tabindex="-1"></a>      i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb186-73"><a href="source-code.html#cb186-73" tabindex="-1"></a>      </span>
<span id="cb186-74"><a href="source-code.html#cb186-74" tabindex="-1"></a>      <span class="cf">while</span>(i<span class="sc">&lt;=</span><span class="fu">nrow</span>(CNA_change_df)){</span>
<span id="cb186-75"><a href="source-code.html#cb186-75" tabindex="-1"></a>        </span>
<span id="cb186-76"><a href="source-code.html#cb186-76" tabindex="-1"></a>        <span class="fu">try</span>(<span class="cf">if</span>(CNA_change_df[i<span class="sc">+</span><span class="dv">1</span>, <span class="dv">6</span>] <span class="sc">==</span> CNA_change_df[i, <span class="dv">6</span>]){</span>
<span id="cb186-77"><a href="source-code.html#cb186-77" tabindex="-1"></a>          start_list[[(<span class="fu">length</span>(start_list) <span class="sc">+</span> <span class="dv">1</span>)]] <span class="ot">&lt;-</span> CNA_change_df[i,<span class="dv">2</span>]</span>
<span id="cb186-78"><a href="source-code.html#cb186-78" tabindex="-1"></a>          end_list[[(<span class="fu">length</span>(end_list) <span class="sc">+</span> <span class="dv">1</span>)]] <span class="ot">&lt;-</span> CNA_change_df[i<span class="sc">+</span><span class="dv">1</span>, <span class="dv">3</span>]</span>
<span id="cb186-79"><a href="source-code.html#cb186-79" tabindex="-1"></a>          i <span class="ot">&lt;-</span> i<span class="sc">+</span><span class="dv">2</span></span>
<span id="cb186-80"><a href="source-code.html#cb186-80" tabindex="-1"></a>        })</span>
<span id="cb186-81"><a href="source-code.html#cb186-81" tabindex="-1"></a>        </span>
<span id="cb186-82"><a href="source-code.html#cb186-82" tabindex="-1"></a>        <span class="cf">if</span>(CNA_change_df[i<span class="sc">+</span><span class="dv">1</span>, <span class="dv">6</span>] <span class="sc">!=</span> CNA_change_df[i, <span class="dv">6</span>] <span class="sc">||</span> <span class="fu">is.na</span>(CNA_change_df[i<span class="sc">+</span><span class="dv">1</span>, <span class="dv">6</span>])){</span>
<span id="cb186-83"><a href="source-code.html#cb186-83" tabindex="-1"></a>          start_list[[(<span class="fu">length</span>(start_list) <span class="sc">+</span> <span class="dv">1</span>)]] <span class="ot">&lt;-</span> CNA_change_df[i,<span class="dv">2</span>]</span>
<span id="cb186-84"><a href="source-code.html#cb186-84" tabindex="-1"></a>          end_list[[(<span class="fu">length</span>(end_list) <span class="sc">+</span> <span class="dv">1</span>)]] <span class="ot">&lt;-</span> CNA_change_df[i, <span class="dv">3</span>]</span>
<span id="cb186-85"><a href="source-code.html#cb186-85" tabindex="-1"></a>          i <span class="ot">&lt;-</span> i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb186-86"><a href="source-code.html#cb186-86" tabindex="-1"></a>        }</span>
<span id="cb186-87"><a href="source-code.html#cb186-87" tabindex="-1"></a>        </span>
<span id="cb186-88"><a href="source-code.html#cb186-88" tabindex="-1"></a>      }</span>
<span id="cb186-89"><a href="source-code.html#cb186-89" tabindex="-1"></a>      </span>
<span id="cb186-90"><a href="source-code.html#cb186-90" tabindex="-1"></a>      <span class="co"># constructing a dataframe</span></span>
<span id="cb186-91"><a href="source-code.html#cb186-91" tabindex="-1"></a>      cna_dataframe <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">seqnames =</span> chromosome, </span>
<span id="cb186-92"><a href="source-code.html#cb186-92" tabindex="-1"></a>                                  <span class="at">start =</span> <span class="fu">unlist</span>(start_list), </span>
<span id="cb186-93"><a href="source-code.html#cb186-93" tabindex="-1"></a>                                  <span class="at">end =</span> <span class="fu">unlist</span>(end_list))</span>
<span id="cb186-94"><a href="source-code.html#cb186-94" tabindex="-1"></a>      </span>
<span id="cb186-95"><a href="source-code.html#cb186-95" tabindex="-1"></a>      <span class="co"># remove NA</span></span>
<span id="cb186-96"><a href="source-code.html#cb186-96" tabindex="-1"></a>      cna_dataframe <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(cna_dataframe)</span>
<span id="cb186-97"><a href="source-code.html#cb186-97" tabindex="-1"></a>      </span>
<span id="cb186-98"><a href="source-code.html#cb186-98" tabindex="-1"></a>      <span class="co"># add column CNA</span></span>
<span id="cb186-99"><a href="source-code.html#cb186-99" tabindex="-1"></a>      cna_dataframe<span class="sc">$</span>cna <span class="ot">&lt;-</span> (CNA_change_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cna<span class="sc">!=</span><span class="fu">lag</span>(cna) <span class="sc">|</span> <span class="fu">is.na</span>(<span class="fu">lag</span>(cna))))<span class="sc">$</span>cna</span>
<span id="cb186-100"><a href="source-code.html#cb186-100" tabindex="-1"></a>      </span>
<span id="cb186-101"><a href="source-code.html#cb186-101" tabindex="-1"></a>      <span class="co"># remove columsn with cna == 2 (this is no CNA but normal diploid)</span></span>
<span id="cb186-102"><a href="source-code.html#cb186-102" tabindex="-1"></a>      cna_dataframe <span class="ot">&lt;-</span> <span class="fu">subset</span>(cna_dataframe, cna <span class="sc">!=</span> <span class="dv">2</span>)</span>
<span id="cb186-103"><a href="source-code.html#cb186-103" tabindex="-1"></a>      </span>
<span id="cb186-104"><a href="source-code.html#cb186-104" tabindex="-1"></a>      <span class="co"># add total number of CNAs in this cell as colunn num_cna</span></span>
<span id="cb186-105"><a href="source-code.html#cb186-105" tabindex="-1"></a>      <span class="fu">try</span>(cna_dataframe<span class="sc">$</span>num_cna <span class="ot">&lt;-</span> <span class="fu">length</span>(cna_dataframe<span class="sc">$</span>cna), <span class="at">silent =</span> T)</span>
<span id="cb186-106"><a href="source-code.html#cb186-106" tabindex="-1"></a>      </span>
<span id="cb186-107"><a href="source-code.html#cb186-107" tabindex="-1"></a>      <span class="co"># add a width column of the CNA</span></span>
<span id="cb186-108"><a href="source-code.html#cb186-108" tabindex="-1"></a>      cna_dataframe<span class="sc">$</span>width <span class="ot">&lt;-</span> cna_dataframe<span class="sc">$</span>end <span class="sc">-</span> cna_dataframe<span class="sc">$</span>start <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb186-109"><a href="source-code.html#cb186-109" tabindex="-1"></a>      </span>
<span id="cb186-110"><a href="source-code.html#cb186-110" tabindex="-1"></a>      <span class="co"># extract chromosome specifics</span></span>
<span id="cb186-111"><a href="source-code.html#cb186-111" tabindex="-1"></a>      chrom_df <span class="ot">&lt;-</span> <span class="fu">subset</span>(chrom_centro_total, seqnames <span class="sc">==</span> chromosome)</span>
<span id="cb186-112"><a href="source-code.html#cb186-112" tabindex="-1"></a>      </span>
<span id="cb186-113"><a href="source-code.html#cb186-113" tabindex="-1"></a>      <span class="co"># in the next of code, we are going to compute the fraction of SCNA</span></span>
<span id="cb186-114"><a href="source-code.html#cb186-114" tabindex="-1"></a>      <span class="co"># Important: using this measure, a fraction of 1 means that a region the size of one arm</span></span>
<span id="cb186-115"><a href="source-code.html#cb186-115" tabindex="-1"></a>      <span class="co"># was affected. A fraction of 2 means the whole chromosome is affected. Note that these CNA</span></span>
<span id="cb186-116"><a href="source-code.html#cb186-116" tabindex="-1"></a>      <span class="co"># can cross centromeres, so we are unable to easily assign if it is the p-arm or q-arm that is </span></span>
<span id="cb186-117"><a href="source-code.html#cb186-117" tabindex="-1"></a>      <span class="co"># affected. </span></span>
<span id="cb186-118"><a href="source-code.html#cb186-118" tabindex="-1"></a>      cna_dataframe<span class="sc">$</span>fraction <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(cna_dataframe<span class="sc">$</span>end <span class="sc">&lt;</span> chrom_df<span class="sc">$</span>p_arm, (cna_dataframe<span class="sc">$</span>width <span class="sc">/</span> chrom_df<span class="sc">$</span>p_arm), </span>
<span id="cb186-119"><a href="source-code.html#cb186-119" tabindex="-1"></a>                                       <span class="fu">ifelse</span>(cna_dataframe<span class="sc">$</span>start <span class="sc">&gt;</span> chrom_df<span class="sc">$</span>p_arm, cna_dataframe<span class="sc">$</span>width <span class="sc">/</span> chrom_df<span class="sc">$</span>q_arm,</span>
<span id="cb186-120"><a href="source-code.html#cb186-120" tabindex="-1"></a>                                              (((chrom_df<span class="sc">$</span>p_arm <span class="sc">-</span> cna_dataframe<span class="sc">$</span>start) <span class="sc">/</span> chrom_df<span class="sc">$</span>p_arm) <span class="sc">+</span> ((cna_dataframe<span class="sc">$</span>end <span class="sc">-</span> chrom_df<span class="sc">$</span>p_arm) <span class="sc">/</span> chrom_df<span class="sc">$</span>q_arm))))</span>
<span id="cb186-121"><a href="source-code.html#cb186-121" tabindex="-1"></a>      </span>
<span id="cb186-122"><a href="source-code.html#cb186-122" tabindex="-1"></a>      <span class="co"># adding cellname</span></span>
<span id="cb186-123"><a href="source-code.html#cb186-123" tabindex="-1"></a>      <span class="fu">try</span>(cna_dataframe<span class="sc">$</span>cell_id <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df_chrom)[column_i], <span class="at">silent =</span> T)</span>
<span id="cb186-124"><a href="source-code.html#cb186-124" tabindex="-1"></a>      </span>
<span id="cb186-125"><a href="source-code.html#cb186-125" tabindex="-1"></a>      <span class="fu">return</span>(cna_dataframe)</span>
<span id="cb186-126"><a href="source-code.html#cb186-126" tabindex="-1"></a>      </span>
<span id="cb186-127"><a href="source-code.html#cb186-127" tabindex="-1"></a>    }</span>
<span id="cb186-128"><a href="source-code.html#cb186-128" tabindex="-1"></a>    </span>
<span id="cb186-129"><a href="source-code.html#cb186-129" tabindex="-1"></a>    <span class="co"># running for each cell. </span></span>
<span id="cb186-130"><a href="source-code.html#cb186-130" tabindex="-1"></a>    cna_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">6</span><span class="sc">:</span><span class="fu">ncol</span>(df), cna_extract_cell)</span>
<span id="cb186-131"><a href="source-code.html#cb186-131" tabindex="-1"></a>    </span>
<span id="cb186-132"><a href="source-code.html#cb186-132" tabindex="-1"></a>    <span class="co"># constructing single dataframe </span></span>
<span id="cb186-133"><a href="source-code.html#cb186-133" tabindex="-1"></a>    cna_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(cna_list, <span class="at">.id =</span> <span class="st">&quot;cell_num_scar&quot;</span>)</span>
<span id="cb186-134"><a href="source-code.html#cb186-134" tabindex="-1"></a>    </span>
<span id="cb186-135"><a href="source-code.html#cb186-135" tabindex="-1"></a>    <span class="co"># removing cell_num scar</span></span>
<span id="cb186-136"><a href="source-code.html#cb186-136" tabindex="-1"></a>    cna_df <span class="ot">&lt;-</span> cna_df[, <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(cna_df)]</span>
<span id="cb186-137"><a href="source-code.html#cb186-137" tabindex="-1"></a>    </span>
<span id="cb186-138"><a href="source-code.html#cb186-138" tabindex="-1"></a>    <span class="fu">return</span>(cna_df)</span>
<span id="cb186-139"><a href="source-code.html#cb186-139" tabindex="-1"></a>    </span>
<span id="cb186-140"><a href="source-code.html#cb186-140" tabindex="-1"></a>  }</span>
<span id="cb186-141"><a href="source-code.html#cb186-141" tabindex="-1"></a>  </span>
<span id="cb186-142"><a href="source-code.html#cb186-142" tabindex="-1"></a>  cna_df_per_chrom_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb186-143"><a href="source-code.html#cb186-143" tabindex="-1"></a>  </span>
<span id="cb186-144"><a href="source-code.html#cb186-144" tabindex="-1"></a>  <span class="cf">for</span>(chrom <span class="cf">in</span> <span class="fu">unique</span>(df<span class="sc">$</span>seqnames)) {</span>
<span id="cb186-145"><a href="source-code.html#cb186-145" tabindex="-1"></a>    cna_df_per_chrom_list[[chrom]] <span class="ot">&lt;-</span> <span class="fu">cna_extract</span>(chrom)</span>
<span id="cb186-146"><a href="source-code.html#cb186-146" tabindex="-1"></a>  }</span>
<span id="cb186-147"><a href="source-code.html#cb186-147" tabindex="-1"></a>  </span>
<span id="cb186-148"><a href="source-code.html#cb186-148" tabindex="-1"></a>  <span class="co"># constructing single dataframe </span></span>
<span id="cb186-149"><a href="source-code.html#cb186-149" tabindex="-1"></a>  cna_df_per_chrom_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(cna_df_per_chrom_list, <span class="at">.id =</span> <span class="st">&quot;chrom_scar&quot;</span>)</span>
<span id="cb186-150"><a href="source-code.html#cb186-150" tabindex="-1"></a>  </span>
<span id="cb186-151"><a href="source-code.html#cb186-151" tabindex="-1"></a>  <span class="co"># removing cell_num scar</span></span>
<span id="cb186-152"><a href="source-code.html#cb186-152" tabindex="-1"></a>  cna_df_per_chrom_df <span class="ot">&lt;-</span> cna_df_per_chrom_df[, <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(cna_df_per_chrom_df)]</span>
<span id="cb186-153"><a href="source-code.html#cb186-153" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="cin_signature_ccle-script-run_cin_ccle-function" class="section level2 hasAnchor" number="6.18">
<h2><span class="header-section-number">6.18</span> cin_signature_ccle script: ‘run_cin_ccle’ function<a href="source-code.html#cin_signature_ccle-script-run_cin_ccle-function" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<pre class="run_cin_ccle"><code>run_cin_ccle &lt;- function(cnv, d) { 
  #&#39; @param cnv is segmental data to input in CINSignatureQuantification
  #&#39; @param d is a dataframe with sample metadata that is joined with cnv
  #&#39; @return outputs CIN signature values.
  
  #############
  # Libraries #
  #############
  require(CINSignatureQuantification)
  require(tidyverse)
  
  ###########
  # Wrangle #
  ###########
  wrangler_cin_signature_ccle &lt;- function(df) {
    #&#39; @param  df: A dataframe containing all the copy number calls of all the files.
    #&#39; @return a dataframe in the format https://github.com/markowetzlab/CINSignatureQuantification
    
    # remove unwanted column names
    keep_columns &lt;-
      c(&#39;Chromosome&#39;,
        &#39;Start&#39;,
        &#39;End&#39;,
        &#39;Segment_Mean&#39;,
        &#39;DepMap_ID&#39;)
    
    new_df &lt;- subset(df, select = keep_columns)
    
    # reorder columns
    col_order &lt;- c(&#39;Chromosome&#39;,
                   &#39;Start&#39;,
                   &#39;End&#39;,
                   &#39;Segment_Mean&#39;,
                   &#39;DepMap_ID&#39;)
    
    new_df &lt;- new_df[, col_order]
    
    # define new column names
    column_names &lt;-
      c(&#39;chromosome&#39;,
        &#39;start&#39;,
        &#39;end&#39;,
        &#39;segVal&#39;,
        &#39;sample&#39;)
    
    colnames(new_df) &lt;- column_names
    
    return(new_df)
    
  }
  
  # Subset cnv to only include samples where radiation sensitivity is known
  cnv &lt;-
    cnv[cnv$DepMap_ID %in% d$DepMap_ID,]
  
  # Wrangle
  cnv &lt;-
    wrangler_cin_signature_ccle(cnv)
  
  # The CIN algorithm (run with quantifyCNSignatures) does not support Y chromosome, we have to get rid of those.
  cnv &lt;-
    cnv[cnv$chromosome != &#39;Y&#39;, ]
  
  #######
  # Run #
  #######
  # Running the CIN scores
  cin_scores &lt;-
    quantifyCNSignatures(cnv, build = &#39;hg38&#39;)
  
  # Extracting the values.
  cin_values &lt;- getActivities(cin_scores)

  ###########
  # Wrangle #
  ###########
  cin_df &lt;- as.data.frame(cin_values)
  
  cin_df$DepMap_ID &lt;- rownames(cin_df)
  
  cin_df &lt;-
    gather(cin_df, cx_signature, cx_value, CX1:CX17, factor_key = T)
  
  # add some metadata
  cin_df &lt;- inner_join(cin_df, d)

  ##########
  # Return #
  ##########
  return(cin_df)
  
}
</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="copy-number-pattern-analyses.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/dshandel/subclonal_evolution_paper/edit/main/06-source.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/dshandel/subclonal_evolution_paper/blob/main/06-source.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
